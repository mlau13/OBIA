{% macro W_SALES_INVOICE_LINE_F() %}
--To Do -- Clean up added records that are no longer needed

  {% set sql %}
  
  --Delete inserted records

delete from OBIEE_DW.W_SALES_INVOICE_LINE_F where INTEGRATION_ID in(
select 	
	TARGET_TABLE.INTEGRATION_ID INTEGRATION_ID 
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_SALES_INVOICE_LINE_F"  TARGET_TABLE, "PC_FIVETRAN_DB"."OBIEE_DW"."W_SALES_INVOICE_LINE_FS"    PE_STAGE_TABLE
where TARGET_TABLE.INTEGRATION_ID=PE_STAGE_TABLE.INTEGRATION_ID);


  --Inserts records that don't have actuals for a given day, but have a daily budget
    insert into OBIEE_DW.W_SALES_INVOICE_LINE_F
(
SALES_ORDLN_ID,
	SALES_PCKLN_ID,
	CHNL_TYPE_ID,
	COMPANY_ORG_ID,
	CUSTOMER_BILL_TO_LOC_ID,
	CUSTOMER_CNTCT_ID,
	CUSTOMER_PAYER_LOC_ID,
	CUSTOMER_SHIP_TO_LOC_ID,
	CUSTOMER_SOLD_TO_LOC_ID,
	FREIGHT_TERMS_ID,
	INVENTORY_ORG_ID,
	INVENTORY_PRODUCT_ID,
	INVOICE_STATUS_ID,
	OPERATING_UNIT_ORG_ID,
	ORDER_XACT_TYPE_ID,
	PAYMENT_METHOD_ID,
	PAYMENT_TERMS_ID,
	PLANT_LOC_ID,
	PRODUCT_ID,
	SALES_ORG_ID,
	SALES_PRODUCT_ID,
	SALES_REP_ID,
	TERR_ID,
	XACT_TYPE_ID,
	CONVERSION_DT,
	INVOICED_ON_DT,
	PAYMENT_TERMS_EFF_DT,
	POSTING_PERIOD_DT,
	NET_AMT,
	LIST_AMT,
	TAX_AMT,
	FREIGHT_AMT,
	DISCOUNT_AMT,
	INVOICED_QTY,
	SALES_UOM_CODE,
	INVOICE_NUM,
	INVOICE_ITEM,
	REF_DOC_NUM,
	SALES_ORDER_NUM,
	SALES_ORDER_ITEM,
	SALES_ORDER_ITEM_DETAIL_NUM,
	PURCH_ORDER_NUM,
	DELETE_FLG,
	DOC_CURR_CODE,
	LOC_CURR_CODE,
	LOC_EXCH_RATE_TYPE,
	LOC_EXCHANGE_RATE,
	EXCHANGE_DT,
	CREATED_BY_ID,
	CHANGED_BY_ID,
	CREATED_ON_DT,
	CHANGED_ON_DT,
	AUX1_CHANGED_ON_DT,
	AUX2_CHANGED_ON_DT,
	AUX4_CHANGED_ON_DT,
	DATASOURCE_NUM_ID,
	INTEGRATION_ID,
	SERVICE_FLG,
	ITEM_TYPE_CODE,
	LEDGER_ID,
	ORDER_SOURCE_ID,
	DISCOUNT_LINE_FLG,
	PROJECT_ID,
	TASK_ID,
	CUSTOMER_ACCOUNT_ID,
	XACT_SOURCE_ID,
	FULFILL_LINE_ID,
	INVOICE_HEADER_ID,
	X_ORDER_SOURCE,
	X_SERVICE_START_DT,
	X_SERVICE_END_DT,
	X_SERVICE_REF_TYPE_CODE,
	X_SERVICE_REF_LINE_ID,
	X_LICENSE_ID,
	X_ORDER_LINE_NUM,
	X_ORDER_DT,
	X_GL_DATE,
	X_GL_POSTED_DATE,
	X_PROJECT_ID,
	X_CUSTOMER_TRX_LINE_ID,
	X_SHIP_TO_CUSTOMER_ID,
	X_SOLD_TO_CUSTOMER_ID,
	X_BILL_TO_CUSTOMER_ID,
	X_CVRD_INV_ITEM_ID,
	X_BATCH_SOURCE,
	X_BATCH_NAME,
	X_CIS_DATE,
	X_SALESREP_ID,
	X_PROJECT_NAME,
	X_SERVICE_ITEM_FLAG,
	X_SIMPLIFIED_CONTRACT_NUM,
	X_REVN_TYPE_PRODUCT_ID,
	X_PRICING_ATTRIBUTE25,
	X_PRICING_ATTRIBUTE28,
	X_SIEBEL_ORDER_NUM,
	X_PS_BUSINESS_UNIT,
	X_SERVICE_LINE_DIRECTOR,
	X_PROJECT_MANAGER,
	X_TYPE_OF_SERVICE,
	X_PS_PRODUCT_GROUP,
	X_PS_REV_TYPE,
	X_TASK_NUMBER,
	X_TASK_NAME,
	X_VAT_TAX_CODE,
	X_PS_PRODUCT_UNIT,
	X_TAX_RATE,
	X_REFERENCE_NUMBER,
	X_TAX_AMT,
	X_FAE,
	X_COMMENTS,
	X_SALES_SPLIT_LINE_WID,
	LAST_DATE	
)
select 
SALES_ORDLN_ID,
	SALES_PCKLN_ID,
	CHNL_TYPE_ID,
	COMPANY_ORG_ID,
	CUSTOMER_BILL_TO_LOC_ID,
	CUSTOMER_CNTCT_ID,
	CUSTOMER_PAYER_LOC_ID,
	CUSTOMER_SHIP_TO_LOC_ID,
	CUSTOMER_SOLD_TO_LOC_ID,
	FREIGHT_TERMS_ID,
	INVENTORY_ORG_ID,
	INVENTORY_PRODUCT_ID,
	INVOICE_STATUS_ID,
	OPERATING_UNIT_ORG_ID,
	ORDER_XACT_TYPE_ID,
	PAYMENT_METHOD_ID,
	PAYMENT_TERMS_ID,
	PLANT_LOC_ID,
	PRODUCT_ID,
	SALES_ORG_ID,
	SALES_PRODUCT_ID,
	SALES_REP_ID,
	TERR_ID,
	XACT_TYPE_ID,
	CONVERSION_DT,
	INVOICED_ON_DT,
	PAYMENT_TERMS_EFF_DT,
	POSTING_PERIOD_DT,
	NET_AMT,
	LIST_AMT,
	TAX_AMT,
	FREIGHT_AMT,
	DISCOUNT_AMT,
	INVOICED_QTY,
	SALES_UOM_CODE,
	INVOICE_NUM,
	INVOICE_ITEM,
	REF_DOC_NUM,
	SALES_ORDER_NUM,
	SALES_ORDER_ITEM,
	SALES_ORDER_ITEM_DETAIL_NUM,
	PURCH_ORDER_NUM,
	DELETE_FLG,
	DOC_CURR_CODE,
	LOC_CURR_CODE,
	LOC_EXCH_RATE_TYPE,
	LOC_EXCHANGE_RATE,
	EXCHANGE_DT,
	CREATED_BY_ID,
	CHANGED_BY_ID,
	CREATED_ON_DT,
	CHANGED_ON_DT,
	AUX1_CHANGED_ON_DT,
	AUX2_CHANGED_ON_DT,
	AUX4_CHANGED_ON_DT,
	DATASOURCE_NUM_ID,
	INTEGRATION_ID,
	SERVICE_FLG,
	ITEM_TYPE_CODE,
	LEDGER_ID,
	ORDER_SOURCE_ID,
	DISCOUNT_LINE_FLG,
	PROJECT_ID,
	TASK_ID,
	CUSTOMER_ACCOUNT_ID,
	XACT_SOURCE_ID,
	FULFILL_LINE_ID,
	INVOICE_HEADER_ID,
	X_ORDER_SOURCE,
	X_SERVICE_START_DT,
	X_SERVICE_END_DT,
	X_SERVICE_REF_TYPE_CODE,
	X_SERVICE_REF_LINE_ID,
	X_LICENSE_ID,
	X_ORDER_LINE_NUM,
	X_ORDER_DT,
	X_GL_DATE,
	X_GL_POSTED_DATE,
	X_PROJECT_ID,
	X_CUSTOMER_TRX_LINE_ID,
	X_SHIP_TO_CUSTOMER_ID,
	X_SOLD_TO_CUSTOMER_ID,
	X_BILL_TO_CUSTOMER_ID,
	X_CVRD_INV_ITEM_ID,
	X_BATCH_SOURCE,
	X_BATCH_NAME,
	X_CIS_DATE,
	X_SALESREP_ID,
	X_PROJECT_NAME,
	X_SERVICE_ITEM_FLAG,
	X_SIMPLIFIED_CONTRACT_NUM,
	X_REVN_TYPE_PRODUCT_ID,
	X_PRICING_ATTRIBUTE25,
	X_PRICING_ATTRIBUTE28,
	X_SIEBEL_ORDER_NUM,
	X_PS_BUSINESS_UNIT,
	X_SERVICE_LINE_DIRECTOR,
	X_PROJECT_MANAGER,
	X_TYPE_OF_SERVICE,
	X_PS_PRODUCT_GROUP,
	X_PS_REV_TYPE,
	X_TASK_NUMBER,
	X_TASK_NAME,
	X_VAT_TAX_CODE,
	X_PS_PRODUCT_UNIT,
	X_TAX_RATE,
	X_REFERENCE_NUMBER,
	X_TAX_AMT,
	X_FAE,
	X_COMMENTS,
	X_SALES_SPLIT_LINE_WID,
	LAST_DATE	
from  OBIEE_DW.W_SALES_INVOICE_LINE_FS;

{% endset %}

{% do run_query(sql) %}

{% do log("W_SALES_INVOICE_LINE_F", info=True) %}

{% endmacro %}