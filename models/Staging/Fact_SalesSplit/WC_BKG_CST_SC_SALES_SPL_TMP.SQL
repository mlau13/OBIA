{{ config (
    materialized="table"
)}}

WITH WC_BKG_CST_SC_SALES_SPL_TMP AS
(
    select	
	
	STAGING.LINE_ID	   LINE_ID,
	STAGING.ORIG_SALESPERSON_ID	   ORIG_SALESREP_ID,
	STAGING.SPLIT_SALESPERSON_ID	  SPLIT_SALESREP_ID,
	STAGING.ORIG_SALESFORCE_ACCOUNT_ID	  ORIG_SF_ACCOUNT_ID,
	STAGING.SPLIT_SALESFORCE_ACCOUNT_ID	  SPLIT_SF_ACCOUNT_ID,
	STAGING.SALES_SPLIT_PERCENTAGE	   SPLIT_PERCENTAGE,
	STAGING.DATE_APPROVED	   ORDERED_DATE,
	STAGING.TRANSACTION_TYPE	   TRANSACTION_TYPE,
	SALESPERSON_LOOKUP.SOURCE_ID	  PERSON_ID
from	
( /* Subselect from WR_SDE_ORA_SalesSplitTempTables.WC_BKG_CST_SC_SALES_SPL_TMP_EXTRACT
*/


select 
	   

	   
	   TO_CHAR(WRS_SC_SPLIT_ALL.PRODUCT_LINE_ID) LINE_ID,
	OKC_K_HEADERS_ALL_B.DATE_APPROVED DATE_APPROVED,
	WRS_SC_SPLIT_ALL.ORIG_SALESPERSON_ID ORIG_SALESPERSON_ID,
	WRS_SC_SPLIT_ALL.SPLIT_SALESPERSON_ID SPLIT_SALESPERSON_ID,
	WRS_SC_SPLIT_ALL.ORIG_SALESFORCE_ACCOUNT_ID ORIG_SALESFORCE_ACCOUNT_ID,
	WRS_SC_SPLIT_ALL.SPLIT_SALESFORCE_ACCOUNT_ID SPLIT_SALESFORCE_ACCOUNT_ID,
	WRS_SC_SPLIT_ALL.SALES_SPLIT_PERCENTAGE SALES_SPLIT_PERCENTAGE,
	WRS_SC_SPLIT_ALL.TRANSACTION_TYPE TRANSACTION_TYPE
from	"PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_LINES_B"   OKC_K_LINES_B, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_HEADERS_ALL_B"   OKC_K_HEADERS_ALL_B,
  "PC_FIVETRAN_DB"."ERPPRD_WRSAPP"."WRS_SC_SPLIT_ALL"   WRS_SC_SPLIT_ALL
where	(1=1)
 And (OKC_K_HEADERS_ALL_B.ID=OKC_K_LINES_B.DNZ_CHR_ID)
AND (OKC_K_LINES_B.ID=WRS_SC_SPLIT_ALL.CLE_ID)

And (OKC_K_HEADERS_ALL_B.DATE_APPROVED IS NOT NULL)
 And (OKC_K_LINES_B.LSE_ID = 1)
 And (WRS_SC_SPLIT_ALL.PRODUCT_LINE_ID IS NOT NULL)




UNION

select 
	   

	   
	   TO_CHAR(OKC_K_LINES_B.ID) LINE_ID,
	OKC_K_HEADERS_ALL_B.DATE_APPROVED DATE_APPROVED,
	WRS_SERVICE_CONTRACT_SPLIT_ALL.ORIG_SALESPERSON_ID ORIG_SALESPERSON_ID,
	WRS_SERVICE_CONTRACT_SPLIT_ALL.SPLIT_SALESPERSON_ID SPLIT_SALESPERSON_ID,
	WRS_SERVICE_CONTRACT_SPLIT_ALL.ORIG_SALESFORCE_ACCOUNT_ID ORIG_SALESFORCE_ACCOUNT_ID,
	WRS_SERVICE_CONTRACT_SPLIT_ALL.SPLIT_SALESPERSON_NUMBER SPLIT_SALESFORCE_ACCOUNT_ID,
	WRS_SERVICE_CONTRACT_SPLIT_ALL.SALES_SPLIT_PERCENTAGE SALES_SPLIT_PERCENTAGE,
	WRS_SERVICE_CONTRACT_SPLIT_ALL.TRANSACTION_TYPE TRANSACTION_TYPE
from	"PC_FIVETRAN_DB"."ERPPRD_WRSAPP"."WRS_SC_SPLIT_ALL"   WRS_SERVICE_CONTRACT_SPLIT_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_HEADERS_ALL_B"   OKC_K_HEADERS_ALL_B, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_LINES_B"   OKC_K_LINES_B
where	(1=1)
 And (OKC_K_HEADERS_ALL_B.ID=OKC_K_LINES_B.DNZ_CHR_ID)
AND (WRS_SERVICE_CONTRACT_SPLIT_ALL.LINE_ID=OKC_K_LINES_B.CLE_ID)

And (OKC_K_LINES_B.LSE_ID = 9)
 And (WRS_SERVICE_CONTRACT_SPLIT_ALL.PRODUCT_LINE_ID IS NULL)
 And (OKC_K_HEADERS_ALL_B.DATE_APPROVED IS NOT NULL)







)   STAGING, (

select 	
	RA_SALESREPS_ALL.SALESREP_ID    SALESREP_ID,	JTF_RS_RESOURCE_EXTNS.SOURCE_ID    SOURCE_ID
from	"PC_FIVETRAN_DB"."ERPPRD_JTF"."JTF_RS_SALESREPS"   RA_SALESREPS_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD_JTF"."JTF_RS_RESOURCE_EXTNS" JTF_RS_RESOURCE_EXTNS
where	(1=1)
 And (RA_SALESREPS_ALL.RESOURCE_ID=JTF_RS_RESOURCE_EXTNS.RESOURCE_ID)
And (JTF_RS_RESOURCE_EXTNS.CATEGORY IN ('EMPLOYEE', 'OTHER'))


)   SALESPERSON_LOOKUP
where	(1=1)

 And (STAGING.SPLIT_SALESPERSON_ID=SALESPERSON_LOOKUP.SALESREP_ID)
)
SELECT * FROM WC_BKG_CST_SC_SALES_SPL_TMP