{{ config (
    materialized="table"
)}}

select	
	X_SALES_SPLIT_LINE_WID,
	SALESREP_ID,
	SALES_REP_WID,
	PERCENT,
	SALES_REP_TERR_WID,
	CREDIT_TYPE_CODE,
	ORIG_SALESFORCE_ACCOUNT_ID,
	SPLIT_SALESFORCE_ACCOUNT_ID
	
FROM (	


select 	
	
	WC_INV_SPLIT_FX_OLD_TMP_SQ.LINE_ID X_SALES_SPLIT_LINE_WID,
	WC_INV_SPLIT_FX_OLD_TMP_SQ.SALESREP_ID SALESREP_ID,
	WC_INV_SPLIT_FX_OLD_TMP_SQ.SALES_REP_WID SALES_REP_WID,
	WC_INV_SPLIT_FX_OLD_TMP_SQ.PERCENT PERCENT,
	WC_INV_SPLIT_FX_OLD_TMP_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	COALESCE(WC_INV_SPLIT_FX_OLD_TMP_SQ.CREDIT_TYPE_CODE,'Unspecified') CREDIT_TYPE_CODE,
	null ORIG_SALESFORCE_ACCOUNT_ID,
	null SPLIT_SALESFORCE_ACCOUNT_ID 
from	
( /* Subselect from WR_SIL_SalesSplitFact_Invoice.WC_SALES_INVOICE_SLS_SPLIT_FX_OLD_TMP
*/


select 
	   

	   
	   WC_INV_SC_SALES_SPL_TMP_SQ.LINE_ID LINE_ID,
	WC_INV_SC_SALES_SPL_TMP_SQ.SALESREP_ID SALESREP_ID,
	WC_INV_SC_SALES_SPL_TMP_SQ.SALES_REP_WID SALES_REP_WID,
	WC_INV_SC_SALES_SPL_TMP_SQ.PERCENT PERCENT,
	WC_INV_SC_SALES_SPL_TMP_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	WC_INV_SC_SALES_SPL_TMP_SQ.CREDIT_TYPE_CODE CREDIT_TYPE_CODE
from	(

select 	DISTINCT
	WC_INV_SC_SALES_SPL_TMP.CUSTOMER_TRX_LINE_ID    LINE_ID,	WC_INV_SC_SALES_SPL_TMP.SALESREP_ID    SALESREP_ID,	
  WC_INV_SC_SALES_SPL_TMP.REVENUE_PERCENT_SPLIT    PERCENT,	MAX(WC_INV_SC_SALES_SPL_TMP.INVOICED_ON_DT)    ORDERED_DATE,	
 -- WC_INV_SC_SALES_SPL_TMP.DATASOURCE_NUM_ID    DATASOURCE_NUM_ID,	
  WC_INV_SC_SALES_SPL_TMP.PERSON_ID    PERSON_ID,	MAX(W_EMPLOYEE_D.INTEGRATION_ID)    SALES_REP_WID,	
  MAX(WC_SALESREP_TERRITORY_D.INTEGRATION_ID)    SALES_REP_TERR_WID,	
  WC_INV_SC_SALES_SPL_TMP.CUST_TRX_LINE_SALESREP_ID    CUST_TRX_LINE_SALESREP_ID,	null    CREDIT_TYPE_CODE
from	"PC_FIVETRAN_DB"."OBIEE_DW"."WC_INV_SC_SALES_SPL_TMP"   WC_INV_SC_SALES_SPL_TMP, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."W_EMPLOYEE_D"   W_EMPLOYEE_D, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALESREP_TERRITORIES_D"   WC_SALESREP_TERRITORY_D
where	(1=1)
 And ((CASE
WHEN WC_INV_SC_SALES_SPL_TMP.PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(WC_INV_SC_SALES_SPL_TMP.SALESREP_ID)
ELSE 'PER~'||TO_CHAR(WC_INV_SC_SALES_SPL_TMP.PERSON_ID) 
END )=W_EMPLOYEE_D.INTEGRATION_ID (+))
AND (WC_INV_SC_SALES_SPL_TMP.SALESREP_ID=WC_SALESREP_TERRITORY_D.INTEGRATION_ID (+))

Group By WC_INV_SC_SALES_SPL_TMP.CUSTOMER_TRX_LINE_ID,
 WC_INV_SC_SALES_SPL_TMP.SALESREP_ID,
 WC_INV_SC_SALES_SPL_TMP.REVENUE_PERCENT_SPLIT,
 --WC_INV_SC_SALES_SPL_TMP.DATASOURCE_NUM_ID,
 WC_INV_SC_SALES_SPL_TMP.PERSON_ID,
 WC_INV_SC_SALES_SPL_TMP.CUST_TRX_LINE_SALESREP_ID

)   WC_INV_SC_SALES_SPL_TMP_SQ
where	(1=1)





UNION ALL

select 
	   

	   
	   WC_INV_OM_SALES_SPL_TMP_SQ.LINE_ID LINE_ID,
	WC_INV_OM_SALES_SPL_TMP_SQ.SALESREP_ID SALESREP_ID,
	WC_INV_OM_SALES_SPL_TMP_SQ.SALES_REP_WID SALES_REP_WID,
	WC_INV_OM_SALES_SPL_TMP_SQ.PERCENT PERCENT,
	WC_INV_OM_SALES_SPL_TMP_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	WC_INV_OM_SALES_SPL_TMP_SQ.CREDIT_TYPE_CODE CREDIT_TYPE_CODE
from	(

select 	
	WC_INV_OM_SALES_SPL_TMP.CUSTOMER_TRX_LINE_ID    LINE_ID,	WC_INV_OM_SALES_SPL_TMP.SALESREP_ID    SALESREP_ID,	
  NVL(WC_INV_OM_SALES_SPL_TMP.REVENUE_PERCENT_SPLIT,100)    PERCENT,	WC_INV_OM_SALES_SPL_TMP.INVOICED_ON_DT    ORDERED_DATE,	
 -- WC_INV_OM_SALES_SPL_TMP.DATASOURCE_NUM_ID    DATASOURCE_NUM_ID,	
  WC_INV_OM_SALES_SPL_TMP.PERSON_ID    PERSON_ID,	W_EMPLOYEE_D.INTEGRATION_ID    SALES_REP_WID,	WC_SALESREP_TERRITORY_D.INTEGRATION_ID    SALES_REP_TERR_WID,	null    CREDIT_TYPE_CODE
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_EMPLOYEE_D"   W_EMPLOYEE_D, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALESREP_TERRITORIES_D"   WC_SALESREP_TERRITORY_D,
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_INV_OM_SALES_SPL_TMP"   WC_INV_OM_SALES_SPL_TMP
where	(1=1)
 And (WC_INV_OM_SALES_SPL_TMP.SALESREP_ID=WC_SALESREP_TERRITORY_D.INTEGRATION_ID (+))
AND ((CASE
WHEN WC_INV_OM_SALES_SPL_TMP.PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(WC_INV_OM_SALES_SPL_TMP.SALESREP_ID)
ELSE 'PER~'||TO_CHAR(WC_INV_OM_SALES_SPL_TMP.PERSON_ID) 
END )=W_EMPLOYEE_D.INTEGRATION_ID (+))
--And (W_EMPLOYEE_D.CURRENT_FLG (+)='Y')


)   WC_INV_OM_SALES_SPL_TMP_SQ
where	(1=1)





UNION ALL

select 
	   
   WC_BKG_PA_SALES_SPL_TMP_SQ.LINE_ID LINE_ID,
	WC_BKG_PA_SALES_SPL_TMP_SQ.SALESREP_ID SALESREP_ID,
	WC_BKG_PA_SALES_SPL_TMP_SQ.SALES_REP_WID SALES_REP_WID,
	WC_BKG_PA_SALES_SPL_TMP_SQ.PERCENT PERCENT,
	WC_BKG_PA_SALES_SPL_TMP_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	WC_BKG_PA_SALES_SPL_TMP_SQ.CREDIT_TYPE_CODE CREDIT_TYPE_CODE
from	(

select 	
	to_number(WC_BKG_PA_SALES_SPL_TMP.PROJECT_ID||.999)    LINE_ID,	WC_BKG_PA_SALES_SPL_TMP.SALESREP_ID    SALESREP_ID,	
  WC_BKG_PA_SALES_SPL_TMP.CREDIT_PERCENTAGE    PERCENT,	WC_BKG_PA_SALES_SPL_TMP.ORDERED_DATE    ORDERED_DATE,	
  --WC_BKG_PA_SALES_SPL_TMP.DATASOURCE_NUM_ID    DATASOURCE_NUM_ID,	
  WC_BKG_PA_SALES_SPL_TMP.PERSON_ID    PERSON_ID,	WC_BKG_PA_SALES_SPL_TMP.CREDIT_TYPE_CODE    CREDIT_TYPE_CODE,	
  MAX(W_EMPLOYEE_D.INTEGRATION_ID)    SALES_REP_WID,	WC_SALESREP_TERRITORY_D.INTEGRATION_ID    SALES_REP_TERR_WID
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_EMPLOYEE_D"   W_EMPLOYEE_D, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALESREP_TERRITORIES_D"   WC_SALESREP_TERRITORY_D, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_BKG_PA_SALES_SPL_TMP"   WC_BKG_PA_SALES_SPL_TMP
where	(1=1)
 And ((CASE
WHEN WC_BKG_PA_SALES_SPL_TMP.PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(WC_BKG_PA_SALES_SPL_TMP.SALESREP_ID)
ELSE 'PER~'||TO_CHAR(WC_BKG_PA_SALES_SPL_TMP.PERSON_ID) 
END )=W_EMPLOYEE_D.INTEGRATION_ID (+))
AND (WC_BKG_PA_SALES_SPL_TMP.SALESREP_ID=WC_SALESREP_TERRITORY_D.INTEGRATION_ID (+))

Group By to_number(WC_BKG_PA_SALES_SPL_TMP.PROJECT_ID||.999),
 WC_BKG_PA_SALES_SPL_TMP.SALESREP_ID,
 WC_BKG_PA_SALES_SPL_TMP.CREDIT_PERCENTAGE,
 WC_BKG_PA_SALES_SPL_TMP.ORDERED_DATE,
 --WC_BKG_PA_SALES_SPL_TMP.DATASOURCE_NUM_ID,
 WC_BKG_PA_SALES_SPL_TMP.PERSON_ID,
 WC_BKG_PA_SALES_SPL_TMP.CREDIT_TYPE_CODE,
 WC_SALESREP_TERRITORY_D.INTEGRATION_ID

)   WC_BKG_PA_SALES_SPL_TMP_SQ
where	(1=1)








)   WC_INV_SPLIT_FX_OLD_TMP_SQ
where		(1=1)	

--And (WC_INV_SPLIT_FX_OLD_TMP_SQ.LINE_ID NOT IN (SELECT X_SALES_SPLIT_LINE_WID FROM WC_SALES_INVOICE_SLS_SPLIT_FX))




)    ODI_GET_FROM

