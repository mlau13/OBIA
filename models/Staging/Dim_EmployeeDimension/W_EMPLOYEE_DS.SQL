WITH EMPLOYEE AS
(
select FST_NAME	,
MID_NAME	,
LAST_NAME	,
PREV_LAST_NAME	,
FULL_NAME	,
NAME_PREFIX	,
INDV_TITLE	,
NAME_SUFFIX	,
PARTY_ID	,
EMAIL_ADDR	,
EMP_HIRE_DT	,
ORIG_HIRE_DT	,
ADJ_SERVICE_DT	,
CONTRACT_ST_DT	,
CONTRACT_END_DT	,
EMPLOYEE_NUM	,
SUPERVISOR_NUM	,
SUPERVISOR_NAME	,
CONTINGENT_WORKER_NUM	,
APPLICANT_NUM	,
DEPARTMENT_CODE	,
C22_HELD_POSTN	,
POSITION_TYPE_CODE	,
JOB_TITLE	,
PAR_HELD_POSTN	,
PR_POSTN	,
NATIVE_LANG_CODE	,
EMP_FLG	,
SALES_REP_FLG	,
BUYER_FLG	,
REQUESTOR_FLG	,
APPLICANT_FLG	,
MANAGER_FLG	,
LOGIN	,
SRC_EFF_FROM_DT	,
SRC_EFF_TO_DT	,
INTEGRATION_ID	,
X_CUSTOM	,
DELETE_FLG	,
PAR_INTEGRATION_ID	,
VIS_PR_BU_ID	,
VIS_PR_POS_ID	,
CREATED_BY_ID	,
CHANGED_BY_ID	,
CREATED_ON_DT	,
CHANGED_ON_DT	,
AUX1_CHANGED_ON_DT	,
AUX2_CHANGED_ON_DT	,
AUX3_CHANGED_ON_DT	,
LAST_WORKED_DT	,
REQUESTOR_ID	,
BUYER_ID	,
AUX6_CHANGED_ON_DT	,
X_SALESREP_NUMBER	,
PERSON_ID ,
NULL	CITY	,
NULL	COUNTY	,
NULL	STATE_PROV_CODE	,
NULL	ZIPCODE	,
NULL	WORK_PHONE	,
NULL	PAGER_NUM	,
NULL	MOBILE_NUM	,
NULL	JOB_TITLE	,
NULL	NATIVE_LANG_CODE	,
NULL	SEC_FLU_LANG_CODE	,
NULL	SALES_REP_FLG	,
NULL	SOURCE_ADDRESS1	,
NULL	SOURCE_ADDRESS2	,
NULL	SOURCE_ADDRESS3	,
NULL	SOURCE_ADDRESS4	

from 


(select	
	
	SQ_EMPLOYEES.FIRST_NAME	   FST_NAME,
	SQ_EMPLOYEES.MIDDLE_NAMES  MID_NAME,
	SQ_EMPLOYEES.LAST_NAME	   LAST_NAME,
	SQ_EMPLOYEES.PREVIOUS_LAST_NAME	   PREV_LAST_NAME,
	case 'L,F' when 'L,F' then SQ_EMPLOYEES.LAST_NAME||','||SQ_EMPLOYEES.FIRST_NAME

 when 'L,M,F' then SQ_EMPLOYEES.LAST_NAME||','||SQ_EMPLOYEES.MIDDLE_NAMES||','||SQ_EMPLOYEES.FIRST_NAME

when 'F L' then SQ_EMPLOYEES.FIRST_NAME||' '||SQ_EMPLOYEES.LAST_NAME

when 'F M L' then SQ_EMPLOYEES.FIRST_NAME||' '||SQ_EMPLOYEES.MIDDLE_NAMES||' '||SQ_EMPLOYEES.LAST_NAME

 when 'L F' then SQ_EMPLOYEES.LAST_NAME||' '||SQ_EMPLOYEES.FIRST_NAME

else SQ_EMPLOYEES.LAST_NAME||','||SQ_EMPLOYEES.FIRST_NAME

end	  FULL_NAME,
	SQ_EMPLOYEES.PRE_NAME_ADJUNCT	  NAME_PREFIX,
	SQ_EMPLOYEES.TITLE	   INDV_TITLE,
	SQ_EMPLOYEES.SUFFIX	   NAME_SUFFIX,
	SQ_EMPLOYEES.PARTY_ID	   PARTY_ID,
	SQ_EMPLOYEES.EMAIL_ADDRESS	   EMAIL_ADDR,
	SQ_EMPLOYEES.EMP_HIRE_DT	   EMP_HIRE_DT,
	SQ_EMPLOYEES.ORIG_HIRE_DT	     ORIG_HIRE_DT,
	SQ_EMPLOYEES.ADJUSTED_SVC_DATE	     ADJ_SERVICE_DT,
	LKP_CONTRACTS.EFFECTIVE_START_DATE	  CONTRACT_ST_DT,
	LKP_CONTRACTS.EFFECTIVE_END_DATE	  CONTRACT_END_DT,
	SQ_EMPLOYEES.EMPLOYEE_NUMBER	      EMPLOYEE_NUM,
	LKP_SUPERVISOR_DATA.EMPLOYEE_NUMBER	  SUPERVISOR_NUM,
	LKP_SUPERVISOR_DATA.FULL_NAME	  SUPERVISOR_NAME,
	SQ_EMPLOYEES.NPW_NUMBER	     CONTINGENT_WORKER_NUM,
	SQ_EMPLOYEES.APPLICANT_NUMBER	   APPLICANT_NUM,
	COALESCE(TO_CHAR(SQ_EMPLOYEES.ORGANIZATION_ID),'__UNASSIGNED__')	  DEPARTMENT_CODE,
	SUBSTR(LKP_POSITION_TYPE.NAME,1,50)	   C22_HELD_POSTN,
	COALESCE(LKP_POSITION_TYPE.POSITION_TYPE,'__UNASSIGNED__')	   POSITION_TYPE_CODE,
	SQ_EMPLOYEES.JOB_TITLE	    JOB_TITLE,
	LKP_SUPERVISOR_POSITION.POSITION_ID	   PAR_HELD_POSTN,
	TO_CHAR(SQ_EMPLOYEES.POSITION_ID)	    PR_POSTN,
	COALESCE(SQ_EMPLOYEES.CORRESPONDENCE_LANGUAGE,'__UNASSIGNED__')	   NATIVE_LANG_CODE,
	SQ_EMPLOYEES.CURRENT_EMPLOYEE_FLAG	  EMP_FLG,
	SQ_EMPLOYEES.SALES_REP_FLG	   SALES_REP_FLG,
	SQ_EMPLOYEES.BUYER_FLG	       BUYER_FLG,
	SQ_EMPLOYEES.REQUESTOR_FLG	   REQUESTOR_FLG,
	SQ_EMPLOYEES.CURRENT_APPLICANT_FLAG	   APPLICANT_FLG,
	SQ_EMPLOYEES.MANAGER_FLG	   MANAGER_FLG,
	LKP_LOGIN.USER_NAME	   LOGIN,
	SQ_EMPLOYEES.EFFECTIVE_START_DATE	  SRC_EFF_FROM_DT,
	SQ_EMPLOYEES.EFFECTIVE_END_DATE	   SRC_EFF_TO_DT,
	'PER~'||TO_CHAR(SQ_EMPLOYEES.PERSON_ID) 	  INTEGRATION_ID,
	SQ_EMPLOYEES.X_CUSTOM	   X_CUSTOM,
	SQ_EMPLOYEES.DELETE_FLG	   DELETE_FLG,
	TO_CHAR(SQ_EMPLOYEES.SUPERVISOR_ID)	  PAR_INTEGRATION_ID,
	TO_CHAR(SQ_EMPLOYEES.ORGANIZATION_ID)	   VIS_PR_BU_ID,
	'PER~'||SQ_EMPLOYEES.PERSON_ID	   VIS_PR_POS_ID,
	TO_CHAR(SQ_EMPLOYEES.CREATED_BY)	   CREATED_BY_ID,
	TO_CHAR(SQ_EMPLOYEES.LAST_UPDATED_BY)	  CHANGED_BY_ID,
	SQ_EMPLOYEES.CREATION_DATE	       CREATED_ON_DT,
	SQ_EMPLOYEES.LAST_UPDATE_DATE	   CHANGED_ON_DT,
	SQ_EMPLOYEES.AUX1_CHANGED_ON_DT	  AUX1_CHANGED_ON_DT,
	SQ_EMPLOYEES.AUX2_CHANGED_ON_DT	   AUX2_CHANGED_ON_DT,
	SQ_EMPLOYEES.AUX3_CHANGED_ON_DT	   AUX3_CHANGED_ON_DT,
	SQ_EMPLOYEES.LAST_WORKED_DT	   LAST_WORKED_DT,
	'PER~'||TO_CHAR(SQ_EMPLOYEES.PERSON_ID)	   REQUESTOR_ID,
	'PER~'||TO_CHAR(SQ_EMPLOYEES.PERSON_ID)	  BUYER_ID,
	SQ_EMPLOYEES.AUX6_CHANGED_ON_DT	  AUX6_CHANGED_ON_DT,
	SQ_EMPLOYEES.X_SALESREP_NUMBER	   X_SALESREP_NUMBER,
	SQ_EMPLOYEES.PERSON_ID	   PERSON_ID
from	((((
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS_SQ_EMPLOYEES
*/


select 
	   

	   
	   P.PERSON_ID PERSON_ID,
	P.FIRST_NAME FIRST_NAME,
	P.MIDDLE_NAMES MIDDLE_NAMES,
	P.LAST_NAME LAST_NAME,
	P.PREVIOUS_LAST_NAME PREVIOUS_LAST_NAME,
	P.FULL_NAME FULL_NAME,
	P.PRE_NAME_ADJUNCT PRE_NAME_ADJUNCT,
	P.SUFFIX SUFFIX,
	P.TITLE TITLE,
	P.DATE_OF_BIRTH DATE_OF_BIRTH,
	P.COUNTRY_OF_BIRTH COUNTRY_OF_BIRTH,
	P.SEX SEX,
	P.EMAIL_ADDRESS EMAIL_ADDRESS,
	SVC.EMP_HIRE_DT EMP_HIRE_DT,
	SVC.ORIG_HIRE_DT ORIG_HIRE_DT,
	SVC.ADJ_SERVICE_DT ADJUSTED_SVC_DATE,
	P.EMPLOYEE_NUMBER EMPLOYEE_NUMBER,
	P.APPLICANT_NUMBER APPLICANT_NUMBER,
	P.NPW_NUMBER NPW_NUMBER,
	P.MARITAL_STATUS MARITAL_STATUS,
	P.NATIONAL_IDENTIFIER NATIONAL_IDENTIFIER,
	CASE P.PER_INFORMATION_CATEGORY
WHEN 'CN' THEN P.PER_INFORMATION17
WHEN 'GB' THEN P.PER_INFORMATION1
WHEN 'IE' THEN P.PER_INFORMATION2
WHEN 'NZ' THEN P.PER_INFORMATION4
WHEN 'SG' THEN P.PER_INFORMATION18
WHEN 'US' THEN P.PER_INFORMATION1
WHEN 'SG' THEN P.PER_INFORMATION18
WHEN 'ZA' THEN P.PER_INFORMATION5
ELSE NULL
END PER_INFORMATION1,
	CASE P.PER_INFORMATION_CATEGORY
WHEN 'US' THEN P.PER_INFORMATION4
WHEN 'SG' THEN P.PER_INFORMATION8
ELSE NULL
END PER_INFORMATION4,
	P.CORRESPONDENCE_LANGUAGE CORRESPONDENCE_LANGUAGE,
	CASE P.PER_INFORMATION_CATEGORY
WHEN 'US' THEN P.PER_INFORMATION5
WHEN 'FR' THEN P.PER_INFORMATION6
ELSE NULL
END PER_INFORMATION5,
	P.REGISTERED_DISABLED_FLAG REGISTERED_DISABLED_FLAG,
	CASE P.PER_INFORMATION_CATEGORY
WHEN 'AE' THEN P.PER_INFORMATION10
WHEN 'KW' THEN P.PER_INFORMATION8
WHEN 'SA' THEN P.PER_INFORMATION7
WHEN 'ZG' THEN P.PER_INFORMATION16
WHEN 'ZA' THEN P.PER_INFORMATION7
ELSE NULL
END RELIGION_CODE,
	(
	CASE
WHEN(P.CURRENT_EMPLOYEE_FLAG='Y' OR P.CURRENT_NPW_FLAG='Y') THEN 'Y'
ELSE 'N'
END
) CURRENT_EMPLOYEE_FLAG,
	(
	CASE
WHEN SR.RESOURCE_ID1 IS NULL THEN 'N'
ELSE 'Y'
END
) SALES_REP_FLG,
	(
	CASE
WHEN BUY.AGENT_ID IS NULL THEN 'N'
ELSE 'Y'
END
) BUYER_FLG,
	(
	CASE
WHEN P.CURRENT_EMPLOYEE_FLAG IS NULL THEN 'N'
ELSE 'Y'
END
) REQUESTOR_FLG,
	(
	CASE
WHEN P.CURRENT_APPLICANT_FLAG IS NULL THEN 'N'
ELSE 'Y'
END
) CURRENT_APPLICANT_FLAG,
	P.CREATED_BY CREATED_BY,
	P.LAST_UPDATED_BY LAST_UPDATED_BY,
	P.CREATION_DATE CREATION_DATE,
	
 P.LAST_UPDATE_DATE
 LAST_UPDATE_DATE,
	SR.AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
	
 BUY.LAST_UPDATE_DATE
 AUX2_CHANGED_ON_DT,
	P.EFFECTIVE_START_DATE EFFECTIVE_START_DATE,
	P.EFFECTIVE_END_DATE EFFECTIVE_END_DATE,
	A.POSITION_ID POSITION_ID,
	A.BUSINESS_GROUP_ID BUSINESS_GROUP_ID,
	A.LOCATION_ID LOCATION_ID,
	A.ORGANIZATION_ID ORGANIZATION_ID,
	A.SUPERVISOR_ID SUPERVISOR_ID,
	'0' X_CUSTOM,
	TO_CHAR(SR.RESOURCE_ID) PARTY_ID,
	A.MANAGER_FLG MANAGER_FLG,
	SUBSTR(PER_JOBS.NAME,1,75) JOB_TITLE,
	(CASE
WHEN A.EFFECTIVE_START_DATE>A.LAST_UPDATE_DATE THEN A.EFFECTIVE_START_DATE
ELSE A.LAST_UPDATE_DATE
END ) AUX3_CHANGED_ON_DT,
	SVC.ACTUAL_TERMINATION_DATE-1 LAST_WORKED_DT,
	SVC.LAST_UPDATE_DT AUX6_CHANGED_ON_DT,
	
'N'
 DELETE_FLG,
	SR.X_SALESREP_NUMBER X_SALESREP_NUMBER
from	((((("PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
    P LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS_EMPLOYEES.SERVICE
*/


select 
	   

	   
	   PER_PERIODS_OF_SERVICE.PERSON_ID PERSON_ID,
	MAX(PER_PERIODS_OF_SERVICE.DATE_START) EMP_HIRE_DT,
	MIN(PER_PERIODS_OF_SERVICE.DATE_START) ORIG_HIRE_DT,
	MAX(PER_PERIODS_OF_SERVICE.ADJUSTED_SVC_DATE) ADJ_SERVICE_DT,
	MAX(
PER_PERIODS_OF_SERVICE.LAST_UPDATE_DATE
) LAST_UPDATE_DT,
	MAX(PER_PERIODS_OF_SERVICE.ACTUAL_TERMINATION_DATE) ACTUAL_TERMINATION_DATE
from	"PC_FIVETRAN_DB"."ERPPRD_HR"."PER_PERIODS_OF_SERVICE"
   PER_PERIODS_OF_SERVICE
where	(1=1)



Group By PER_PERIODS_OF_SERVICE.PERSON_ID





)    SVC ON P.PERSON_ID=SVC.PERSON_ID) LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS_EMPLOYEES.SALESREP
*/


select 
	   

	   
	   RES.SOURCE_ID PERSON_ID,
	MAX(
RES.LAST_UPDATE_DATE
) AUX1_CHANGED_ON_DT,
	MAX(RES.RESOURCE_ID) RESOURCE_ID,
	MAX(SR.RESOURCE_ID) RESOURCE_ID1,
	MAX(SR.SALESREP_NUMBER) X_SALESREP_NUMBER
from	"PC_FIVETRAN_DB"."ERPPRD_JTF"."JTF_RS_RESOURCE_EXTNS"
    RES LEFT OUTER JOIN "PC_FIVETRAN_DB"."ERPPRD_JTF"."JTF_RS_SALESREPS"
    SR ON RES.RESOURCE_ID=SR.RESOURCE_ID
where	(1=1)

And (RES.CATEGORY='EMPLOYEE')


Group By RES.SOURCE_ID





)    SR ON P.PERSON_ID=SR.PERSON_ID) LEFT OUTER JOIN "PC_FIVETRAN_DB"."ERPPRD_PO"."PO_AGENTS"    BUY ON P.PERSON_ID=BUY.AGENT_ID) INNER JOIN "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_PERSON_TYPES"
   PPT ON P.PERSON_TYPE_ID=PPT.PERSON_TYPE_ID) INNER JOIN (
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS_EMPLOYEES.ASSIGNMENT
*/


select 
	   

	   
	   A.PERSON_ID PERSON_ID,
	A.ASSIGNMENT_ID ASSIGNMENT_ID,
	A.EFFECTIVE_START_DATE EFFECTIVE_START_DATE,
	A.EFFECTIVE_END_DATE EFFECTIVE_END_DATE,
	A.POSITION_ID POSITION_ID,
	A.SUPERVISOR_ID SUPERVISOR_ID,
	A.BUSINESS_GROUP_ID BUSINESS_GROUP_ID,
	A.ORGANIZATION_ID ORGANIZATION_ID,
	A.LOCATION_ID LOCATION_ID,
	A.PERIOD_OF_SERVICE_ID PERIOD_OF_SERVICE_ID,
	A.ASSIGNMENT_STATUS_TYPE_ID ASSIGNMENT_STATUS_TYPE_ID,
	A.ASSIGNMENT_TYPE ASSIGNMENT_TYPE,
	A.CREATION_DATE CREATION_DATE,
	
  A.LAST_UPDATE_DATE
 LAST_UPDATE_DATE,
	RANK() OVER(
	PARTITION BY A.PERSON_ID ORDER BY DECODE(A.ASSIGNMENT_TYPE,'E',1,'C',2,3),
	A.PRIMARY_FLAG DESC,
	A.EFFECTIVE_START_DATE DESC,
	A.ASSIGNMENT_ID DESC,
        A.EFFECTIVE_END_DATE DESC
) CNT,
	A.MANAGER_FLAG MANAGER_FLG,
	A.JOB_ID JOB_ID
from	"PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_ASSIGNMENTS_F"
  A, "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ASSIGNMENT_STATUS_TYPES"   T
where	(1=1)
 And (A.ASSIGNMENT_STATUS_TYPE_ID=T.ASSIGNMENT_STATUS_TYPE_ID)

And (T.PER_SYSTEM_STATUS NOT IN ('TERM_APL','TERM_ASSIGN','SUSP_ASSIGN','SUSP_CWK_ASG'))
 And (A.ASSIGNMENT_TYPE IN ('E','C','A'))
 And (A.EFFECTIVE_START_DATE<=TO_DATE(SUBSTR('2002-02-25 17:59:09',0,19),'YYYY-MM-DD HH24:MI:SS'))







)    A LEFT OUTER JOIN "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_JOBS"
    PER_JOBS ON A.JOB_ID=PER_JOBS.JOB_ID) ON P.PERSON_ID=A.PERSON_ID) INNER JOIN (

select 	
	PER_ALL_PEOPLE_F.PERSON_ID    PERSON_ID,	PER_ALL_PEOPLE_F.EFFECTIVE_START_DATE    EFFECTIVE_START_DATE,	MAX(PER_ALL_PEOPLE_F.EFFECTIVE_END_DATE)    EFFECTIVE_END_DATE
from	"PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
   PER_ALL_PEOPLE_F
where	(1=1)


Group By PER_ALL_PEOPLE_F.PERSON_ID,
 PER_ALL_PEOPLE_F.EFFECTIVE_START_DATE

)    MAXENDDATE ON P.PERSON_ID=MAXENDDATE.PERSON_ID AND P.EFFECTIVE_START_DATE=MAXENDDATE.EFFECTIVE_START_DATE AND P.EFFECTIVE_END_DATE=MAXENDDATE.EFFECTIVE_END_DATE
where	(1=1)

And (A.CNT=1)
 And (



(EXISTS (SELECT 1 FROM  (
 SELECT P.PERSON_ID FROM 
     "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P WHERE
 P.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
     "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P WHERE
 P.CREATION_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
    "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P,
 
"PC_FIVETRAN_DB"."ERPPRD_HR"."PER_PERIODS_OF_SERVICE"
 SVC WHERE P.PERSON_ID=SVC.PERSON_ID AND
 SVC.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
    "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P,
 
     "PC_FIVETRAN_DB"."ERPPRD_JTF"."JTF_RS_RESOURCE_EXTNS" 
 SR WHERE P.PERSON_ID=SR.RESOURCE_ID AND
 SR.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
    "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P, 
     "PC_FIVETRAN_DB"."ERPPRD_PO"."PO_AGENTS"   
 BUY
 WHERE P.PERSON_ID=BUY.AGENT_ID AND
 BUY.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
    "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P, 
     "PC_FIVETRAN_DB"."ERPPRD_PO"."PO_AGENTS" 
 BUY
 WHERE P.PERSON_ID=BUY.AGENT_ID AND
 BUY.CREATION_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
      "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P,
 
     "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_ASSIGNMENTS_F"
 A WHERE P.PERSON_ID=A.PERSON_ID AND
 A.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
      "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P,
 
      "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_ASSIGNMENTS_F"
 A WHERE P.PERSON_ID=A.PERSON_ID AND
 A.CREATION_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
     "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P,
 
      "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_ASSIGNMENTS_F"
 A WHERE P.PERSON_ID=A.PERSON_ID AND
 A.EFFECTIVE_START_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
     "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P, 
     "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ADDRESSES"

 AD WHERE P.PERSON_ID=AD.PERSON_ID AND
 AD.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
     "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
 P, 
     "PC_FIVETRAN_DB"."ERPPRD_HR"."PER_PHONES"
 PH
 WHERE P.PERSON_ID=PH.PARENT_ID AND
 PH.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2002-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 ) TEMP
 WHERE P.PERSON_ID = TEMP.PERSON_ID
 ))

)
 And (PPT.SYSTEM_PERSON_TYPE IN ('APL','APL_EX_APL','CWK','EMP','EMP_APL','EX_APL','EX_CWK','EX_EMP','EX_EMP_APL','OTHER','PRTN','RETIREE'))







)    SQ_EMPLOYEES LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS.LKP_POSITION_TYPE
 - aggregate lookup */

select	 
	 

	
	LKP_POSITION_TYPE.POSITION_ID POSITION_ID,
	LKP_POSITION_TYPE.BUSINESS_GROUP_ID BUSINESS_GROUP_ID,
	LKP_POSITION_TYPE.LOCATION_ID LOCATION_ID,
	LKP_POSITION_TYPE.ORGANIZATION_ID ORGANIZATION_ID,
	MAX(LKP_POSITION_TYPE.POSITION_TYPE) POSITION_TYPE,
	MAX(LKP_POSITION_TYPE.NAME) NAME,
	1 LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD_HR"."HR_ALL_POSITIONS_F"   LKP_POSITION_TYPE
where	(1=1)



group by	LKP_POSITION_TYPE.POSITION_ID,
	LKP_POSITION_TYPE.BUSINESS_GROUP_ID,
	LKP_POSITION_TYPE.LOCATION_ID,
	LKP_POSITION_TYPE.ORGANIZATION_ID

)    LKP_POSITION_TYPE ON COALESCE(SQ_EMPLOYEES.POSITION_ID,-1) = COALESCE(LKP_POSITION_TYPE.POSITION_ID,-1)
AND	COALESCE(SQ_EMPLOYEES.BUSINESS_GROUP_ID,-1) = COALESCE(LKP_POSITION_TYPE.BUSINESS_GROUP_ID,-1)
AND	COALESCE(SQ_EMPLOYEES.LOCATION_ID,-1) = COALESCE(LKP_POSITION_TYPE.LOCATION_ID,-1)
AND	COALESCE(SQ_EMPLOYEES.ORGANIZATION_ID,-1) = COALESCE(LKP_POSITION_TYPE.ORGANIZATION_ID,-1)
AND	1=LKP_POSITION_TYPE.LKP_ACTIVE) LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS.LKP_CONTRACTS
 - aggregate lookup */

select	 
	 

	
	LKP_CONTRACTS.PERSON_ID PERSON_ID,
	MAX(LKP_CONTRACTS.BUSINESS_GROUP_ID) BUSINESS_GROUP_ID,
	MAX(LKP_CONTRACTS.EFFECTIVE_START_DATE) EFFECTIVE_START_DATE,
	MAX(LKP_CONTRACTS.EFFECTIVE_END_DATE) EFFECTIVE_END_DATE,
	1 LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD_HR"."PER_CONTRACTS_F"
   LKP_CONTRACTS
where	(1=1)



group by	LKP_CONTRACTS.PERSON_ID

)    LKP_CONTRACTS ON COALESCE(SQ_EMPLOYEES.PERSON_ID,-1) = COALESCE(LKP_CONTRACTS.PERSON_ID,-1)
AND	SQ_EMPLOYEES.EFFECTIVE_END_DATE >= LKP_CONTRACTS.EFFECTIVE_START_DATE
AND	1=LKP_CONTRACTS.LKP_ACTIVE) LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS.LKP_LOGIN
 - aggregate lookup */

select	 
	 

	
	LKP_LOGIN.EMPLOYEE_ID EMPLOYEE_ID,
	MAX(LKP_LOGIN.START_DATE) START_DATE,
	MAX(LKP_LOGIN.USER_NAME) USER_NAME,
	1 LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD_APPLSYS"."FND_USER"
   LKP_LOGIN
where	(1=1)



group by	LKP_LOGIN.EMPLOYEE_ID

)    LKP_LOGIN ON COALESCE(SQ_EMPLOYEES.PERSON_ID,-1) = COALESCE(LKP_LOGIN.EMPLOYEE_ID,-1)
AND	SQ_EMPLOYEES.EFFECTIVE_END_DATE >= LKP_LOGIN.START_DATE
AND	1=LKP_LOGIN.LKP_ACTIVE) LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS.LKP_SUPERVISOR_DATA
 - aggregate lookup */

select	 
	 

	
	LKP_SUPERVISOR_DATA.PERSON_ID PERSON_ID,
	MAX(LKP_SUPERVISOR_DATA.EFFECTIVE_START_DATE) EFFECTIVE_START_DATE,
	MAX(LKP_SUPERVISOR_DATA.EMPLOYEE_NUMBER) EMPLOYEE_NUMBER,
	MAX(LKP_SUPERVISOR_DATA.FULL_NAME) FULL_NAME,
	1 LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_PEOPLE_F"
   LKP_SUPERVISOR_DATA
where	(1=1)



group by	LKP_SUPERVISOR_DATA.PERSON_ID

)    LKP_SUPERVISOR_DATA ON COALESCE(SQ_EMPLOYEES.SUPERVISOR_ID,-1) = COALESCE(LKP_SUPERVISOR_DATA.PERSON_ID,-1)
AND	SQ_EMPLOYEES.EFFECTIVE_END_DATE >= LKP_SUPERVISOR_DATA.EFFECTIVE_START_DATE
AND	1=LKP_SUPERVISOR_DATA.LKP_ACTIVE) LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS.LKP_SUPERVISOR_POSITION
*/


select 
	   

	   
	   LKP_SUPERVISOR_POSITION.PERSON_ID PERSON_ID,
	LKP_SUPERVISOR_POSITION.EFFECTIVE_START_DATE EFFECTIVE_START_DATE,
	LKP_SUPERVISOR_POSITION.POSITION_ID POSITION_ID,
	DECODE(ROW_NUMBER() OVER (PARTITION BY 
	LKP_SUPERVISOR_POSITION.PERSON_ID ORDER BY 
	LKP_SUPERVISOR_POSITION.EFFECTIVE_START_DATE DESC,LKP_SUPERVISOR_POSITION.POSITION_ID DESC
),1,1,0) LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD_HR"."PER_ALL_ASSIGNMENTS_F"
   LKP_SUPERVISOR_POSITION
where	(1=1)








)    LKP_SUPERVISOR_POSITION ON COALESCE(SQ_EMPLOYEES.SUPERVISOR_ID,-1) = COALESCE(LKP_SUPERVISOR_POSITION.PERSON_ID,-1)
AND	SQ_EMPLOYEES.EFFECTIVE_END_DATE >= LKP_SUPERVISOR_POSITION.EFFECTIVE_START_DATE
AND	1=LKP_SUPERVISOR_POSITION.LKP_ACTIVE

where	(1=1))

UNION ALL

SELECT 	FST_NAME	,
	MID_NAME	,
	LAST_NAME	,
NULL   PREV_LAST_NAME	,
	FULL_NAME	,
NULL	NAME_PREFIX	,
NULL	INDV_TITLE	,
NULL	NAME_SUFFIX	,
	PARTY_ID	,
	EMAIL_ADDR	,
NULL	EMP_HIRE_DT	,
NULL	ORIG_HIRE_DT	,
NULL	ADJ_SERVICE_DT	,
NULL	CONTRACT_ST_DT	,
NULL	CONTRACT_END_DT	,
	EMPLOYEE_NUM	,
NULL	SUPERVISOR_NUM	,
NULL	SUPERVISOR_NAME	,
NULL	CONTINGENT_WORKER_NUM	,
NULL	APPLICANT_NUM	,
NULL	DEPARTMENT_CODE	,
NULL	C22_HELD_POSTN	,
NULL	POSITION_TYPE_CODE	,
NULL	JOB_TITLE	,
NULL	PAR_HELD_POSTN	,
NULL	PR_POSTN	,
NULL	NATIVE_LANG_CODE	,
NULL	EMP_FLG	,
NULL	SALES_REP_FLG	,
NULL	BUYER_FLG	,
NULL	REQUESTOR_FLG	,
NULL	APPLICANT_FLG	,
NULL	MANAGER_FLG	,
	LOGIN	,
NULL	SRC_EFF_FROM_DT	,
NULL	SRC_EFF_TO_DT	,
	INTEGRATION_ID	,
NULL	X_CUSTOM	,
	DELETE_FLG	,
NULL	PAR_INTEGRATION_ID	,
NULL	VIS_PR_BU_ID	,
NULL	VIS_PR_POS_ID	,
NULL	CREATED_BY_ID	,
NULL	CHANGED_BY_ID	,
NULL	CREATED_ON_DT	,
	CHANGED_ON_DT	,
NULL	AUX1_CHANGED_ON_DT	,
NULL	AUX2_CHANGED_ON_DT	,
NULL	AUX3_CHANGED_ON_DT	,
NULL	LAST_WORKED_DT	,
NULL	REQUESTOR_ID	,
NULL	BUYER_ID	,
NULL	AUX6_CHANGED_ON_DT	,
NULL	X_SALESREP_NUMBER	,
NULL	PERSON_ID	,
	CITY	,
	COUNTY	,
	STATE_PROV_CODE	,
	ZIPCODE	,
	WORK_PHONE	,
	PAGER_NUM	,
	MOBILE_NUM	,
	JOB_TITLE	,
	NATIVE_LANG_CODE	,
	SEC_FLU_LANG_CODE	,
	SALES_REP_FLG	,
	SOURCE_ADDRESS1	,
	SOURCE_ADDRESS2	,
	SOURCE_ADDRESS3	,
	SOURCE_ADDRESS4	
 FROM 
(
select	
	
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_FIRST_NAME	   FST_NAME,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_MIDDLE_NAME	   MID_NAME,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_LAST_NAME	   LAST_NAME,
	case 'L,F' when 'L,F' then SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_LAST_NAME||','||SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_FIRST_NAME

 when 'L,M,F' then SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_LAST_NAME||','||SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_MIDDLE_NAME||','||SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_FIRST_NAME

when 'F L' then SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_FIRST_NAME||' '||SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_LAST_NAME

when 'F M L' then SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_FIRST_NAME||' '||SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_MIDDLE_NAME||' '||SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_LAST_NAME

 when 'L F' then SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_LAST_NAME||' '||SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_FIRST_NAME

else SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_LAST_NAME||','||SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_FIRST_NAME

end	   FULL_NAME,
	TO_CHAR(SQ_JTF_RS_RESOURCE_EXTNS.RESOURCE_ID)	   PARTY_ID,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_CITY	   CITY,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_COUNTY	   COUNTY,
	COALESCE(SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_STATE,'__UNASSIGNED__')	   STATE_PROV_CODE,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_POSTAL_CODE	   ZIPCODE,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_PHONE	   WORK_PHONE,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_PAGER	   PAGER_NUM,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_MOBILE_PHONE	  MOBILE_NUM,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_EMAIL	   EMAIL_ADDR,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_NUMBER	   EMPLOYEE_NUM,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_JOB_TITLE	  JOB_TITLE,
	COALESCE(SQ_JTF_RS_RESOURCE_EXTNS.PRIMARY_LANGUAGE,'__UNASSIGNED__')	   NATIVE_LANG_CODE,
	COALESCE(SQ_JTF_RS_RESOURCE_EXTNS.SECONDARY_LANGUAGE,'__UNASSIGNED__')	  SEC_FLU_LANG_CODE,
	(CASE
WHEN SQ_JTF_RS_RESOURCE_EXTNS.RESOURCE_ID1 IS NULL THEN 'N'
ELSE 'Y'
END )	   SALES_REP_FLG,
	SQ_JTF_RS_RESOURCE_EXTNS.USER_NAME	   LOGIN,
	'RES~'||TO_CHAR(SQ_JTF_RS_RESOURCE_EXTNS.RESOURCE_ID)	   INTEGRATION_ID,
	SQ_JTF_RS_RESOURCE_EXTNS.DELETE_FLG	    DELETE_FLG,
	SQ_JTF_RS_RESOURCE_EXTNS.LAST_UPDATE_DATE	  CHANGED_ON_DT,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_ADDRESS1	   SOURCE_ADDRESS1,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_ADDRESS2	   SOURCE_ADDRESS2,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_ADDRESS3	   SOURCE_ADDRESS3,
	SQ_JTF_RS_RESOURCE_EXTNS.SOURCE_ADDRESS4	   SOURCE_ADDRESS4
from	
( /* Subselect from SDE_ORA_EmployeeDimension_NonEmployee.W_EMPLOYEE_DS_SQ_JTF_RS_RESOURCE_EXTNS
*/


select 
	   

	   
	   JTF.RESOURCE_ID RESOURCE_ID,
	JTF.START_DATE_ACTIVE START_DATE_ACTIVE,
	JTF.END_DATE_ACTIVE END_DATE_ACTIVE,
	JTF.PRIMARY_LANGUAGE PRIMARY_LANGUAGE,
	JTF.SECONDARY_LANGUAGE SECONDARY_LANGUAGE,
	JTF.SOURCE_NAME SOURCE_NAME,
	JTF.SOURCE_NUMBER SOURCE_NUMBER,
	JTF.SOURCE_JOB_TITLE SOURCE_JOB_TITLE,
	JTF.SOURCE_EMAIL SOURCE_EMAIL,
	JTF.SOURCE_PHONE SOURCE_PHONE,
	SLS.RESOURCE_ID RESOURCE_ID1,
	JTF.SOURCE_CITY SOURCE_CITY,
	JTF.SOURCE_POSTAL_CODE SOURCE_POSTAL_CODE,
	JTF.SOURCE_STATE SOURCE_STATE,
	JTF.SOURCE_COUNTY SOURCE_COUNTY,
	JTF.SOURCE_COUNTRY SOURCE_COUNTRY,
	JTF.SOURCE_FIRST_NAME SOURCE_FIRST_NAME,
	JTF.SOURCE_MIDDLE_NAME SOURCE_MIDDLE_NAME,
	JTF.SOURCE_LAST_NAME SOURCE_LAST_NAME,
	JTF.USER_NAME USER_NAME,
	JTF.SOURCE_MOBILE_PHONE SOURCE_MOBILE_PHONE,
	JTF.SOURCE_PAGER SOURCE_PAGER,
	
'N'
 DELETE_FLG,
	
JTF.LAST_UPDATE_DATE
 LAST_UPDATE_DATE,
	JTF.SOURCE_ADDRESS4 SOURCE_ADDRESS4,
	JTF.SOURCE_ADDRESS3 SOURCE_ADDRESS3,
	JTF.SOURCE_ADDRESS2 SOURCE_ADDRESS2,
	JTF.SOURCE_ADDRESS1 SOURCE_ADDRESS1
from	"PC_FIVETRAN_DB"."ERPPRD_JTF"."JTF_RS_RESOURCE_EXTNS"    JTF LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension_NonEmployee.W_EMPLOYEE_DS_JTF_RS_RESOURCE_EXTNS.SLS
*/


select 
	   

	   DISTINCT
	   JTF_RS_SALESREPS.RESOURCE_ID RESOURCE_ID
from	"PC_FIVETRAN_DB"."ERPPRD_JTF"."JTF_RS_SALESREPS"   JTF_RS_SALESREPS
where	(1=1)








)    SLS ON JTF.RESOURCE_ID=SLS.RESOURCE_ID
where	(1=1)

And (JTF.CATEGORY<>'EMPLOYEE')
 And (



    (JTF.LAST_UPDATE_DATE>=TO_DATE(SUBSTR('2002-01-23 11:47:03',0,19),'YYYY-MM-DD HH24:MI:SS'))


)







)   SQ_JTF_RS_RESOURCE_EXTNS
where	(1=1)

)
)
SELECT * FROM EMPLOYEE



 







 

