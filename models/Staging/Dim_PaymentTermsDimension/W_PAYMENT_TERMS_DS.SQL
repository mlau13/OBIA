{{ config (
    materialized="table"
)}}


WITH PAYMENTTERM AS
(


select	
	
	COALESCE(TO_CHAR(SQ_BCI_TERMS_PAYMENT.X_TERM_NAME),'__UNASSIGNED__')	   C1_PAYMENT_TERM_CODE,
	MAX(
	CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=1 THEN TO_CHAR(COALESCE(SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT,SQ_BCI_TERMS_PAYMENT.BASE_AMOUNT))||(CASE
WHEN SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT IS NULL THEN ''
ELSE '%'
END )||' Due '||(CASE
WHEN 
		SQ_BCI_TERMS_PAYMENT.DUE_DAYS IS NULL THEN 
		'on day '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAY_OF_MONTH)||' after month '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_MONTHS_FORWARD)
ELSE 
		'in '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAYS)||' days'
	
END )
ELSE NULL
END
)	   C2_CONDITION_1_TEXT,
	MAX(
	CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=2 THEN TO_CHAR(COALESCE(SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT,SQ_BCI_TERMS_PAYMENT.BASE_AMOUNT))||(CASE
WHEN SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT IS NULL THEN ''
ELSE '%'
END )||' Due '||(CASE
WHEN 
		SQ_BCI_TERMS_PAYMENT.DUE_DAYS IS NULL THEN 
		'on day '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAY_OF_MONTH)||' after month '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_MONTHS_FORWARD)
ELSE 
		'in '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAYS)||' days'
	
END )
ELSE NULL
END
)	   C3_CONDITION_2_TEXT,
	MAX(
	CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=3 THEN TO_CHAR(COALESCE(SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT,SQ_BCI_TERMS_PAYMENT.BASE_AMOUNT))||(CASE
WHEN SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT IS NULL THEN ''
ELSE '%'
END )||' Due '||(CASE
WHEN 
		SQ_BCI_TERMS_PAYMENT.DUE_DAYS IS NULL THEN 
		'on day '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAY_OF_MONTH)||' after month '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_MONTHS_FORWARD)
ELSE 
		'in '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAYS)||' days'
	
END )
ELSE NULL
END
)	   C4_CONDITION_3_TEXT,
	MAX(
	CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=4 THEN TO_CHAR(COALESCE(SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT,SQ_BCI_TERMS_PAYMENT.BASE_AMOUNT))||(CASE
WHEN SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT IS NULL THEN ''
ELSE '%'
END )||' Due '||(CASE
WHEN 
		SQ_BCI_TERMS_PAYMENT.DUE_DAYS IS NULL THEN 
		'on day '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAY_OF_MONTH)||' after month '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_MONTHS_FORWARD)
ELSE 
		'in '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAYS)||' days'
	
END )
ELSE NULL
END
)	   C5_CONDITION_4_TEXT,
	MAX(
	CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=5 THEN TO_CHAR(COALESCE(SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT,SQ_BCI_TERMS_PAYMENT.BASE_AMOUNT))||(CASE
WHEN SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT IS NULL THEN ''
ELSE '%'
END )||' Due '||(CASE
WHEN 
		SQ_BCI_TERMS_PAYMENT.DUE_DAYS IS NULL THEN 
		'on day '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAY_OF_MONTH)||' after month '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_MONTHS_FORWARD)
ELSE 
		'in '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAYS)||' days'
	
END )
ELSE NULL
END
)	   C6_CONDITION_5_TEXT,
	MAX(
	CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=6 THEN TO_CHAR(COALESCE(SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT,SQ_BCI_TERMS_PAYMENT.BASE_AMOUNT))||(CASE
WHEN SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT IS NULL THEN ''
ELSE '%'
END )||' Due '||(CASE
WHEN 
		SQ_BCI_TERMS_PAYMENT.DUE_DAYS IS NULL THEN 
		'on day '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAY_OF_MONTH)||' after month '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_MONTHS_FORWARD)
ELSE 
		'in '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAYS)||' days'
	
END )
ELSE NULL
END
)	   C7_CONDITION_6_TEXT,
	MAX(
	CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=7 THEN TO_CHAR(COALESCE(SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT,SQ_BCI_TERMS_PAYMENT.BASE_AMOUNT))||(CASE
WHEN SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT IS NULL THEN ''
ELSE '%'
END )||' Due '||(CASE
WHEN 
		SQ_BCI_TERMS_PAYMENT.DUE_DAYS IS NULL THEN 
		'on day '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAY_OF_MONTH)||' after month '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_MONTHS_FORWARD)
ELSE 
		'in '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAYS)||' days'
	
END )
ELSE NULL
END
)	   C8_CONDITION_7_TEXT,
	MAX(
	CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=8 THEN TO_CHAR(COALESCE(SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT,SQ_BCI_TERMS_PAYMENT.BASE_AMOUNT))||(CASE
WHEN SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT IS NULL THEN ''
ELSE '%'
END )||' Due '||(CASE
WHEN 
		SQ_BCI_TERMS_PAYMENT.DUE_DAYS IS NULL THEN 
		'on day '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAY_OF_MONTH)||' after month '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_MONTHS_FORWARD)
ELSE 
		'in '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAYS)||' days'
	
END )
ELSE NULL
END
)	   C9_CONDITION_8_TEXT,
	MAX(
	CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=9 THEN TO_CHAR(COALESCE(SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT,SQ_BCI_TERMS_PAYMENT.BASE_AMOUNT))||(CASE
WHEN SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT IS NULL THEN ''
ELSE '%'
END )||' Due '||(CASE
WHEN 
		SQ_BCI_TERMS_PAYMENT.DUE_DAYS IS NULL THEN 
		'on day '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAY_OF_MONTH)||' after month '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_MONTHS_FORWARD)
ELSE 
		'in '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAYS)||' days'
	
END )
ELSE NULL
END
)	   C10_CONDITION_9_TEXT,
	MAX(
	CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=10 THEN TO_CHAR(COALESCE(SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT,SQ_BCI_TERMS_PAYMENT.BASE_AMOUNT))||(CASE
WHEN SQ_BCI_TERMS_PAYMENT.RELATIVE_AMOUNT IS NULL THEN ''
ELSE '%'
END )||' Due '||(CASE
WHEN 
		SQ_BCI_TERMS_PAYMENT.DUE_DAYS IS NULL THEN 
		'on day '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAY_OF_MONTH)||' after month '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_MONTHS_FORWARD)
ELSE 
		'in '||TO_CHAR(SQ_BCI_TERMS_PAYMENT.DUE_DAYS)||' days'
	
END )
ELSE NULL
END
)	   C11_CONDITION_10_TEXT,
	SQ_BCI_TERMS_PAYMENT.CREATED_BY	   C12_CREATED_BY_ID,
	SQ_BCI_TERMS_PAYMENT.LAST_UPDATED_BY	   C13_CHANGED_BY_ID,
	SQ_BCI_TERMS_PAYMENT.CREATION_DATE	   C14_CREATED_ON_DT,
	MAX(CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=1 THEN SQ_BCI_TERMS_PAYMENT.LAST_UPDATE_DATE
ELSE TO_DATE(SUBSTR('2002-01-26 20:32:20',0,19),'YYYY-MM-DD HH24:MI:SS')
END)	   C15_CHANGED_ON_DT,
	MAX(CASE
WHEN SQ_BCI_TERMS_PAYMENT.SEQUENCE_NUM=1 THEN SQ_BCI_TERMS_PAYMENT.LAST_UPDATE_DATE1
ELSE TO_DATE(SUBSTR('2002-01-26 20:32:20',0,19),'YYYY-MM-DD HH24:MI:SS')
END)	   C16_AUX1_CHANGED_ON_DT,
	SQ_BCI_TERMS_PAYMENT.DELETE_FLG	   C17_DELETE_FLG,
	TO_CHAR(SQ_BCI_TERMS_PAYMENT.TERM_ID)	   C18_INTEGRATION_ID,
	'0'	   C19_X_CUSTOM
from	
( /* Subselect from SDE_ORA_PaymentTermsDimension.W_PAYMENT_TERMS_DS_SQ_BCI_TERMS_PAYMENT
*/


select 
	   

	   
	   RA_TERMS.TERM_ID TERM_ID,
	RA_TERMS_LINES.DUE_DATE DUE_DATE,
	RA_TERMS_LINES.RELATIVE_AMOUNT RELATIVE_AMOUNT,
	RA_TERMS_LINES.DUE_DAY_OF_MONTH DUE_DAY_OF_MONTH,
	RA_TERMS_LINES.DUE_DAYS DUE_DAYS,
	RA_TERMS.BASE_AMOUNT BASE_AMOUNT,
	RA_TERMS.CREATED_BY CREATED_BY,
	RA_TERMS.CREATION_DATE CREATION_DATE,
	RA_TERMS_LINES.SEQUENCE_NUM SEQUENCE_NUM,
	RA_TERMS.LAST_UPDATED_BY LAST_UPDATED_BY,
	
RA_TERMS.LAST_UPDATE_DATE
 LAST_UPDATE_DATE,
	RA_TERMS_LINES.DUE_MONTHS_FORWARD DUE_MONTHS_FORWARD,
	RA_TERMS_LINES.LAST_UPDATE_DATE LAST_UPDATE_DATE1,
	
'N'
 DELETE_FLG,
	RA_TERMS.NAME X_TERM_NAME
from	"PC_FIVETRAN_DB"."ERPPRD_AR"."RA_TERMS_LINES"   RA_TERMS_LINES, (SELECT  B.TERM_ID, B.LAST_UPDATE_DATE, B.LAST_UPDATED_BY, B.CREATION_DATE, B.CREATED_BY, B.LAST_UPDATE_LOGIN, B.CREDIT_CHECK_FLAG, B.DUE_CUTOFF_DAY, B.PRINTING_LEAD_DAYS, B.START_DATE_ACTIVE, B.END_DATE_ACTIVE, B.ATTRIBUTE_CATEGORY, B.ATTRIBUTE1, B.ATTRIBUTE2, B.ATTRIBUTE3, B.ATTRIBUTE4, B.ATTRIBUTE5, B.ATTRIBUTE6, B.ATTRIBUTE7, B.ATTRIBUTE8, B.ATTRIBUTE9, B.ATTRIBUTE10, B.BASE_AMOUNT, B.CALC_DISCOUNT_ON_LINES_FLAG, B.FIRST_INSTALLMENT_CODE, B.IN_USE, B.PARTIAL_DISCOUNT_FLAG, B.ATTRIBUTE11, B.ATTRIBUTE12, B.ATTRIBUTE13, B.ATTRIBUTE14, B.ATTRIBUTE15, T.NAME, T.DESCRIPTION, NVL(B.PREPAYMENT_FLAG,'N'), B.billing_cycle_id, BC.cycle_name 
from "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_TERMS_TL" T, "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_TERMS_B" B , 
"PC_FIVETRAN_DB"."ERPPRD_AR"."AR_CONS_BILL_CYCLES_TL" BC WHERE B.TERM_ID = T.TERM_ID AND B.billing_cycle_id = BC.billing_cycle_id(+))  RA_TERMS
where	(1=1)
 And (RA_TERMS_LINES.TERM_ID=RA_TERMS.TERM_ID)

And (RA_TERMS_LINES.RELATIVE_AMOUNT<>0)
 And (

(RA_TERMS.LAST_UPDATE_DATE >= TO_DATE(SUBSTR('2002-01-26 20:32:20',0,19),'YYYY-MM-DD HH24:MI:SS') OR 
 RA_TERMS_LINES.LAST_UPDATE_DATE >= TO_DATE(SUBSTR('2002-01-26 20:32:20',0,19),'YYYY-MM-DD HH24:MI:SS'))

)







)   SQ_BCI_TERMS_PAYMENT
where	(1=1)



Group By COALESCE(TO_CHAR(SQ_BCI_TERMS_PAYMENT.X_TERM_NAME),'__UNASSIGNED__'),
 SQ_BCI_TERMS_PAYMENT.CREATED_BY,
 SQ_BCI_TERMS_PAYMENT.LAST_UPDATED_BY,
 SQ_BCI_TERMS_PAYMENT.CREATION_DATE,
 SQ_BCI_TERMS_PAYMENT.DELETE_FLG,
 TO_CHAR(SQ_BCI_TERMS_PAYMENT.TERM_ID)
),

PAYMENTTERMTOTAL AS
(
select	
	PAYMENT_TERM_CODE,
	CONDITION_1_TEXT,
	CONDITION_2_TEXT,
	CONDITION_3_TEXT,
	CONDITION_4_TEXT,
	CONDITION_5_TEXT,
	CONDITION_6_TEXT,
	CONDITION_7_TEXT,
	CONDITION_8_TEXT,
	CONDITION_9_TEXT,
	CONDITION_10_TEXT,
	CREATED_BY_ID,
	CHANGED_BY_ID,
	CREATED_ON_DT,
	CHANGED_ON_DT,
	AUX1_CHANGED_ON_DT,
	SRC_EFF_FROM_DT,
	DELETE_FLG,
	DATASOURCE_NUM_ID,
	INTEGRATION_ID,
	to_varchar(CURRENT_TIMESTAMP, 'yyyy-MM-DD hh:mi:ss') LAST_DATE
FROM (	


select 	
	
	C1_PAYMENT_TERM_CODE PAYMENT_TERM_CODE,
	C2_CONDITION_1_TEXT CONDITION_1_TEXT,
	C3_CONDITION_2_TEXT CONDITION_2_TEXT,
	C4_CONDITION_3_TEXT CONDITION_3_TEXT,
	C5_CONDITION_4_TEXT CONDITION_4_TEXT,
	C6_CONDITION_5_TEXT CONDITION_5_TEXT,
	C7_CONDITION_6_TEXT CONDITION_6_TEXT,
	C8_CONDITION_7_TEXT CONDITION_7_TEXT,
	C9_CONDITION_8_TEXT CONDITION_8_TEXT,
	C10_CONDITION_9_TEXT CONDITION_9_TEXT,
	C11_CONDITION_10_TEXT CONDITION_10_TEXT,
	C12_CREATED_BY_ID CREATED_BY_ID,
	C13_CHANGED_BY_ID CHANGED_BY_ID,
	C14_CREATED_ON_DT CREATED_ON_DT,
	C15_CHANGED_ON_DT CHANGED_ON_DT,
	C16_AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
	TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS') SRC_EFF_FROM_DT,
	C17_DELETE_FLG DELETE_FLG,
	380 DATASOURCE_NUM_ID,
	C18_INTEGRATION_ID INTEGRATION_ID,
	C19_X_CUSTOM X_CUSTOM 
from	PAYMENTTERM
where		(1=1)	


)    ODI_GET_FROM

)

SELECT * FROM PAYMENTTERMTOTAL