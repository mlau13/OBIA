{{ config (
    materialized="table"
)}}
WITH LKP_INSTALL_CUSTOMER AS(
    select	
	DISTINCT
	LKP_HZ_CUST_ACCT_SITES_ALL.CUST_ACCOUNT_ID	   C4_X_INSTALL_CUSTOMER_ID,
	LKP_HZ_CUST_ACCT_SITES_ALL.CUST_ACCT_SITE_ID	   C5_X_INSTALL_CUSTOMER_LOC_ID,
	LKP_HZ_CUST_ACCT_SITES_ALL.SYSTEM_ID	   C10_SYSTEM_ID,
	LKP_HZ_CUST_ACCT_SITES_ALL.LKP_ACTIVE	   C11_LKP_ACTIVE
from	
( /* Subselect from SDE_ORA_SalesOrderLinesFact.W_SALES_ORDER_LINE_FS_SQ_LKP_INSTALL_CUSTOMER
*/


select 
	   

	   
	   HZ_CUST_ACCT_SITES_ALL.CUST_ACCT_SITE_ID CUST_ACCT_SITE_ID,
	HZ_CUST_ACCT_SITES_ALL.CUST_ACCOUNT_ID CUST_ACCOUNT_ID,
	CSI_SYSTEMS_VL.SYSTEM_ID SYSTEM_ID,
	ROW_NUMBER()OVER (PARTITION BY CSI_SYSTEMS_VL.SYSTEM_ID ORDER BY HZ_CUST_ACCT_SITES_ALL.LAST_UPDATE_DATE DESC) LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD1_AR"."HZ_CUST_ACCT_SITES_ALL"   HZ_CUST_ACCT_SITES_ALL, "PC_FIVETRAN_DB"."ERPPRD1_CSI"."CSI_SYSTEMS_VL"   CSI_SYSTEMS_VL
where	(1=1)
 And (CSI_SYSTEMS_VL.INSTALL_SITE_USE_ID = HZ_CUST_ACCT_SITES_ALL.PARTY_SITE_ID)








)   LKP_HZ_CUST_ACCT_SITES_ALL
where	(1=1)

),

LKP_EMPL_SALESREP_PERSON_ID as
(
 select	
	DISTINCT
	LKP_EMPL_SALESREP_PERSON_ID.PERSON_ID	   C6_PERSON_ID,
	LKP_EMPL_SALESREP_PERSON_ID.SALESREP_ID	   C7_SALESREP_ID,
	LKP_EMPL_SALESREP_PERSON_ID.LKP_ACTIVE	   C8_LKP_ACTIVE
from	
( /* Subselect from LKP_EMPL_SALESREP_PERSON_ID
*/


select 
	   

	   
	   DECODE(ROW_NUMBER() OVER (PARTITION BY SR.SALESREP_ID ORDER BY RES.SOURCE_ID),1,1,0) LKP_ACTIVE,
	RES.SOURCE_ID PERSON_ID,
	SR.SALESREP_ID SALESREP_ID
from	"PC_FIVETRAN_DB"."ERPPRD1_JTF"."JTF_RS_SALESREPS"    SR,"PC_FIVETRAN_DB"."ERPPRD1_JTF"."JTF_RS_RESOURCE_EXTNS"   RES
where	(1=1)
 And (SR.RESOURCE_ID=RES.RESOURCE_ID)

And (RES.CATEGORY='EMPLOYEE')







)   LKP_EMPL_SALESREP_PERSON_ID
where	(1=1)   
),

OKC_K_HEADERS_LKP AS 
(
select	
	DISTINCT
	TRIM("MAX"(OKC_K_HEADERS_LKP.CONTRACT_NUMBER)OVER (PARTITION BY OKC_K_HEADERS_LKP.ORDER_NUMBER ))	   C1_X_SIMPLIFIED_CONTRACT_NUMBE,
	"MAX"(OKC_K_HEADERS_LKP.START_DATE) OVER(PARTITION BY OKC_K_HEADERS_LKP.ORDER_NUMBER)	   C2_X_CONTRACT_START_DATE,
	"MAX"(OKC_K_HEADERS_LKP.END_DATE)OVER(PARTITION BY OKC_K_HEADERS_LKP.ORDER_NUMBER )	   C3_X_CONTRACT_END_DATE,
	OKC_K_HEADERS_LKP.ORDER_NUMBER	   C9_ORDER_NUMBER
from	
( /* Subselect from SDE_ORA_SalesOrderLinesFact.W_SALES_ORDER_LINE_FS_SQ_OKC_K_HEADERS_LKP
*/
SELECT  distinct  OKC_K_HEADERS_ALL_B.CONTRACT_NUMBER AS CONTRACT_NUMBER,  
OKC_K_HEADERS_ALL_B.START_DATE AS START_DATE,  OKC_K_HEADERS_ALL_B.END_DATE AS END_DATE,  
OE_ORDER_HEADERS_ALL.ORDER_NUMBER AS ORDER_NUMBER 
FROM "PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_HEADERS_ALL_B", 
   "PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_ITEMS",
  "PC_FIVETRAN_DB"."ERPPRD1_ONT"."OE_ORDER_HEADERS_ALL", 
  "PC_FIVETRAN_DB"."ERPPRD1_ONT"."OE_ORDER_LINES_ALL", 
  "PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_LINES_B"
WHERE OKC_K_ITEMS.JTOT_OBJECT1_CODE = 'OKX_CUSTPROD'
       AND OKC_K_ITEMS.OBJECT1_ID1 = OE_ORDER_LINES_ALL.SERVICE_REFERENCE_LINE_ID 
       AND OKC_K_ITEMS.DNZ_CHR_ID = OKC_K_HEADERS_ALL_B.ID
       AND OKC_K_LINES_B.DNZ_CHR_ID  = OKC_K_HEADERS_ALL_B.ID
       AND OKC_K_LINES_B.ID = OKC_K_ITEMS.CLE_ID
       AND OKC_K_LINES_B.LSE_ID=9
       AND OE_ORDER_LINES_ALL.SERVICE_REFERENCE_TYPE_CODE = 'CUSTOMER_PRODUCT'
       AND OE_ORDER_HEADERS_ALL.HEADER_ID = OE_ORDER_LINES_ALL.HEADER_ID
       AND (TO_DATE(OE_ORDER_LINES_ALL.SERVICE_START_DATE)=TO_DATE(OKC_K_HEADERS_ALL_B.START_DATE) OR TO_DATE(OE_ORDER_LINES_ALL.SERVICE_START_DATE)=TO_DATE(OKC_K_LINES_B.START_DATE))
       AND (TO_DATE(OE_ORDER_LINES_ALL.SERVICE_END_DATE)=TO_DATE(OKC_K_HEADERS_ALL_B.END_DATE) OR TO_DATE(OE_ORDER_LINES_ALL.SERVICE_END_DATE)=TO_DATE(OKC_K_LINES_B.END_DATE))
UNION
SELECT  DISTINCT OKC_K_HEADERS_ALL_B.CONTRACT_NUMBER as CONTRACT_NUMBER, OKC_K_HEADERS_ALL_B.START_DATE as START_DATE, OKC_K_HEADERS_ALL_B.END_DATE as END_DATE, OE_ORDER_HEADERS_ALL.ORDER_NUMBER as ORDER_NUMBER
FROM  "PC_FIVETRAN_DB"."ERPPRD1_ONT"."OE_ORDER_LINES_ALL"
   ,"PC_FIVETRAN_DB"."ERPPRD1_CSI"."CSI_ITEM_INSTANCES"
   ,"PC_FIVETRAN_DB"."ERPPRD1_ONT"."OE_ORDER_HEADERS_ALL"
   ,"PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_ITEMS"
   ,"PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_HEADERS_ALL_B"
   ,"PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_LINES_B"
WHERE  OE_ORDER_LINES_ALL.HEADER_ID = OE_ORDER_HEADERS_ALL.HEADER_ID
       AND SERVICE_REFERENCE_LINE_ID = CSI_ITEM_INSTANCES.LAST_OE_ORDER_LINE_ID
       AND OE_ORDER_LINES_ALL.SERVICE_REFERENCE_TYPE_CODE = 'ORDER'
       AND OKC_K_ITEMS.JTOT_OBJECT1_CODE = 'OKX_CUSTPROD'
       AND OKC_K_ITEMS.OBJECT1_ID1 = CSI_ITEM_INSTANCES.INSTANCE_ID
       AND OKC_K_HEADERS_ALL_B.ID = OKC_K_ITEMS.DNZ_CHR_ID
       AND OKC_K_LINES_B.ID = OKC_K_ITEMS.CLE_ID          
       AND OKC_K_LINES_B.LSE_ID=9
       AND (TO_DATE(OE_ORDER_LINES_ALL.SERVICE_START_DATE)=TO_DATE(OKC_K_HEADERS_ALL_B.START_DATE) OR TO_DATE(OE_ORDER_LINES_ALL.SERVICE_START_DATE)=TO_DATE(OKC_K_LINES_B.START_DATE))
       AND (TO_DATE(OE_ORDER_LINES_ALL.SERVICE_END_DATE)=TO_DATE(OKC_K_HEADERS_ALL_B.END_DATE) OR TO_DATE(OE_ORDER_LINES_ALL.SERVICE_END_DATE)=TO_DATE(OKC_K_LINES_B.END_DATE))
UNION
SELECT  DISTINCT OKC_K_HEADERS_ALL_B.CONTRACT_NUMBER as CONTRACT_NUMBER, OKC_K_HEADERS_ALL_B.START_DATE as START_DATE, OKC_K_HEADERS_ALL_B.END_DATE as END_DATE, OE_ORDER_HEADERS_ALL.ORDER_NUMBER as ORDER_NUMBER
  FROM "PC_FIVETRAN_DB"."ERPPRD1_ONT"."OE_ORDER_LINES_ALL",
       "PC_FIVETRAN_DB"."ERPPRD1_ONT"."OE_ORDER_HEADERS_ALL",
       "PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_ITEMS",
       "PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_HEADERS_ALL_B",
       "PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_LINES_B",
       "PC_FIVETRAN_DB"."ERPPRD1_CSI"."CSI_T_TRANSACTION_LINES",
       "PC_FIVETRAN_DB"."ERPPRD1_CSI"."CSI_T_TXN_LINE_DETAILS",
       "PC_FIVETRAN_DB"."ERPPRD1_CSI"."CSI_ITEM_INSTANCES",
       "PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_REL_OBJS"  REL
 WHERE     CSI_T_TRANSACTION_LINES.TRANSACTION_LINE_ID =
              CSI_T_TXN_LINE_DETAILS.TRANSACTION_LINE_ID
       AND CSI_T_TRANSACTION_LINES.SOURCE_TRANSACTION_TABLE =
              'OE_ORDER_LINES_ALL'
       AND CSI_T_TXN_LINE_DETAILS.INSTANCE_ID =
              CSI_ITEM_INSTANCES.INSTANCE_ID
       AND CSI_T_TRANSACTION_LINES.SOURCE_TRANSACTION_ID =
              OE_ORDER_LINES_ALL.LINE_ID
       AND OKC_K_ITEMS.JTOT_OBJECT1_CODE = 'OKX_CUSTPROD'
       AND OKC_K_ITEMS.OBJECT1_ID1 = CSI_ITEM_INSTANCES.INSTANCE_ID
       AND OKC_K_HEADERS_ALL_B.ID = OKC_K_ITEMS.DNZ_CHR_ID
       AND OKC_K_LINES_B.ID = OKC_K_ITEMS.CLE_ID
       AND OE_ORDER_LINES_ALL.HEADER_ID = OE_ORDER_HEADERS_ALL.HEADER_ID
       AND REL.CHR_ID = OKC_K_HEADERS_ALL_B.ID
       AND REL.JTOT_OBJECT1_CODE = 'OKX_ORDERHEAD'
       AND REL.OBJECT1_ID1 = OE_ORDER_HEADERS_ALL.HEADER_ID

)   OKC_K_HEADERS_LKP
where	(1=1)
),

FINAL_SALES_ORDER_LINE_OM_TOTAL AS
(
select	
	CHNL_TYPE_ID,
	CUSTOMER_BILL_TO_LOC_ID,
	CUSTOMER_CNTCT_ID,
	CUSTOMER_SHIP_TO_LOC_ID,
	CUSTOMER_ACCOUNT_ID,
	FREIGHT_TERMS_ID,
	INVENTORY_ORG_ID,
	INVENTORY_PRODUCT_ID,
	OPERATING_UNIT_ORG_ID,
	ORDER_FULFILL_BU_ID,
	ORDER_STATUS_ID,
	PAYMENT_METHOD_ID,
	PAYMENT_TERMS_ID,
	PLANT_LOC_ID,
	PRODUCT_ID,
	SALES_ORG_ID,
	SALES_PRODUCT_ID,
	SALES_REP_ID,
	TERR_ID,
	XACT_TYPE_ID,
	ORDER_SOURCE_ID,
	PROJECT_ID,
	TASK_ID,
	HEADER_STATUS_ID,
	BOOKED_ON_DT,
	CLOSED_ON_DT,
	ENTERED_ON_DT,
	ORDER_ACKNOWLEDGED_DT,
	ORDERED_ON_DT,
	PROMISED_ON_DT,
	REQUIRED_BY_DT,
	FULFILLED_ON_DT,
	COST_AMT,
	NET_AMT,
	LIST_AMT,
	DISCOUNT_AMT,
	CANCELLED_AMT,
	SALES_QTY,
	ORDERED_QTY,
	CANCELLED_QTY,
	TOTAL_SHIPPED_QTY,
	TOTAL_INVOICED_QTY,
	SALES_UOM_CODE,
	SALES_ORDER_NUM,
	SALES_ORDER_ITEM,
	SALES_ORDER_ITEM_DETAIL_NUM,
	REF_DOC_NUM,
	PURCH_ORDER_NUM,
	FULFILL_ORDER_NUM,
	FULFILL_ORDER_LINE_NUM,
	FULFILL_LINE_NUM,
	ITEM_TYPE_CODE,
	SERVICE_FLG,
	PARTIAL_SHIPMENTS_ALLOWED_FLG,
	BOOKING_FLG,
	FULFILLED_FLG,
	FIN_BACKLOG_FLG,
	SCHEDULED_FLG,
	OPR_BACKLOG_FLG,
	SHIPPABLE_FLG,
	BILLING_FLG,
	INVOICE_INTERFACED_FLG,
	SHIPPING_INTERFACED_FLG,
	SALES_ORDER_HD_ID,
	SALES_ORDER_LN_ID,
	BOOKING_ID,
	FULFILL_ORDER_ID,
	FULFILL_ORDER_LINE_ID,
	DELETE_FLG,
	DOC_CURR_CODE,
	LOC_CURR_CODE,
	LOC_EXCH_RATE_TYPE,
	LOC_EXCHANGE_RATE,
	EXCHANGE_DT,
	CREATED_BY_ID,
	CHANGED_BY_ID,
	CREATED_ON_DT,
	CHANGED_ON_DT,
	AUX1_CHANGED_ON_DT,
	AUX3_CHANGED_ON_DT,
	AUX4_CHANGED_ON_DT,
	DATASOURCE_NUM_ID,
	INTEGRATION_ID,
	SALES_ORDLN_ID,
	SCH_STATUS_ID,
	PLAN_AVAIL_ON_DT,
	PLAN_PICK_ON_DT,
	PLAN_SHIP_DT,
	CONFIRMED_BASE_QTY,
	CONFIRMED_QTY,
	BASE_UOM_CODE,
	SALES_SCH_ITEM,
	ROOT_PROD_LINE_ID,
	RETURN_REASON_ID,
	X_CUSTOM,
	X_PRICING_ATTRIBUTE28,
	X_SERVICE_START_DATE,
	X_SERVICE_END_DATE,
	X_SERVICE_REFERENCE_TYPE_CODE,
	X_SERVICE_REFERENCE_LINE_ID,
	X_LICENSE_ID,
	X_ORDER_SOURCE,
	X_SIMPLIFIED_CONTRACT_NUMBER,
	X_COVERED_INVENTORY_ITEM_ID,
	X_SOB_ID,
	X_CREDIT_PERCENTAGE,
	X_SALES_CREDIT_ID,
	X_PRICING_ATTRIBUTE25,
	X_LINE_STATUS,
	X_SALES_CHANNEL_CODE,
	X_BILL_TO_CUSTOMER_ID,
	X_SHIP_TO_CUSTOMER_ID,
	X_SOLD_TO_CUSTOMER_ID,
	X_ACTUAL_SHIPMENT_DT,
	X_ORDER_STATUS,
	X_TAX_CODE,
	X_SALESREP_ID,
	X_INV_NUMBER,
	X_INV_LINE_NUM,
	X_INV_DT,
	X_SALES_SPLIT_LINE_WID,
	X_SERVICE_ITEM_FLAG,
	X_REVN_TYPE_PRODUCT_ID,
	X_APPLICATION_CODE,
	X_CONTRACT_START_DATE,
	X_CONTRACT_END_DATE,
	X_REFERENCE_NUMBER,
	X_SOLD_TO_CONTACT_ID,
	X_SHIP_TO_CONTACT_ID,
	X_INVOICE_TO_CONTACT_ID,
	X_INSTALL_CUSTOMER_ID,
	X_INSTALL_CUSTOMER_LOC_ID,
	X_INTERFACE_LINE_ATTRIBUTE6,
	X_CUSTOMER_TRX_ID,
	X_CUSTOMER_TRX_LINE_ID,
	X_PR_CUSTOMER_TRX_LINE_ID,
	X_UNIT_CONTRACT_PRICE,
	X_UNIT_SELLING_PRICE,
	X_SFDC_QUANTITY,
	X_UNIT_LIST_PRICE,
	X_SERVICE_PERCENTAGE,
	AUX5_CHANGED_ON_DT,
	X_ATTRIBUTE10,
	X_ATTRIBUTE11,
	X_ATTRIBUTE12
	,'N',
	'DEFAULT'
FROM (	


select 	
	DISTINCT
	'SALES_CHANNEL'||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.SALES_CHANNEL_CODE) CHNL_TYPE_ID,
	LKP_W_CUST_LOC_USE_PS_INVC_TO.ACCT_SITE_ID CUSTOMER_BILL_TO_LOC_ID,
	LKP_PARTY_CONTACT_CUST_CONTACT.CONTACT_PARTY_ID CUSTOMER_CNTCT_ID,
	LKP_W_CUST_LOC_USE_PS_SHP_TO.ACCT_SITE_ID CUSTOMER_SHIP_TO_LOC_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.SOLD_TO_ORG_ID) CUSTOMER_ACCOUNT_ID,
	COALESCE(SQ_BCI_SALES_ORDLNS.FREIGHT_TERMS_CODE,SQ_BCI_SALES_ORDLNS.FREIGHT_TERMS_CODE1) FREIGHT_TERMS_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIP_FROM_ORG_ID) INVENTORY_ORG_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.INVENTORY_ITEM_ID)||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIP_FROM_ORG_ID) INVENTORY_PRODUCT_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.ORG_ID1) OPERATING_UNIT_ORG_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.ORG_ID1) ORDER_FULFILL_BU_ID,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.FLOW_STATUS_CODE1='CLOSED' OR SQ_BCI_SALES_ORDLNS.FLOW_STATUS_CODE1='CANCELLED' THEN 
	'SALES_ORDER_PROCESS~'||SQ_BCI_SALES_ORDLNS.FLOW_STATUS_CODE1
ELSE 
	(CASE
WHEN 
		NOT SQ_BCI_SALES_ORDLNS.LINE_ID_ON_HOLD IS NULL THEN 
		'SALES_ORDER_PROCESS'||'~'||'BLOCKED'
ELSE 
		'SALES_ORDER_PROCESS~'||SQ_BCI_SALES_ORDLNS.FLOW_STATUS_CODE1
	
END )

END ) ORDER_STATUS_ID,
	'OM~'||SQ_BCI_SALES_ORDLNS.PAYMENT_TYPE_CODE PAYMENT_METHOD_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.PAYMENT_TERM_ID) PAYMENT_TERMS_ID,
	'PLANT'||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIP_FROM_ORG_ID) PLANT_LOC_ID,
	(CASE
WHEN SQ_BCI_SALES_ORDLNS.X_SERVICE_ITEM_FLAG='Y' THEN 
(CASE
WHEN SQ_BCI_SALES_ORDLNS.X_CVRD_INV_ITEM_ID IS NULL THEN TO_CHAR(SQ_BCI_SALES_ORDLNS.X_CVRD_INV_ITEM_ID2)
ELSE TO_CHAR(SQ_BCI_SALES_ORDLNS.X_CVRD_INV_ITEM_ID)
END )
ELSE TO_CHAR(SQ_BCI_SALES_ORDLNS.INVENTORY_ITEM_ID)
END ) PRODUCT_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.ORG_ID1) SALES_ORG_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.INVENTORY_ITEM_ID) ||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIP_FROM_ORG_ID) SALES_PRODUCT_ID,
	(CASE
WHEN C6_PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.RESOURCE_ID)
ELSE TO_CHAR(C6_PERSON_ID)
END ) SALES_REP_ID,
	LKP_W_CUST_LOC_USE_PS_SHP_TO.TERRITORY_ID TERR_ID,
	(CASE
WHEN SQ_BCI_SALES_ORDLNS.SOURCE_TYPE_CODE='INTERNAL' THEN (CASE
WHEN SQ_BCI_SALES_ORDLNS.ORDER_SOURCE_ID=10 THEN 'SALES_ORDLNS'||'~'||SQ_BCI_SALES_ORDLNS.LINE_CATEGORY_CODE||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.ORDER_TYPE_ID)||'~INTERNAL~SELF SHIP'
ELSE 'SALES_ORDLNS'||'~'||SQ_BCI_SALES_ORDLNS.LINE_CATEGORY_CODE||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.ORDER_TYPE_ID)||'~EXTERNAL~SELF SHIP'
END )
ELSE (CASE
WHEN SQ_BCI_SALES_ORDLNS.ORDER_SOURCE_ID=10 THEN 'SALES_ORDLNS'||'~'||SQ_BCI_SALES_ORDLNS.LINE_CATEGORY_CODE||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.ORDER_TYPE_ID)||'~INTERNAL~DROP SHIP'
ELSE 'SALES_ORDLNS'||'~'||SQ_BCI_SALES_ORDLNS.LINE_CATEGORY_CODE||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.ORDER_TYPE_ID)||'~EXTERNAL~DROP SHIP'
END )
END ) XACT_TYPE_ID,
	'SALES_ORDSRC~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.ORDER_SOURCE_ID) ORDER_SOURCE_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.PROJECT_ID) PROJECT_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.TASK_ID) TASK_ID,
	'SALES_CYCLE_HEADER_PROCESS~'||SQ_BCI_SALES_ORDLNS.HEADER_FLOW_STATUS_CODE HEADER_STATUS_ID,
	SQ_BCI_SALES_ORDLNS.BOOKED_DATE BOOKED_ON_DT,
	(CASE
WHEN SQ_BCI_SALES_ORDLNS.FLOW_STATUS_CODE1='CLOSED' THEN  SQ_BCI_SALES_ORDLNS.LAST_UPDATE_DATE
ELSE  NULL
END ) CLOSED_ON_DT,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.CREATED_ON_DT IS NULL THEN 
	SQ_BCI_SALES_ORDLNS.CREATION_DATE
ELSE 
	(CASE
WHEN 
		SQ_BCI_SALES_ORDLNS.CREATION_DATE < SQ_BCI_SALES_ORDLNS.CREATED_ON_DT THEN 
		SQ_BCI_SALES_ORDLNS.CREATION_DATE
ELSE 
		SQ_BCI_SALES_ORDLNS.CREATED_ON_DT
	
END )

END ) ENTERED_ON_DT,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.LAST_ACK_DATE1 IS NULL THEN 
	SQ_BCI_SALES_ORDLNS.LAST_ACK_DATE
ELSE 
	(CASE
WHEN 
		SQ_BCI_SALES_ORDLNS.LAST_ACK_DATE < SQ_BCI_SALES_ORDLNS.LAST_ACK_DATE1 THEN 
		SQ_BCI_SALES_ORDLNS.LAST_ACK_DATE
ELSE 
		SQ_BCI_SALES_ORDLNS.LAST_ACK_DATE1
	
END )

END ) ORDER_ACKNOWLEDGED_DT,
	SQ_BCI_SALES_ORDLNS.ORDERED_DATE ORDERED_ON_DT,
	SQ_BCI_SALES_ORDLNS.PROMISE_DATE PROMISED_ON_DT,
	SQ_BCI_SALES_ORDLNS.REQUEST_DATE1 REQUIRED_BY_DT,
	SQ_BCI_SALES_ORDLNS.FULFILLMENT_DATE FULFILLED_ON_DT,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY IS NULL THEN 
	0
ELSE 
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY

END )
*SQ_BCI_SALES_ORDLNS.UNIT_COST COST_AMT,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY IS NULL THEN 
	0
ELSE 
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY

END )
*SQ_BCI_SALES_ORDLNS.UNIT_SELLING_PRICE NET_AMT,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY IS NULL THEN 
	0
ELSE 
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY

END )*SQ_BCI_SALES_ORDLNS.UNIT_LIST_PRICE LIST_AMT,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY IS NULL THEN 
	0
ELSE 
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY

END )*(SQ_BCI_SALES_ORDLNS.UNIT_LIST_PRICE-SQ_BCI_SALES_ORDLNS.UNIT_SELLING_PRICE) DISCOUNT_AMT,
	(CASE
WHEN 
		SQ_BCI_SALES_ORDLNS.CANCELLED_QUANTITY IS NULL THEN 
		0
ELSE 
		SQ_BCI_SALES_ORDLNS.CANCELLED_QUANTITY

END )
*SQ_BCI_SALES_ORDLNS.UNIT_SELLING_PRICE CANCELLED_AMT,
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY SALES_QTY,
	(
	COALESCE(SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY,0) + COALESCE(SQ_BCI_SALES_ORDLNS.CANCELLED_QUANTITY,0) 

) ORDERED_QTY,
	SQ_BCI_SALES_ORDLNS.CANCELLED_QUANTITY CANCELLED_QTY,
	SQ_BCI_SALES_ORDLNS.SHIPPED_QUANTITY TOTAL_SHIPPED_QTY,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.INVOICED_QUANTITY >= 0 THEN 
	SQ_BCI_SALES_ORDLNS.INVOICED_QUANTITY
ELSE 
	-1.0*SQ_BCI_SALES_ORDLNS.INVOICED_QUANTITY

END ) TOTAL_INVOICED_QTY,
	COALESCE(SQ_BCI_SALES_ORDLNS.ORDER_QUANTITY_UOM ,'__UNASSIGNED__') SALES_UOM_CODE,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.ORDER_NUMBER) SALES_ORDER_NUM,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.LINE_NUMBER) SALES_ORDER_ITEM,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.COMPONENT_NUMBER IS NULL THEN 
	(CASE
WHEN 
		SQ_BCI_SALES_ORDLNS.OPTION_NUMBER IS NULL THEN 
		TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIPMENT_NUMBER)
ELSE 
		TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIPMENT_NUMBER)||'.'||TO_CHAR(SQ_BCI_SALES_ORDLNS.OPTION_NUMBER)
	
END )
ELSE 
	TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIPMENT_NUMBER)||'.'||TO_CHAR(SQ_BCI_SALES_ORDLNS.OPTION_NUMBER)||'.'||TO_CHAR(SQ_BCI_SALES_ORDLNS.COMPONENT_NUMBER)

END ) SALES_ORDER_ITEM_DETAIL_NUM,
	SQ_BCI_SALES_ORDLNS.X_QUOTE_NUMBER REF_DOC_NUM,
	SQ_BCI_SALES_ORDLNS.CUST_PO_NUMBER PURCH_ORDER_NUM,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.ORDER_NUMBER) FULFILL_ORDER_NUM,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.LINE_NUMBER) FULFILL_ORDER_LINE_NUM,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.LINE_NUMBER) FULFILL_LINE_NUM,
	COALESCE(SQ_BCI_SALES_ORDLNS.ITEM_TYPE_CODE,'__UNASSIGNED__') ITEM_TYPE_CODE,
	(CASE
WHEN SQ_BCI_SALES_ORDLNS.ITEM_TYPE_CODE = 'SERVICE' THEN 'Y'
ELSE 'N'
END ) SERVICE_FLG,
	SQ_BCI_SALES_ORDLNS.PARTIAL_SHIPMENTS_ALLOWED PARTIAL_SHIPMENTS_ALLOWED_FLG,
	COALESCE(SQ_BCI_SALES_ORDLNS.BOOKED_FLAG1,SQ_BCI_SALES_ORDLNS.BOOKED_FLAG) BOOKING_FLG,
	SQ_BCI_SALES_ORDLNS.FULFILLED_FLAG FULFILLED_FLG,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.OPEN_FLAG = 'Y' AND COALESCE(SQ_BCI_SALES_ORDLNS.CANCELLED_FLAG,SQ_BCI_SALES_ORDLNS.CANCELLED_FLAG1) = 'N' AND SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY > 0 THEN 
	'Y'
ELSE 
	'N'

END ) FIN_BACKLOG_FLG,
	(CASE
WHEN SQ_BCI_SALES_ORDLNS.SCHEDULE_STATUS_CODE='SCHEDULED' THEN 'Y'
ELSE 'N'
END ) SCHEDULED_FLG,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.OPEN_FLAG = 'Y' AND COALESCE(SQ_BCI_SALES_ORDLNS.CANCELLED_FLAG,SQ_BCI_SALES_ORDLNS.CANCELLED_FLAG1) = 'N' AND SQ_BCI_SALES_ORDLNS.SHIPPABLE_FLAG = 'Y' AND SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY > 0 THEN 
	'Y'
ELSE 
	'N'

END ) OPR_BACKLOG_FLG,
	(CASE
WHEN 
	COALESCE(SQ_BCI_SALES_ORDLNS.CANCELLED_FLAG,SQ_BCI_SALES_ORDLNS.CANCELLED_FLAG1) = 'N' AND SQ_BCI_SALES_ORDLNS.SHIPPABLE_FLAG = 'Y' THEN 
	'Y'
ELSE 
	'N'

END ) SHIPPABLE_FLG,
	(CASE
WHEN 
	COALESCE(SQ_BCI_SALES_ORDLNS.CANCELLED_FLAG,SQ_BCI_SALES_ORDLNS.CANCELLED_FLAG1) = 'N' THEN 
	'Y'
ELSE 
	'N'

END ) BILLING_FLG,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.INVOICE_INTERFACE_STATUS_CODE IS NULL THEN 
	NULL
ELSE 
	(CASE
WHEN SQ_BCI_SALES_ORDLNS.INVOICE_INTERFACE_STATUS_CODE = 'YES' THEN 'Y'
ELSE 'N'
END )

END ) INVOICE_INTERFACED_FLG,
	SQ_BCI_SALES_ORDLNS.SHIPPING_INTERFACED_FLAG SHIPPING_INTERFACED_FLG,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.HEADER_ID) SALES_ORDER_HD_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.LINE_ID) SALES_ORDER_LN_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.LINE_ID)||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.INVENTORY_ITEM_ID)||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIP_FROM_ORG_ID) BOOKING_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.HEADER_ID) FULFILL_ORDER_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.LINE_ID) FULFILL_ORDER_LINE_ID,
	SQ_BCI_SALES_ORDLNS.DELETE_FLG DELETE_FLG,
	COALESCE(SQ_BCI_SALES_ORDLNS.TRANSACTIONAL_CURR_CODE,'__UNASSIGNED__') DOC_CURR_CODE,
	COALESCE(SQ_BCI_SALES_ORDLNS.LOC_CURR_CODE,'__UNASSIGNED__') LOC_CURR_CODE,
	SQ_BCI_SALES_ORDLNS.CONVERSION_TYPE_CODE LOC_EXCH_RATE_TYPE,
	SQ_BCI_SALES_ORDLNS.CONVERSION_RATE LOC_EXCHANGE_RATE,
	SQ_BCI_SALES_ORDLNS.ORDERED_DATE EXCHANGE_DT,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.CREATED_BY_ID) CREATED_BY_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.CHANGED_BY_ID) CHANGED_BY_ID,
	SQ_BCI_SALES_ORDLNS.CREATED_ON_DT CREATED_ON_DT,
	SQ_BCI_SALES_ORDLNS.CHANGED_ON_DT CHANGED_ON_DT,
	GREATEST(
COALESCE(SQ_BCI_SALES_ORDLNS.HOLD_LAST_UPDATE_DATE,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(SQ_BCI_SALES_ORDLNS.HOLD_SRC_LAST_UPDATE_DATE,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(SQ_BCI_SALES_ORDLNS.HOLD_DEFN_LAST_UPDATE_DATE,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(SQ_BCI_SALES_ORDLNS.HOLD_DEFN_LAST_UPDATE_DATE,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(SQ_BCI_SALES_ORDLNS.HOLD_DEFN_LAST_UPDATE_DATE,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS'))
) AUX1_CHANGED_ON_DT,
	SQ_BCI_SALES_ORDLNS.AUX3_CHANGED_ON_DT AUX3_CHANGED_ON_DT,
	GREATEST(
COALESCE(LKP_W_CUST_LOC_USE_PS_SHP_TO.CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SHP_TO.AUX1_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SHP_TO.AUX2_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SHP_TO.AUX3_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SHP_TO.AUX4_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_INVC_TO.CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_INVC_TO.AUX1_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_INVC_TO.AUX2_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_INVC_TO.AUX3_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_INVC_TO.AUX4_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS'))
) AUX4_CHANGED_ON_DT,
	380 DATASOURCE_NUM_ID,
	'OM' || '~' || TO_CHAR(SQ_BCI_SALES_ORDLNS.LINE_ID) INTEGRATION_ID,
	TO_CHAR(SQ_BCI_SALES_ORDLNS.LINE_ID) SALES_ORDLN_ID,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY + COALESCE(SQ_BCI_SALES_ORDLNS.CANCELLED_QUANTITY,0)  IS NULL	OR
	(
		SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY + COALESCE(SQ_BCI_SALES_ORDLNS.CANCELLED_QUANTITY,0)
	) = 0 THEN 
	'SALES_ORDER_PROCESS~FULFILLMENT~OVERALL~6'
ELSE 
	(CASE
WHEN 
		SQ_BCI_SALES_ORDLNS.FLOW_STATUS_CODE1 = 'CANCELLED' THEN 
		'SALES_ORDER_PROCESS~FULFILLMENT~OVERALL~4'
ELSE 
		(CASE
WHEN 
			SQ_BCI_SALES_ORDLNS.FLOW_STATUS_CODE1 = 'CLOSED' THEN 
			'SALES_ORDER_PROCESS~FULFILLMENT~OVERALL~3'
ELSE 
			(CASE
WHEN 
				NOT SQ_BCI_SALES_ORDLNS.LINE_ID_ON_HOLD IS NULL THEN 
				'SALES_ORDER_PROCESS~FULFILLMENT~OVERALL~5'
ELSE 
				(CASE
WHEN 
					(CASE
WHEN 
						(CASE
WHEN 
							SQ_BCI_SALES_ORDLNS.OPEN_FLAG = 'Y' AND COALESCE(SQ_BCI_SALES_ORDLNS.CANCELLED_FLAG,SQ_BCI_SALES_ORDLNS.CANCELLED_FLAG1) = 'N' AND SQ_BCI_SALES_ORDLNS.SHIPPABLE_FLAG = 'Y' AND SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY > 0 THEN 
							'Y'
ELSE 
							'N'
						
END )='N' THEN 
						'COMPLETE'
ELSE 
						(CASE
WHEN 
							(SQ_BCI_SALES_ORDLNS.SHIPPED_QUANTITY IS NULL)	OR
							(SQ_BCI_SALES_ORDLNS.SHIPPED_QUANTITY = 0)	OR
							(SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY - SQ_BCI_SALES_ORDLNS.SHIPPED_QUANTITY > 0.01) THEN 
							'INCOMPLETE'
ELSE 
							'COMPLETE'
						
END )
					
END ) ='COMPLETE' THEN 
					'SALES_ORDER_PROCESS~FULFILLMENT~OVERALL~1'
ELSE 
					'SALES_ORDER_PROCESS~FULFILLMENT~OVERALL~0'
				
END )
			
END )
		
END )
	
END )

END ) SCH_STATUS_ID,
	SQ_BCI_SALES_ORDLNS.SCHEDULE_SHIP_DATE PLAN_AVAIL_ON_DT,
	SQ_BCI_SALES_ORDLNS.SCHEDULE_SHIP_DATE PLAN_PICK_ON_DT,
	SQ_BCI_SALES_ORDLNS.SCHEDULE_SHIP_DATE PLAN_SHIP_DT,
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY CONFIRMED_BASE_QTY,
	SQ_BCI_SALES_ORDLNS.ORDERED_QUANTITY CONFIRMED_QTY,
	COALESCE(SQ_BCI_SALES_ORDLNS.ORDER_QUANTITY_UOM,'__UNASSIGNED__') BASE_UOM_CODE,
	TO_CHAR (SQ_BCI_SALES_ORDLNS.LINE_NUMBER)||'.'||TO_CHAR(
	(CASE
WHEN 
		SQ_BCI_SALES_ORDLNS.COMPONENT_NUMBER IS NULL THEN 
		(CASE
WHEN 
			SQ_BCI_SALES_ORDLNS.OPTION_NUMBER IS NULL THEN 
			TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIPMENT_NUMBER)
ELSE 
			TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIPMENT_NUMBER)||'.'||TO_CHAR(SQ_BCI_SALES_ORDLNS.OPTION_NUMBER)
		
END )
ELSE 
		TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIPMENT_NUMBER)||'.'||TO_CHAR(SQ_BCI_SALES_ORDLNS.OPTION_NUMBER)||'.'||TO_CHAR(SQ_BCI_SALES_ORDLNS.COMPONENT_NUMBER)
	
END )
) SALES_SCH_ITEM,
	(CASE
WHEN 
	SQ_BCI_SALES_ORDLNS.TOP_MODEL_LINE_ID IS NULL THEN 
	TO_CHAR(SQ_BCI_SALES_ORDLNS.LINE_ID)
ELSE 
	TO_CHAR(SQ_BCI_SALES_ORDLNS.TOP_MODEL_LINE_ID)

END ) ROOT_PROD_LINE_ID,
	'SALES_ORDER_RETURN_REASON'||'~'||TO_CHAR(SQ_BCI_SALES_ORDLNS.RETURN_REASON_CODE) RETURN_REASON_ID,
	SQ_BCI_SALES_ORDLNS.X_CUSTOM X_CUSTOM,
	SQ_BCI_SALES_ORDLNS.X_PRICING_ATTRIBUTE28 X_PRICING_ATTRIBUTE28,
	SQ_BCI_SALES_ORDLNS.X_SERVICE_START_DATE X_SERVICE_START_DATE,
	SQ_BCI_SALES_ORDLNS.X_SERVICE_END_DATE X_SERVICE_END_DATE,
	SQ_BCI_SALES_ORDLNS.X_SERVICE_REFERENCE_TYPE_CODE X_SERVICE_REFERENCE_TYPE_CODE,
	SQ_BCI_SALES_ORDLNS.X_SERVICE_REFERENCE_LINE_ID X_SERVICE_REFERENCE_LINE_ID,
	SQ_BCI_SALES_ORDLNS.X_SYSTEM_ID X_LICENSE_ID,
	SQ_BCI_SALES_ORDLNS.X_ORDER_SOURCE X_ORDER_SOURCE,
	C1_X_SIMPLIFIED_CONTRACT_NUMBE X_SIMPLIFIED_CONTRACT_NUMBER,
	SQ_BCI_SALES_ORDLNS.X_COVERED_INVENTORY_ITEM_ID X_COVERED_INVENTORY_ITEM_ID,
	SQ_BCI_SALES_ORDLNS.X_SOB_ID X_SOB_ID,
	SQ_BCI_SALES_ORDLNS.X_CREDIT_PERCENTAGE X_CREDIT_PERCENTAGE,
	SQ_BCI_SALES_ORDLNS.X_SALES_CREDIT_ID X_SALES_CREDIT_ID,
	SQ_BCI_SALES_ORDLNS.X_PRICING_ATTRIBUTE25 X_PRICING_ATTRIBUTE25,
	SQ_BCI_SALES_ORDLNS.FLOW_STATUS_CODE1 X_LINE_STATUS,
	SQ_BCI_SALES_ORDLNS.SALES_CHANNEL_CODE X_SALES_CHANNEL_CODE,
	SQ_BCI_SALES_ORDLNS.X_BILL_TO_CUSTOMER_ID X_BILL_TO_CUSTOMER_ID,
	SQ_BCI_SALES_ORDLNS.X_SHIP_TO_CUSTOMER_ID X_SHIP_TO_CUSTOMER_ID,
	SQ_BCI_SALES_ORDLNS.X_SOLD_TO_CUSTOMER_ID X_SOLD_TO_CUSTOMER_ID,
	SQ_BCI_SALES_ORDLNS.ACTUAL_SHIPMENT_DATE X_ACTUAL_SHIPMENT_DT,
	SQ_BCI_SALES_ORDLNS.HEADER_FLOW_STATUS_CODE X_ORDER_STATUS,
	SQ_BCI_SALES_ORDLNS.X_TAX_CODE X_TAX_CODE,
	to_char(SQ_BCI_SALES_ORDLNS.SALESREP_ID_HEADER) X_SALESREP_ID,
	SQ_BCI_SALES_ORDLNS.X_TRX_NUMBER X_INV_NUMBER,
	SQ_BCI_SALES_ORDLNS.X_LINE_NUMBER X_INV_LINE_NUM,
	SQ_BCI_SALES_ORDLNS.X_TRX_DATE X_INV_DT,
	SQ_BCI_SALES_ORDLNS.LINE_ID X_SALES_SPLIT_LINE_WID,
	SQ_BCI_SALES_ORDLNS.X_SERVICE_ITEM_FLAG X_SERVICE_ITEM_FLAG,
	to_char(SQ_BCI_SALES_ORDLNS.INVENTORY_ITEM_ID) X_REVN_TYPE_PRODUCT_ID,
	SQ_BCI_SALES_ORDLNS.X_APPLICATION_CODE X_APPLICATION_CODE,
	C2_X_CONTRACT_START_DATE X_CONTRACT_START_DATE,
	C3_X_CONTRACT_END_DATE X_CONTRACT_END_DATE,
	SQ_BCI_SALES_ORDLNS.X_ATTRIBUTE2 X_REFERENCE_NUMBER,
	SQ_BCI_SALES_ORDLNS.SOLD_TO_CONTACT_ID X_SOLD_TO_CONTACT_ID,
	SQ_BCI_SALES_ORDLNS.X_SHIP_TO_CONTACT_ID X_SHIP_TO_CONTACT_ID,
	SQ_BCI_SALES_ORDLNS.X_INVOICE_TO_CONTACT_ID X_INVOICE_TO_CONTACT_ID,
	C4_X_INSTALL_CUSTOMER_ID X_INSTALL_CUSTOMER_ID,
	C5_X_INSTALL_CUSTOMER_LOC_ID X_INSTALL_CUSTOMER_LOC_ID,
	SQ_BCI_SALES_ORDLNS.X_INTERFACE_LINE_ATTRIBUTE6 X_INTERFACE_LINE_ATTRIBUTE6,
	SQ_BCI_SALES_ORDLNS.X_CUSTOMER_TRX_ID X_CUSTOMER_TRX_ID,
	SQ_BCI_SALES_ORDLNS.X_CUSTOMER_TRX_LINE_ID X_CUSTOMER_TRX_LINE_ID,
	SQ_BCI_SALES_ORDLNS.X_PRE_CUSTOMER_TRX_LINE_ID X_PR_CUSTOMER_TRX_LINE_ID,
	SQ_BCI_SALES_ORDLNS.X_CREDIT_PERCENTAGE*1.0000000000*SQ_BCI_SALES_ORDLNS.X_CONTRACTPRICE X_UNIT_CONTRACT_PRICE,
	SQ_BCI_SALES_ORDLNS.X_CREDIT_PERCENTAGE*1.0000000000*SQ_BCI_SALES_ORDLNS.X_SELLINGPRICE X_UNIT_SELLING_PRICE,
	SQ_BCI_SALES_ORDLNS.X_QTY X_SFDC_QUANTITY,
	SQ_BCI_SALES_ORDLNS.X_CREDIT_PERCENTAGE*1.0000000000*SQ_BCI_SALES_ORDLNS.X_LISTPRICE X_UNIT_LIST_PRICE,
	SQ_BCI_SALES_ORDLNS.X_SERVICE_PERCENTAGE X_SERVICE_PERCENTAGE,
	SQ_BCI_SALES_ORDLNS.X_INVOICE_UPDATE_DATE AUX5_CHANGED_ON_DT,
	SQ_BCI_SALES_ORDLNS.X_ATTRIBUTE10 X_ATTRIBUTE10,
	SQ_BCI_SALES_ORDLNS.X_ATTRIBUTE11 X_ATTRIBUTE11,
	SQ_BCI_SALES_ORDLNS.X_ATTRIBUTE12 X_ATTRIBUTE12 
from	((((("PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALES_ORDLNS_TEMP"    SQ_BCI_SALES_ORDLNS LEFT OUTER JOIN 
LKP_EMPL_SALESREP_PERSON_ID ON SQ_BCI_SALES_ORDLNS.RESOURCE_ID=C7_SALESREP_ID AND C8_LKP_ACTIVE=1) 
LEFT OUTER JOIN OKC_K_HEADERS_LKP ON SQ_BCI_SALES_ORDLNS.ORDER_NUMBER=C9_ORDER_NUMBER) LEFT OUTER JOIN LKP_INSTALL_CUSTOMER ON 
SQ_BCI_SALES_ORDLNS.X_SYSTEM_ID=TO_CHAR(C10_SYSTEM_ID) AND C11_LKP_ACTIVE=1) LEFT OUTER JOIN 
( /* Subselect from LKP_PARTY_CONTACT_CUST_CONTACT
*/


select 
	   

	   
	   DECODE(ROW_NUMBER() OVER (PARTITION BY 
	W_ORA_PARTY_CONTACT_PS.CUST_ACCOUNT_ROLE_ID,W_ORA_PARTY_CONTACT_PS.DATASOURCE_NUM_ID ORDER BY 
	W_ORA_PARTY_CONTACT_PS.CONTACT_PARTY_ID
),1,1,0) LKP_ACTIVE,
	W_ORA_PARTY_CONTACT_PS.CONTACT_PARTY_ID CONTACT_PARTY_ID,
	W_ORA_PARTY_CONTACT_PS.CUST_ACCOUNT_ROLE_ID CUST_ACCOUNT_ROLE_ID,
	W_ORA_PARTY_CONTACT_PS.DATASOURCE_NUM_ID DATASOURCE_NUM_ID
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_ORA_PARTY_CONTACT_PS"   W_ORA_PARTY_CONTACT_PS
where	(1=1)

And (W_ORA_PARTY_CONTACT_PS.CUST_ACCOUNT_ROLE_ID>0)







)    LKP_PARTY_CONTACT_CUST_CONTACT ON TO_CHAR(SQ_BCI_SALES_ORDLNS.SOLD_TO_CONTACT_ID) = LKP_PARTY_CONTACT_CUST_CONTACT.CUST_ACCOUNT_ROLE_ID
AND	380 = LKP_PARTY_CONTACT_CUST_CONTACT.DATASOURCE_NUM_ID) LEFT OUTER JOIN 
( /* Subselect from LKP_W_CUST_LOC_USE_PS_SHP_TO_ID
*/


select 
	   

	   
	   W_CUST_LOC_USE_PS.ACCT_SITE_ID ACCT_SITE_ID,
	W_CUST_LOC_USE_PS.CUST_ACCNT_ID CUST_ACCNT_ID,
	W_CUST_LOC_USE_PS.TERRITORY_ID TERRITORY_ID,
	W_CUST_LOC_USE_PS.SITE_USE_ID SITE_USE_ID,
	W_CUST_LOC_USE_PS.DATASOURCE_NUM_ID DATASOURCE_NUM_ID,
	W_CUST_LOC_USE_PS.SRC_EFF_FROM_DT SRC_EFF_FROM_DT,
	W_CUST_LOC_USE_PS.SRC_EFF_TO_DT SRC_EFF_TO_DT,
	W_CUST_LOC_USE_PS.CHANGED_ON_DT CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX2_CHANGED_ON_DT AUX2_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX3_CHANGED_ON_DT AUX3_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX4_CHANGED_ON_DT AUX4_CHANGED_ON_DT
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_CUST_LOC_USE_PS"   W_CUST_LOC_USE_PS
where	(1=1)

And (W_CUST_LOC_USE_PS.SITE_USE_CODE = 'SHIP_TO')







)    LKP_W_CUST_LOC_USE_PS_SHP_TO ON TO_CHAR(SQ_BCI_SALES_ORDLNS.SHIP_TO_ORG_ID1) = LKP_W_CUST_LOC_USE_PS_SHP_TO.SITE_USE_ID
AND	380 = LKP_W_CUST_LOC_USE_PS_SHP_TO.DATASOURCE_NUM_ID
AND	SQ_BCI_SALES_ORDLNS.ORDERED_DATE >= LKP_W_CUST_LOC_USE_PS_SHP_TO.SRC_EFF_FROM_DT
AND	SQ_BCI_SALES_ORDLNS.ORDERED_DATE < LKP_W_CUST_LOC_USE_PS_SHP_TO.SRC_EFF_TO_DT) LEFT OUTER JOIN 
( /* Subselect from LKP_W_CUST_LOC_USE_PS_INVC_TO_ID
*/


select 
	   

	   
	   W_CUST_LOC_USE_PS.ACCT_SITE_ID ACCT_SITE_ID,
	W_CUST_LOC_USE_PS.CUST_ACCNT_ID CUST_ACCNT_ID,
	W_CUST_LOC_USE_PS.SITE_USE_ID SITE_USE_ID,
	W_CUST_LOC_USE_PS.DATASOURCE_NUM_ID DATASOURCE_NUM_ID,
	W_CUST_LOC_USE_PS.SRC_EFF_FROM_DT SRC_EFF_FROM_DT,
	W_CUST_LOC_USE_PS.SRC_EFF_TO_DT SRC_EFF_TO_DT,
	W_CUST_LOC_USE_PS.CHANGED_ON_DT CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX2_CHANGED_ON_DT AUX2_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX3_CHANGED_ON_DT AUX3_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX4_CHANGED_ON_DT AUX4_CHANGED_ON_DT
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_CUST_LOC_USE_PS"   W_CUST_LOC_USE_PS
where	(1=1)

And (W_CUST_LOC_USE_PS.SITE_USE_CODE = 'BILL_TO')







)    LKP_W_CUST_LOC_USE_PS_INVC_TO ON TO_CHAR(SQ_BCI_SALES_ORDLNS.INVOICE_TO_ORG_ID1) = LKP_W_CUST_LOC_USE_PS_INVC_TO.SITE_USE_ID
AND	380 = LKP_W_CUST_LOC_USE_PS_INVC_TO.DATASOURCE_NUM_ID
AND	SQ_BCI_SALES_ORDLNS.ORDERED_DATE >= LKP_W_CUST_LOC_USE_PS_INVC_TO.SRC_EFF_FROM_DT
AND	SQ_BCI_SALES_ORDLNS.ORDERED_DATE < LKP_W_CUST_LOC_USE_PS_INVC_TO.SRC_EFF_TO_DT
where		(1=1)	






)    ODI_GET_FROM

)

SELECT * FROM FINAL_SALES_ORDER_LINE_OM_TOTAL
