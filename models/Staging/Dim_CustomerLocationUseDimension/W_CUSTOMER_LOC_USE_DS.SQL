{{ config (
    materialized="table"
)}}


select	
	
	TO_CHAR(SQ_CUST_LOC_USE.CUST_ACCOUNT_ID)	  CUSTOMER_ID,
	TO_CHAR(SQ_CUST_LOC_USE.CUST_ACCT_SITE_ID)	   CUSTOMER_LOC_ID,
	TO_CHAR(SQ_CUST_LOC_USE.CUST_ACCT_SITE_ID)	   ACCT_SITE_ID,
	SUBSTR(LTRIM(RTRIM(SQ_CUST_LOC_USE.LOCATION)),0,30)	  ADDRESS_NUM,
	TO_CHAR(SQ_CUST_LOC_USE.SITE_USE_ID)	   SITE_USE_ID,
	SUBSTR(LTRIM(RTRIM(SQ_CUST_LOC_USE.SITE_USE_CODE)),0,50)	  SITE_USE_CODE,
	(CASE
WHEN SQ_CUST_LOC_USE.STATUS = 'I' THEN  'N'
ELSE  'Y'
END )	  ACTIVE_FLG,
	TO_CHAR(SQ_CUST_LOC_USE.CREATED_BY)	   CREATED_BY_ID,
	TO_CHAR(SQ_CUST_LOC_USE.LAST_UPDATED_BY)	  CHANGED_BY_ID,
	SQ_CUST_LOC_USE.CREATION_DATE	    CREATED_ON_DT,
	SQ_CUST_LOC_USE.LAST_UPDATE_DATE	  CHANGED_ON_DT,
	SQ_CUST_LOC_USE.LAST_UPDATE_DATE1	   AUX1_CHANGED_ON_DT,
	SQ_CUST_LOC_USE.DELETE_FLAG	    DELETE_FLG,
	TO_CHAR(SQ_CUST_LOC_USE.SITE_USE_ID)	   INTEGRATION_ID,
	380 DATASOURCE_NUM_ID,
	 TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')  EFFECTIVE_FROM_DT,
	TO_DATE(SUBSTR('3714-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS') 	EFFECTIVE_TO_DT,
    SQ_CUST_LOC_USE.TERRITORY_ID,
     to_varchar(CURRENT_TIMESTAMP, 'yyyy-MM-DD hh:mi:ss') LAST_DATE
from	(

select 	
	HZ_CUST_SITE_USES_ALL.SITE_USE_ID    SITE_USE_ID,	HZ_CUST_SITE_USES_ALL.CREATION_DATE    CREATION_DATE,	
  HZ_CUST_SITE_USES_ALL.CREATED_BY    CREATED_BY,	HZ_CUST_SITE_USES_ALL.LAST_UPDATED_BY    LAST_UPDATED_BY,	
  HZ_CUST_SITE_USES_ALL.LAST_UPDATE_DATE    LAST_UPDATE_DATE,	HZ_CUST_SITE_USES_ALL.STATUS    STATUS,
  HZ_CUST_SITE_USES_ALL.TERRITORY_ID    TERRITORY_ID,	HZ_CUST_ACCOUNTS.CUST_ACCOUNT_ID    CUST_ACCOUNT_ID,	
  HZ_PARTY_SITES.PARTY_SITE_ID    PARTY_SITE_ID,	HZ_LOCATIONS.LOCATION_ID    LOCATION_ID,	HZ_CUST_ACCT_SITES_ALL.CUST_ACCT_SITE_ID    CUST_ACCT_SITE_ID,	
  HZ_CUST_ACCT_SITES_ALL.LAST_UPDATE_DATE    LAST_UPDATE_DATE1,	HZ_CUST_SITE_USES_ALL.SITE_USE_CODE    SITE_USE_CODE,	HZ_CUST_SITE_USES_ALL.LOCATION    LOCATION,	
'N'
    DELETE_FLAG,	0    X_CUSTOM
from	"PC_FIVETRAN_DB"."ERPPRD1_AR"."HZ_CUST_ACCT_SITES_ALL"   HZ_CUST_ACCT_SITES_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD1_AR"."HZ_PARTY_SITES"   HZ_PARTY_SITES,
  "PC_FIVETRAN_DB"."ERPPRD1_AR"."HZ_LOCATIONS"   HZ_LOCATIONS, 
  "PC_FIVETRAN_DB"."ERPPRD1_AR"."HZ_CUST_ACCOUNTS"   HZ_CUST_ACCOUNTS,
 "PC_FIVETRAN_DB"."ERPPRD1_AR"."HZ_CUST_SITE_USES_ALL"   HZ_CUST_SITE_USES_ALL
where	(1=1)
 And (HZ_CUST_SITE_USES_ALL.CUST_ACCT_SITE_ID = HZ_CUST_ACCT_SITES_ALL.CUST_ACCT_SITE_ID)
AND (HZ_CUST_ACCT_SITES_ALL.PARTY_SITE_ID = HZ_PARTY_SITES.PARTY_SITE_ID)
AND (HZ_PARTY_SITES.LOCATION_ID = HZ_LOCATIONS.LOCATION_ID)
AND (HZ_CUST_ACCOUNTS.CUST_ACCOUNT_ID = HZ_CUST_ACCT_SITES_ALL.CUST_ACCOUNT_ID)
And (


(HZ_CUST_ACCT_SITES_ALL.LAST_UPDATE_DATE>IFNULL((
select MAX(LAST_DATE) from "PC_FIVETRAN_DB"."OBIEE_DW"."W_CUSTOMER_LOC_USE_D"),'2002-01-23 11:32:25')
OR HZ_CUST_SITE_USES_ALL.LAST_UPDATE_DATE>IFNULL((
select MAX(LAST_DATE) from "PC_FIVETRAN_DB"."OBIEE_DW"."W_CUSTOMER_LOC_USE_D"),'2002-01-23 11:32:25')
)
)


)   SQ_CUST_LOC_USE
where	(1=1)