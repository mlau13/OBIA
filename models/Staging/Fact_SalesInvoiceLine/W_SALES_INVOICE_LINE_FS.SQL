{{ config (
    materialized="table"
)}}

with slaesinvoice as(

    select	
	DISTINCT
	(CASE
WHEN SQ_BCI_SALES_IVCLNS.LINE_TYPE='DM' THEN 
NULL
ELSE 
(CASE
WHEN 
	(CASE
WHEN 
		SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' THEN 
		SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT
ELSE 
		SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT1
	
END )='ORDER ENTRY' THEN  
	(CASE
WHEN 
		SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' THEN 
		SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_ATTRIBUTE6
ELSE 
		SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_ATTRIBUTE61
	
END )
ELSE 
	NULL

END )

END )	   C1_SALES_ORDLN_ID,
	(CASE
WHEN SQ_BCI_SALES_IVCLNS.LINE_TYPE='DM' THEN 
NULL
ELSE 
(CASE
WHEN 
	(CASE
WHEN 
		SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' OR SQ_BCI_SALES_IVCLNS.LINK_TO_CUST_TRX_LINE_ID IS NULL THEN 
		SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT
ELSE 
		SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT1
	
END )='ORDER ENTRY'  THEN 
	(CASE
WHEN 
		SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' OR SQ_BCI_SALES_IVCLNS.LINK_TO_CUST_TRX_LINE_ID IS NULL THEN 
		SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_ATTRIBUTE7
ELSE 
		SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_ATTRIBUTE71
	
END )
ELSE 
	NULL

END )

END )	   C2_SALES_PCKLN_ID,
	'SALES_CHANNEL'||'~'||TO_CHAR(SQ_BCI_SALES_IVCLNS.SALES_CHANNEL_CODE)	   C3_CHNL_TYPE_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.FREIGHT_TERMS_CODE)	   C4_FREIGHT_TERMS_ID,
	TO_CHAR( 
(CASE
WHEN SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' OR SQ_BCI_SALES_IVCLNS.LINK_TO_CUST_TRX_LINE_ID IS NULL THEN   
       SQ_BCI_SALES_IVCLNS.WAREHOUSE_ID
ELSE  
       SQ_BCI_SALES_IVCLNS.WAREHOUSE_ID1 
END )
)
	   C5_INVENTORY_ORG_ID,
	TO_CHAR(
	(CASE
WHEN 
		SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' OR SQ_BCI_SALES_IVCLNS.LINK_TO_CUST_TRX_LINE_ID IS NULL THEN 
		SQ_BCI_SALES_IVCLNS.INVENTORY_ITEM_ID
ELSE 
		SQ_BCI_SALES_IVCLNS.INVENTORY_ITEM_ID1
	
END )
)||'~'||TO_CHAR(
	(CASE
WHEN 
		 SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' OR SQ_BCI_SALES_IVCLNS.LINK_TO_CUST_TRX_LINE_ID IS NULL THEN 
			SQ_BCI_SALES_IVCLNS.WAREHOUSE_ID
ELSE 
			SQ_BCI_SALES_IVCLNS.WAREHOUSE_ID1
		
END )
)	   C6_INVENTORY_PRODUCT_ID,
	'SALES_ORDER_INVOICE_PROCESS'||'~'||SQ_BCI_SALES_IVCLNS.STATUS_TRX	   C7_INVOICE_STATUS_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.ORG_ID)	   C8_OPERATING_UNIT_ORG_ID,
	(CASE
WHEN SQ_BCI_SALES_IVCLNS.SOURCE_TYPE_CODE='INTERNAL' THEN (CASE
WHEN SQ_BCI_SALES_IVCLNS.ORDER_SOURCE_ID=10 THEN 'SALES_ORDLNS'||'~'||SQ_BCI_SALES_IVCLNS.LINE_CATEGORY_CODE||'~'||TO_CHAR(SQ_BCI_SALES_IVCLNS.ORDER_TYPE_ID)||'~INTERNAL~SELF SHIP'
ELSE 'SALES_ORDLNS'||'~'||SQ_BCI_SALES_IVCLNS.LINE_CATEGORY_CODE||'~'||TO_CHAR(SQ_BCI_SALES_IVCLNS.ORDER_TYPE_ID)||'~EXTERNAL~SELF SHIP'
END )
ELSE (CASE
WHEN SQ_BCI_SALES_IVCLNS.ORDER_SOURCE_ID=10 THEN 'SALES_ORDLNS'||'~'||SQ_BCI_SALES_IVCLNS.LINE_CATEGORY_CODE||'~'||TO_CHAR(SQ_BCI_SALES_IVCLNS.ORDER_TYPE_ID)||'~INTERNAL~DROP SHIP'
ELSE 'SALES_ORDLNS'||'~'||SQ_BCI_SALES_IVCLNS.LINE_CATEGORY_CODE||'~'||TO_CHAR(SQ_BCI_SALES_IVCLNS.ORDER_TYPE_ID)||'~EXTERNAL~DROP SHIP'
END )
END )	   C9_ORDER_XACT_TYPE_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.PAYMENT_TYPE_CODE)	   C10_PAYMENT_METHOD_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.TERM_ID)	   C11_PAYMENT_TERMS_ID,
	'PLANT'||'~'||TO_CHAR(
			(CASE
WHEN 
			SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE'OR SQ_BCI_SALES_IVCLNS.LINK_TO_CUST_TRX_LINE_ID IS NULL THEN 
			SQ_BCI_SALES_IVCLNS.WAREHOUSE_ID
ELSE 
			SQ_BCI_SALES_IVCLNS.WAREHOUSE_ID1
		
END )
	)
	   C12_PLANT_LOC_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.ORG_ID)	   C13_SALES_ORG_ID,
	TO_CHAR(
	(CASE
WHEN 
		SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' OR SQ_BCI_SALES_IVCLNS.LINK_TO_CUST_TRX_LINE_ID IS NULL THEN 
		SQ_BCI_SALES_IVCLNS.INVENTORY_ITEM_ID
ELSE 
		SQ_BCI_SALES_IVCLNS.INVENTORY_ITEM_ID1
	
END )
) ||'~'||TO_CHAR(
		(CASE
WHEN 
			SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' OR SQ_BCI_SALES_IVCLNS.LINK_TO_CUST_TRX_LINE_ID IS NULL THEN 
			SQ_BCI_SALES_IVCLNS.WAREHOUSE_ID
ELSE 
			SQ_BCI_SALES_IVCLNS.WAREHOUSE_ID1
		
END )
)	   C14_SALES_PRODUCT_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.TERRITORY_ID)	   C15_TERR_ID,
	'SALES_IVCLNS'||'~'||TO_CHAR(SQ_BCI_SALES_IVCLNS.CUST_TRX_TYPE_ID)||'~'||TO_CHAR(SQ_BCI_SALES_IVCLNS.ORG_ID)||'~'||((CASE
WHEN SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' THEN  SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT
ELSE SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT1
END ))	   C16_XACT_TYPE_ID,
	SQ_BCI_SALES_IVCLNS.EXCHANGE_DATE	   C17_CONVERSION_DT,
	SQ_BCI_SALES_IVCLNS.TRX_DATE	   C18_INVOICED_ON_DT,
	SQ_BCI_SALES_IVCLNS.TERM_DUE_DATE	   C19_PAYMENT_TERMS_EFF_DT,
	(CASE
WHEN SQ_BCI_SALES_IVCLNS.GL_POSTED_DATE IS NULL THEN  SQ_BCI_SALES_IVCLNS.GL_DATE
ELSE  SQ_BCI_SALES_IVCLNS.GL_POSTED_DATE
END )	   C20_POSTING_PERIOD_DT,
	(CASE
WHEN (SQ_BCI_SALES_IVCLNS.LINE_TYPE = 'LINE') OR (SQ_BCI_SALES_IVCLNS.LINE_TYPE= 'CB') THEN  SQ_BCI_SALES_IVCLNS.EXTENDED_AMOUNT
ELSE  0
END )	   C21_NET_AMT,
	(CASE
WHEN 
   (SQ_BCI_SALES_IVCLNS.LINE_TYPE = 'LINE') OR (SQ_BCI_SALES_IVCLNS.LINE_TYPE= 'CB') THEN  
  SQ_BCI_SALES_IVCLNS.QUANTITY_INVOICED*
	((CASE
WHEN 
		SQ_BCI_SALES_IVCLNS.UNIT_STANDARD_PRICE IS NULL THEN  
      		  0
ELSE  
       		 TO_NUMBER(SQ_BCI_SALES_IVCLNS.UNIT_STANDARD_PRICE)
       		
END ) 
      	)
ELSE  
   0
   
END )	   C22_LIST_AMT,
	(CASE
WHEN 
	SQ_BCI_SALES_IVCLNS.LINE_TYPE='TAX' THEN 
	SQ_BCI_SALES_IVCLNS.EXTENDED_AMOUNT
ELSE 
	0

END ) 	   C23_TAX_AMT,
	(CASE
WHEN 
	SQ_BCI_SALES_IVCLNS.LINE_TYPE='FREIGHT' THEN 
	SQ_BCI_SALES_IVCLNS.EXTENDED_AMOUNT
ELSE 
	0

END )	   C24_FREIGHT_AMT,
	  (CASE
WHEN (SQ_BCI_SALES_IVCLNS.LINE_TYPE = 'LINE' OR SQ_BCI_SALES_IVCLNS.LINE_TYPE= 'CB' OR SQ_BCI_SALES_IVCLNS.LINK_TO_CUST_TRX_LINE_ID IS NULL) AND 
   SQ_BCI_SALES_IVCLNS.QUANTITY_INVOICED > 0 AND SQ_BCI_SALES_IVCLNS.EXTENDED_AMOUNT > 0 AND 
	SQ_BCI_SALES_IVCLNS.TYPE <> 'CM' THEN  
    (CASE
WHEN (CASE
WHEN 
   (SQ_BCI_SALES_IVCLNS.LINE_TYPE = 'LINE') OR (SQ_BCI_SALES_IVCLNS.LINE_TYPE= 'CB') THEN  
  SQ_BCI_SALES_IVCLNS.QUANTITY_INVOICED*
	((CASE
WHEN 
		SQ_BCI_SALES_IVCLNS.UNIT_STANDARD_PRICE IS NULL THEN  
      		  0
ELSE  
       		 TO_NUMBER(SQ_BCI_SALES_IVCLNS.UNIT_STANDARD_PRICE)
       		
END ) 
      	)
ELSE  
   0
   
END ) 
	> 
	(CASE
WHEN (SQ_BCI_SALES_IVCLNS.LINE_TYPE = 'LINE') OR (SQ_BCI_SALES_IVCLNS.LINE_TYPE= 'CB') THEN  SQ_BCI_SALES_IVCLNS.EXTENDED_AMOUNT
ELSE  0
END ) THEN  
     		(CASE
WHEN 
   (SQ_BCI_SALES_IVCLNS.LINE_TYPE = 'LINE') OR (SQ_BCI_SALES_IVCLNS.LINE_TYPE= 'CB') THEN  
  SQ_BCI_SALES_IVCLNS.QUANTITY_INVOICED*
	((CASE
WHEN 
		SQ_BCI_SALES_IVCLNS.UNIT_STANDARD_PRICE IS NULL THEN  
      		  0
ELSE  
       		 TO_NUMBER(SQ_BCI_SALES_IVCLNS.UNIT_STANDARD_PRICE)
       		
END ) 
      	)
ELSE  
   0
   
END ) 
		- 
		(CASE
WHEN (SQ_BCI_SALES_IVCLNS.LINE_TYPE = 'LINE') OR (SQ_BCI_SALES_IVCLNS.LINE_TYPE= 'CB') THEN  SQ_BCI_SALES_IVCLNS.EXTENDED_AMOUNT
ELSE  0
END )
ELSE  
     		0
   	 
END )
ELSE 
    0
  
END )	   C25_DISCOUNT_AMT,
	SQ_BCI_SALES_IVCLNS.QUANTITY_INVOICED	   C26_INVOICED_QTY,
	SQ_BCI_SALES_IVCLNS.TRX_NUMBER	   C27_INVOICE_NUM,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.LINE_NUMBER)	   C28_INVOICE_ITEM,
	TO_CHAR(LKP_QUOTE_NUMBER.ORIG_SYS_DOCUMENT_REF)	   C29_REF_DOC_NUM,
	(CASE
WHEN  
 (CASE
WHEN SQ_BCI_SALES_IVCLNS.LINE_TYPE='LINE' OR SQ_BCI_SALES_IVCLNS.LINK_TO_CUST_TRX_LINE_ID IS NULL THEN  
      SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT
ELSE  
      SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT1 
 
END )='ORDER ENTRY' THEN  
(CASE
WHEN  SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_ATTRIBUTE13 IS NULL THEN  
           TRIM(TO_CHAR(SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_ATTRIBUTE12))
ELSE  
        TRIM(TO_CHAR(SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_ATTRIBUTE12))||'.'||
        TRIM(TO_CHAR(SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_ATTRIBUTE13))
      
END )
ELSE  
NULL 
END )
	   C30_SALES_ORDER_ITEM_DETAIL_NU,
	SQ_BCI_SALES_IVCLNS.PURCHASE_ORDER	   C31_PURCH_ORDER_NUM,
	SQ_BCI_SALES_IVCLNS.DELETE_FLG	   C32_DELETE_FLG,
	SQ_BCI_SALES_IVCLNS.EXCHANGE_RATE_TYPE	   C33_LOC_EXCH_RATE_TYPE,
	SQ_BCI_SALES_IVCLNS.EXCHANGE_RATE	   C34_LOC_EXCHANGE_RATE,
	(CASE
WHEN 
	SQ_BCI_SALES_IVCLNS.EXCHANGE_DATE IS NULL THEN 
	SQ_BCI_SALES_IVCLNS.TRX_DATE
ELSE 
	SQ_BCI_SALES_IVCLNS.EXCHANGE_DATE

END )
		   C35_EXCHANGE_DT,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.CREATED_BY)	   C36_CREATED_BY_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.LAST_UPDATED_BY)	   C37_CHANGED_BY_ID,
	SQ_BCI_SALES_IVCLNS.CREATION_DATE	   C38_CREATED_ON_DT,
	SQ_BCI_SALES_IVCLNS.LAST_UPDATE_DATE	   C39_CHANGED_ON_DT,
	SQ_BCI_SALES_IVCLNS.LAST_UPDATE_DATE1	   C40_AUX1_CHANGED_ON_DT,
	SQ_BCI_SALES_IVCLNS.LAST_UPDATE_DATE2	   C41_AUX2_CHANGED_ON_DT,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.CUSTOMER_TRX_LINE_ID)	   C42_INTEGRATION_ID,
	(CASE
WHEN SQ_BCI_SALES_IVCLNS.ITEM_TYPE_CODE = 'SERVICE' THEN  'Y'
ELSE  'N'
END )	   C43_SERVICE_FLG,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.ITEM_TYPE_CODE)	   C44_ITEM_TYPE_CODE,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.SET_OF_BOOKS_ID)	   C45_LEDGER_ID,
	'SALES_ORDSRC~'||TO_CHAR(SQ_BCI_SALES_IVCLNS.ORDER_SOURCE_ID)	   C46_ORDER_SOURCE_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.PROJECT_ID)	   C47_PROJECT_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.TASK_ID)	   C48_TASK_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.BILL_TO_CUSTOMER_ID)	   C49_CUSTOMER_ACCOUNT_ID,
	'SALES_IVCLNS~' || 
(CASE
WHEN 
	TO_CHAR(SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT) IS NULL THEN  
		TO_CHAR(SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT1)
ELSE 
		TO_CHAR(SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_CONTEXT)

END )
	   C50_XACT_SOURCE_ID,
	SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_ATTRIBUTE6	   C51_FULFILL_LINE_ID,
	SQ_BCI_SALES_IVCLNS.CUSTOMER_TRX_ID	   C52_INVOICE_HEADER_ID,
	SQ_BCI_SALES_IVCLNS.X_ORDER_SOURCE	   C53_X_ORDER_SOURCE,
	SQ_BCI_SALES_IVCLNS.SERVICE_REFERENCE_TYPE_CODE	   C54_X_SERVICE_REF_TYPE_CODE,
	SQ_BCI_SALES_IVCLNS.SERVICE_REFERENCE_LINE_ID	   C55_X_SERVICE_REF_LINE_ID,
	SQ_BCI_SALES_IVCLNS.GL_DATE	   C56_X_GL_DATE,
	SQ_BCI_SALES_IVCLNS.GL_POSTED_DATE	   C57_X_GL_POSTED_DATE,
	SQ_BCI_SALES_IVCLNS.CUSTOMER_TRX_LINE_ID	   C59_X_CUSTOMER_TRX_LINE_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.SHIP_TO_CUSTOMER_ID)	   C60_X_SHIP_TO_CUSTOMER_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.SOLD_TO_CUSTOMER_ID)	   C61_X_SOLD_TO_CUSTOMER_ID,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.BILL_TO_CUSTOMER_ID)	   C62_X_BILL_TO_CUSTOMER_ID,
	SQ_BCI_SALES_IVCLNS.BATCH_SOURCE	   C63_X_BATCH_SOURCE,
	SQ_BCI_SALES_IVCLNS.BATCH_NAME	   C64_X_BATCH_NAME,
	SQ_BCI_SALES_IVCLNS.GL_DATE2	   C65_X_CIS_DATE,
	TO_CHAR(SQ_BCI_SALES_IVCLNS.PRIMARY_SALESREP_ID)	   C66_X_SALESREP_ID,
	SQ_BCI_SALES_IVCLNS.SERVICE_ITEM_FLAG	   C68_X_SERVICE_ITEM_FLAG,
	SQ_BCI_SALES_IVCLNS.LEGAL_ENTITY_ID	   C82_LEGAL_ENTITY_ID,
	SQ_BCI_SALES_IVCLNS.O_CVRNG_INV_ITEM_ID_OM	   C84_O_CVRNG_INV_ITEM_ID_OM,
	SQ_BCI_SALES_IVCLNS.INVENTORY_ITEM_ID	   C87_INVENTORY_ITEM_ID,
	SQ_BCI_SALES_IVCLNS.SALESREP_ID	   C88_SALESREP_ID,
	SQ_BCI_SALES_IVCLNS.UOM_CODE	   C89_UOM_CODE,
	SQ_BCI_SALES_IVCLNS.ORDER_NUMBER	   C92_ORDER_NUMBER,
	SQ_BCI_SALES_IVCLNS.LINE_NUMBER	   C93_LINE_NUMBER,
	SQ_BCI_SALES_IVCLNS.INVOICE_CURRENCY_CODE	   C96_INVOICE_CURRENCY_CODE,
	SQ_BCI_SALES_IVCLNS.LOC_CURR_CODE	   C97_LOC_CURR_CODE,
	SQ_BCI_SALES_IVCLNS.INTERFACE_LINE_ATTRIBUTE11	   C98_INTERFACE_LINE_ATTRIBUTE11,
	SQ_BCI_SALES_IVCLNS.TYPE	   C99_TYPE,
	SQ_BCI_SALES_IVCLNS.SERVICE_START_DATE	   C100_SERVICE_START_DATE,
	SQ_BCI_SALES_IVCLNS.SERVICE_END_DATE	   C103_SERVICE_END_DATE,
	SQ_BCI_SALES_IVCLNS.X_LICENSE_ID	   C106_X_LICENSE_ID,
	SQ_BCI_SALES_IVCLNS.ORDERED_DATE	   C111_ORDERED_DATE,
	SQ_BCI_SALES_IVCLNS.O_CVRD_INV_ITEM_ID	   C112_O_CVRD_INV_ITEM_ID,
	SQ_BCI_SALES_IVCLNS.PRICING_ATTRIBUTE25	   C115_PRICING_ATTRIBUTE25,
	SQ_BCI_SALES_IVCLNS.PRICING_ATTRIBUTE28	   C117_PRICING_ATTRIBUTE28,
	SQ_BCI_SALES_IVCLNS.VAT_TAX_CODE	   C120_VAT_TAX_CODE,
	SQ_BCI_SALES_IVCLNS.VAT_TAX_RATE	   C122_VAT_TAX_RATE,
	SQ_BCI_SALES_IVCLNS.SOLD_TO_SITE_USE_ID	   C124_SOLD_TO_SITE_USE_ID,
	SQ_BCI_SALES_IVCLNS.PAYING_SITE_USE_ID	   C125_PAYING_SITE_USE_ID,
	SQ_BCI_SALES_IVCLNS.BILL_TO_SITE_USE_ID	   C126_BILL_TO_SITE_USE_ID,
	SQ_BCI_SALES_IVCLNS.SHIP_TO_SITE_USE_ID	   C127_SHIP_TO_SITE_USE_ID,
	SQ_BCI_SALES_IVCLNS.SOLD_TO_CONTACT_ID	   C137_SOLD_TO_CONTACT_ID
from	
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_BCI_SALES_IVCLNS
*/


select 
	   

	   DISTINCT
	   RA_CUST_TRX_TYPES_ALL.TYPE TYPE,
	RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_LINE_ID CUSTOMER_TRX_LINE_ID,
	
 
RA_CUSTOMER_TRX_LINES_ALL.LAST_UPDATE_DATE
 LAST_UPDATE_DATE,
	RA_CUSTOMER_TRX_LINES_ALL.LAST_UPDATED_BY LAST_UPDATED_BY,
	RA_CUSTOMER_TRX_LINES_ALL.CREATION_DATE CREATION_DATE,
	RA_CUSTOMER_TRX_LINES_ALL.CREATED_BY CREATED_BY,
	RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_ID CUSTOMER_TRX_ID1,
	RA_CUSTOMER_TRX_LINES_ALL.LINE_NUMBER LINE_NUMBER,
	RA_CUSTOMER_TRX_LINES_ALL.SET_OF_BOOKS_ID SET_OF_BOOKS_ID,
	RA_CUSTOMER_TRX_LINES_ALL.INVENTORY_ITEM_ID INVENTORY_ITEM_ID,
	(CASE WHEN 
  RA_CUSTOMER_TRX_LINES_ALL.LINE_TYPE = 'TAX' OR RA_CUSTOMER_TRX_LINES_ALL.LINE_TYPE = 'FREIGHT' 
  THEN NULL
  ELSE
	(CASE WHEN RA_CUST_TRX_TYPES_ALL.TYPE = 'CM'
		THEN -1*COALESCE(RA_CUSTOMER_TRX_LINES_ALL.QUANTITY_CREDITED,0) 
  		ELSE 
			(CASE WHEN RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE11 IS NOT NULL AND RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE11 <>'0' 
				THEN RA_CUSTOMER_TRX_LINES_ALL.QUANTITY_INVOICED
		 		ELSE (CASE WHEN RA_CUSTOMER_TRX_LINES_ALL.UNIT_SELLING_PRICE < 0 AND COALESCE(RA_CUSTOMER_TRX_LINES_ALL.QUANTITY_INVOICED,0) > 0
    					THEN -1*COALESCE(RA_CUSTOMER_TRX_LINES_ALL.QUANTITY_INVOICED,0)
					ELSE COALESCE(RA_CUSTOMER_TRX_LINES_ALL.QUANTITY_INVOICED,0)
				 END)
 			END)
	END)
END) QUANTITY_INVOICED,
	COALESCE(RA_CUSTOMER_TRX_LINES_ALL.QUANTITY_CREDITED,0) QUANTITY_CREDITED,
	(CASE
WHEN NOT RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE11 IS NULL AND 
RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE11 <> '0'  THEN  
NULL
ELSE   
(CASE WHEN RA_CUST_TRX_TYPES_ALL.TYPE = 'CM' THEN -1*RA_CUSTOMER_TRX_LINES_ALL.UNIT_STANDARD_PRICE ELSE RA_CUSTOMER_TRX_LINES_ALL.UNIT_STANDARD_PRICE END)
END ) UNIT_STANDARD_PRICE,
	RA_CUSTOMER_TRX_LINES_ALL.UNIT_SELLING_PRICE UNIT_SELLING_PRICE,
	RA_CUSTOMER_TRX_LINES_ALL.SALES_ORDER SALES_ORDER,
	RA_CUSTOMER_TRX_LINES_ALL.SALES_ORDER_LINE SALES_ORDER_LINE,
	RA_CUSTOMER_TRX_LINES_ALL.LINE_TYPE LINE_TYPE,
	CASE WHEN RA_CUST_TRX_TYPES_ALL.TYPE = 'CM'
	THEN -1*RA_CUSTOMER_TRX_LINES_ALL.EXTENDED_AMOUNT
	ELSE RA_CUSTOMER_TRX_LINES_ALL.EXTENDED_AMOUNT END EXTENDED_AMOUNT,
	RA_CUSTOMER_TRX_LINES_ALL.TAX_RATE TAX_RATE,
	RA_CUSTOMER_TRX_LINES_ALL.UOM_CODE UOM_CODE,
	RA_CUSTOMER_TRX_LINES_ALL.ORG_ID ORG_ID,
	RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_CONTEXT INTERFACE_LINE_CONTEXT,
	RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE6 INTERFACE_LINE_ATTRIBUTE6,
	RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE7 INTERFACE_LINE_ATTRIBUTE7,
	RA_CUSTOMER_TRX_LINES_ALL.LINK_TO_CUST_TRX_LINE_ID LINK_TO_CUST_TRX_LINE_ID,
	RA_CUSTOMER_TRX_LINES_ALL.WAREHOUSE_ID WAREHOUSE_ID,
	RA_CUSTOMER_TRX_ALL.CUSTOMER_TRX_ID CUSTOMER_TRX_ID,
	RA_CUSTOMER_TRX_ALL.TRX_NUMBER TRX_NUMBER,
	RA_CUSTOMER_TRX_ALL.CUST_TRX_TYPE_ID CUST_TRX_TYPE_ID,
	RA_CUSTOMER_TRX_ALL.TRX_DATE TRX_DATE,
	RA_CUSTOMER_TRX_ALL.SOLD_TO_CUSTOMER_ID SOLD_TO_CUSTOMER_ID,
	RA_CUSTOMER_TRX_ALL.SOLD_TO_SITE_USE_ID SOLD_TO_SITE_USE_ID,
	RA_CUSTOMER_TRX_ALL.BILL_TO_CUSTOMER_ID BILL_TO_CUSTOMER_ID,
	RA_CUSTOMER_TRX_ALL.BILL_TO_SITE_USE_ID BILL_TO_SITE_USE_ID,
	RA_CUSTOMER_TRX_ALL.SHIP_TO_SITE_USE_ID SHIP_TO_SITE_USE_ID,
	RA_CUSTOMER_TRX_ALL.SHIP_TO_CUSTOMER_ID SHIP_TO_CUSTOMER_ID,
	RA_CUSTOMER_TRX_ALL.TERM_ID TERM_ID,
	RA_CUSTOMER_TRX_ALL.TERM_DUE_DATE TERM_DUE_DATE,
	RA_SALESREPS_ALL.RESOURCE_ID SALESREP_ID,
	RA_CUSTOMER_TRX_ALL.PRINTING_ORIGINAL_DATE PRINTING_ORIGINAL_DATE,
	RA_CUSTOMER_TRX_ALL.PURCHASE_ORDER PURCHASE_ORDER,
	RA_CUSTOMER_TRX_ALL.EXCHANGE_DATE EXCHANGE_DATE,
	RA_CUSTOMER_TRX_ALL.EXCHANGE_RATE EXCHANGE_RATE,
	RA_CUSTOMER_TRX_ALL.TERRITORY_ID TERRITORY_ID,
	RA_CUSTOMER_TRX_ALL.INVOICE_CURRENCY_CODE INVOICE_CURRENCY_CODE,
	RA_CUSTOMER_TRX_ALL.COMPLETE_FLAG COMPLETE_FLAG,
	RA_CUSTOMER_TRX_ALL.PAYING_SITE_USE_ID PAYING_SITE_USE_ID,
	RA_CUSTOMER_TRX_LINES_ALL1.CUSTOMER_TRX_LINE_ID CUSTOMER_TRX_LINE_ID1,
	RA_CUSTOMER_TRX_LINES_ALL1.INVENTORY_ITEM_ID INVENTORY_ITEM_ID1,
	RA_CUSTOMER_TRX_LINES_ALL1.SALES_ORDER SALES_ORDER1,
	RA_CUSTOMER_TRX_LINES_ALL1.SALES_ORDER_LINE SALES_ORDER_LINE1,
	RA_CUSTOMER_TRX_LINES_ALL1.INTERFACE_LINE_CONTEXT INTERFACE_LINE_CONTEXT1,
	RA_CUSTOMER_TRX_LINES_ALL1.INTERFACE_LINE_ATTRIBUTE6 INTERFACE_LINE_ATTRIBUTE61,
	RA_CUSTOMER_TRX_LINES_ALL1.INTERFACE_LINE_ATTRIBUTE7 INTERFACE_LINE_ATTRIBUTE71,
	RA_CUSTOMER_TRX_LINES_ALL1.WAREHOUSE_ID WAREHOUSE_ID1,
	RA_CUSTOMER_TRX_ALL.STATUS_TRX STATUS_TRX,
	RA_CUSTOMER_TRX_ALL.EXCHANGE_RATE_TYPE EXCHANGE_RATE_TYPE,
	
 
RA_CUSTOMER_TRX_ALL.LAST_UPDATE_DATE
 LAST_UPDATE_DATE1,
	
 
RA_CUST_TRX_TYPES_ALL.LAST_UPDATE_DATE
 LAST_UPDATE_DATE2,
	RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE11 INTERFACE_LINE_ATTRIBUTE11,
	RA_CUSTOMER_TRX_LINES_ALL1.INTERFACE_LINE_ATTRIBUTE5 INTERFACE_LINE_ATTRIBUTE5,
	RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE12 INTERFACE_LINE_ATTRIBUTE12,
	RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE13 INTERFACE_LINE_ATTRIBUTE13,
	GL_LEDGERS.CURRENCY_CODE LOC_CURR_CODE,
	RA_CUSTOMER_TRX_ALL.LEGAL_ENTITY_ID LEGAL_ENTITY_ID,
	

   'N'
 DELETE_FLG,
	OE_ORDER_HEADERS_ALL.SALES_CHANNEL_CODE SALES_CHANNEL_CODE,
	OE_ORDER_HEADERS_ALL.ORDER_TYPE_ID ORDER_TYPE_ID,
	OE_ORDER_HEADERS_ALL.PAYMENT_TYPE_CODE PAYMENT_TYPE_CODE,
	OE_ORDER_HEADERS_ALL.FREIGHT_TERMS_CODE FREIGHT_TERMS_CODE,
	OE_ORDER_LINES_ALL.LINE_CATEGORY_CODE LINE_CATEGORY_CODE,
	OE_ORDER_LINES_ALL.ITEM_TYPE_CODE ITEM_TYPE_CODE,
	OE_ORDER_LINES_ALL.SHIPMENT_NUMBER SHIPMENT_NUMBER,
	OE_ORDER_LINES_ALL.SHIP_FROM_ORG_ID SHIP_FROM_ORG_ID,
	OE_ORDER_LINES_ALL.OPTION_NUMBER OPTION_NUMBER,
	OE_ORDER_LINES_ALL.COMPONENT_NUMBER COMPONENT_NUMBER,
	OE_ORDER_LINES_ALL.SOURCE_TYPE_CODE SOURCE_TYPE_CODE,
	OE_ORDER_LINES_ALL.ORDER_SOURCE_ID ORDER_SOURCE_ID,
	OE_ORDER_LINES_ALL.PROJECT_ID PROJECT_ID,
	OE_ORDER_LINES_ALL.TASK_ID TASK_ID,
	RA_CUSTOMER_TRX_ALL.INTERFACE_HEADER_CONTEXT X_ORDER_SOURCE,
	OE_ORDER_LINES_ALL.SERVICE_START_DATE SERVICE_START_DATE,
	OE_ORDER_LINES_ALL.SERVICE_END_DATE SERVICE_END_DATE,
	OE_ORDER_LINES_ALL.SERVICE_REFERENCE_TYPE_CODE SERVICE_REFERENCE_TYPE_CODE,
	OE_ORDER_LINES_ALL.SERVICE_REFERENCE_LINE_ID SERVICE_REFERENCE_LINE_ID,
	CSI_ITEM_INSTANCES.SYSTEM_ID ORD_SYSTEM_ID,
	SUBQ.CSI_SYSTEM_ID ORD2_SYSTEM_ID,
	CSI_ITEM_INSTANCES2.SYSTEM_ID CUST_PROD_SYSTEM_ID,
	CSI_ITEM_INSTANCES3.SYSTEM_ID PROD_SYSTEM_ID,
	SUBQ2.CSI_SYSTEM_ID PROD2_SYSTEM_ID,
	TO_CHAR(OE_ORDER_HEADERS_ALL.ORDER_NUMBER) ORDER_NUMBER,
	OE_ORDER_HEADERS_ALL.ORDERED_DATE ORDERED_DATE,
	GL_LKP.GL_DATE GL_DATE,
	GL_LKP.GL_POSTED_DATE GL_POSTED_DATE,
	COVERED_PROD.INVENTORY_ITEM_ID CVRD_INV_ITEM_ID,
	COVERED_PROD2.INVENTORY_ITEM_ID CVRD_INV_ITEM_ID2,
	MTL_SYSTEM_ITEMS_B.SERVICE_ITEM_FLAG SERVICE_ITEM_FLAG,
	BSA.NAME BATCH_SOURCE,
	BA.NAME BATCH_NAME,
	GL_LKP2.GL_DATE2 GL_DATE2,
	PRICE_ATTRIB.PRICING_ATTRIBUTE25 PRICING_ATTRIBUTE25,
	PRICE_ATTRIB.PRICING_ATTRIBUTE28 PRICING_ATTRIBUTE28,
	NVL (OE_ORDER_HEADERS_ALL.ATTRIBUTE2, OE_ORDER_HEADERS_ALL.ORIG_SYS_DOCUMENT_REF) QUOTE_NUMBER,
	AVTA.TAX_CODE VAT_TAX_CODE,
	AVTA.TAX_RATE VAT_TAX_RATE,
	OE_ORDER_HEADERS_ALL.ATTRIBUTE2 ATTRIBUTE2,
	(CASE
WHEN MTL_SYSTEM_ITEMS_B.SERVICE_ITEM_FLAG='N' THEN 
(CASE
WHEN COVERED_PROD.INVENTORY_ITEM_ID IS NULL THEN TO_CHAR(COVERED_PROD2.INVENTORY_ITEM_ID)
ELSE TO_CHAR(COVERED_PROD.INVENTORY_ITEM_ID)
END )
ELSE TO_CHAR(RA_CUSTOMER_TRX_LINES_ALL.INVENTORY_ITEM_ID)
END ) O_CVRD_INV_ITEM_ID,
	TO_CHAR(
(CASE
WHEN OE_ORDER_LINES_ALL.SERVICE_REFERENCE_TYPE_CODE='ORDER' THEN 
(CASE
WHEN CSI_ITEM_INSTANCES.SYSTEM_ID IS NULL THEN SUBQ.CSI_SYSTEM_ID
ELSE CSI_ITEM_INSTANCES.SYSTEM_ID
END )
ELSE 
(CASE
WHEN OE_ORDER_LINES_ALL.SERVICE_REFERENCE_TYPE_CODE='CUSTOMER_PRODUCT' THEN CSI_ITEM_INSTANCES2.SYSTEM_ID
ELSE 
(CASE
WHEN OE_ORDER_LINES_ALL.SERVICE_REFERENCE_TYPE_CODE='PRODUCT' OR OE_ORDER_LINES_ALL.SERVICE_REFERENCE_TYPE_CODE IS NULL THEN 
(CASE
WHEN CSI_ITEM_INSTANCES3.SYSTEM_ID IS NULL THEN SUBQ2.CSI_SYSTEM_ID
ELSE CSI_ITEM_INSTANCES3.SYSTEM_ID
END )
ELSE NULL
END )
END )
END )) X_LICENSE_ID,
	RA_CUSTOMER_TRX_ALL.PRIMARY_SALESREP_ID PRIMARY_SALESREP_ID,
	OE_ORDER_HEADERS_ALL.SOLD_TO_CONTACT_ID SOLD_TO_CONTACT_ID,
	(CASE
WHEN (CASE
WHEN RA_CUSTOMER_TRX_LINES_ALL.LINE_TYPE='LINE' THEN  RA_CUSTOMER_TRX_LINES_ALL.SALES_ORDER
ELSE  RA_CUSTOMER_TRX_LINES_ALL1.SALES_ORDER
END ) IS NULL THEN TO_CHAR(OE_ORDER_HEADERS_ALL.ORDER_NUMBER)
ELSE ((CASE
WHEN RA_CUSTOMER_TRX_LINES_ALL.LINE_TYPE='LINE' THEN  RA_CUSTOMER_TRX_LINES_ALL.SALES_ORDER
ELSE  RA_CUSTOMER_TRX_LINES_ALL1.SALES_ORDER
END ))
END ) X_ORDER_NUMBER,
	(CASE
WHEN MTL_SYSTEM_ITEMS_B.SERVICE_ITEM_FLAG='Y' OR MTL_SYSTEM_ITEMS_B.SERVICE_ITEM_FLAG IS NULL THEN 
(CASE
WHEN COVERED_PROD.INVENTORY_ITEM_ID IS NULL THEN TO_CHAR(COVERED_PROD2.INVENTORY_ITEM_ID)
ELSE TO_CHAR(COVERED_PROD.INVENTORY_ITEM_ID)
END )
ELSE TO_CHAR(RA_CUSTOMER_TRX_LINES_ALL.INVENTORY_ITEM_ID)
END ) O_CVRNG_INV_ITEM_ID_OM
from	"PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUSTOMER_TRX_LINES_ALL"   RA_CUSTOMER_TRX_LINES_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUST_TRX_TYPES_ALL"   RA_CUST_TRX_TYPES_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUSTOMER_TRX_ALL"   RA_CUSTOMER_TRX_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUSTOMER_TRX_LINES_ALL"   RA_CUSTOMER_TRX_LINES_ALL1, 
  "PC_FIVETRAN_DB"."ERPPRD_JTF"."JTF_RS_SALESREPS"   RA_SALESREPS_ALL,
  "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_LEDGERS"   GL_LEDGERS, 
  "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_LINES_ALL"   OE_ORDER_LINES_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_HEADERS_ALL"   OE_ORDER_HEADERS_ALL, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_PRICE_ATTRIB
*/


select 
	   

	   
	   OE_ORDER_PRICE_ATTRIBS.LINE_ID LINE_ID,
	OE_ORDER_PRICE_ATTRIBS.HEADER_ID HEADER_ID,
	MAX(OE_ORDER_PRICE_ATTRIBS.PRICING_ATTRIBUTE25) PRICING_ATTRIBUTE25,
	MAX(OE_ORDER_PRICE_ATTRIBS.PRICING_ATTRIBUTE28) PRICING_ATTRIBUTE28
from	"PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_PRICE_ATTRIBS"   OE_ORDER_PRICE_ATTRIBS
where	(1=1)



Group By OE_ORDER_PRICE_ATTRIBS.LINE_ID,
 OE_ORDER_PRICE_ATTRIBS.HEADER_ID





)   PRICE_ATTRIB, 
  "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_LINES_ALL"   OJ_LINES, 
  "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_LINES_ALL"   OJ_LINES2, 
   "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_LINES_ALL"   OJ_LINES3, 
   "PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_ITEM_INSTANCES"   CSI_ITEM_INSTANCES, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_SUBQ
*/


select 
	   

	   DISTINCT
	   Y.SOURCE_TRANSACTION_ID SOURCE_TRANSACTION_ID,
	MAX(X.CSI_SYSTEM_ID) CSI_SYSTEM_ID
from	"PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_T_TRANSACTION_LINES"   Y, "PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_T_TXN_LINE_DETAILS"   X
where	(1=1)
 And (Y.TRANSACTION_LINE_ID=X.TRANSACTION_LINE_ID)

And (X.CSI_SYSTEM_ID IS NOT NULL)


Group By Y.SOURCE_TRANSACTION_ID





)   SUBQ, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_SUBQ
*/


select 
	   

	   DISTINCT
	   Y.SOURCE_TRANSACTION_ID SOURCE_TRANSACTION_ID,
	MAX(X.CSI_SYSTEM_ID) CSI_SYSTEM_ID
from	"PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_T_TRANSACTION_LINES"   Y, "PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_T_TXN_LINE_DETAILS"   X
where	(1=1)
 And (Y.TRANSACTION_LINE_ID=X.TRANSACTION_LINE_ID)

And (X.CSI_SYSTEM_ID IS NOT NULL)


Group By Y.SOURCE_TRANSACTION_ID





)   SUBQ2, "PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_ITEM_INSTANCES"   CSI_ITEM_INSTANCES2, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_CSI_ITEM_INSTANCES3
*/


select 
	   

	   
	   CSI_ITEM_INSTANCES3.LAST_OE_ORDER_LINE_ID LAST_OE_ORDER_LINE_ID,
	MIN(CSI_ITEM_INSTANCES3.SYSTEM_ID) SYSTEM_ID
from	"PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_ITEM_INSTANCES"  CSI_ITEM_INSTANCES3
where	(1=1)



Group By CSI_ITEM_INSTANCES3.LAST_OE_ORDER_LINE_ID





)   CSI_ITEM_INSTANCES3, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_GL_LKP
*/


select 
	   

	   
	   RCTL.CUSTOMER_TRX_LINE_ID CUSTOMER_TRX_LINE_ID,
	MIN(RCTL.GL_DATE) GL_DATE,
	MIN(RCTL.GL_POSTED_DATE) GL_POSTED_DATE,
	RCTL.CUSTOMER_TRX_ID CUSTOMER_TRX_ID
from	"PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUST_TRX_LINE_GL_DIST_ALL"   RCTL
where	(1=1)



Group By RCTL.CUSTOMER_TRX_LINE_ID,
 RCTL.CUSTOMER_TRX_ID





)   GL_LKP, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_GL_LKP2
*/


select 
	   

	   
	   RCTL.CUSTOMER_TRX_ID CUSTOMER_TRX_ID,
	MIN(RCTL.LAST_UPDATE_DATE) LAST_UPDATE_DATE,
	MIN(RCTL.GL_DATE) GL_DATE2,
	MIN(RCTL.GL_POSTED_DATE) GL_POSTED_DATE2
from	"PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUST_TRX_LINE_GL_DIST_ALL"   RCTL
where	(1=1)



Group By RCTL.CUSTOMER_TRX_ID





)   GL_LKP2, "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_LINES_ALL"   OOL2,"PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_LINES_ALL"   OOL3, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_COVERED_PROD
*/


select 
	   

	   
	   OE_ORDER_LINES_ALL.INVENTORY_ITEM_ID INVENTORY_ITEM_ID,
	OE_ORDER_LINES_ALL.LINE_ID LINE_ID
from	"PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_LINES_ALL"   OE_ORDER_LINES_ALL
where	(1=1)








)   COVERED_PROD, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_COVERED_PROD2
*/


select 
	   

	   
	   CSI_ITEM_INSTANCES.INVENTORY_ITEM_ID INVENTORY_ITEM_ID,
	CSI_ITEM_INSTANCES.INSTANCE_ID INSTANCE_ID
from	"PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_ITEM_INSTANCES"   CSI_ITEM_INSTANCES
where	(1=1)








)   COVERED_PROD2, "PC_FIVETRAN_DB"."ERPPRD_INV"."MTL_SYSTEM_ITEMS_B"   MTL_SYSTEM_ITEMS_B, 
  "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_BATCH_SOURCES_ALL"   BSA,
  "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_BATCHES_ALL"   BA, 
  "PC_FIVETRAN_DB"."ERPPRD_AR"."AR_VAT_TAX_ALL_B"   AVTA
where	(1=1)
 And (RA_CUSTOMER_TRX_ALL.ORG_ID=RA_CUST_TRX_TYPES_ALL.ORG_ID AND RA_CUSTOMER_TRX_ALL.CUST_TRX_TYPE_ID=RA_CUST_TRX_TYPES_ALL.CUST_TRX_TYPE_ID AND RA_CUSTOMER_TRX_ALL.CUST_TRX_TYPE_ID = RA_CUST_TRX_TYPES_ALL.CUST_TRX_TYPE_ID  AND RA_CUSTOMER_TRX_ALL.ORG_ID = RA_CUST_TRX_TYPES_ALL.ORG_ID)
AND (RA_CUSTOMER_TRX_ALL.CUSTOMER_TRX_ID=RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_ID AND RA_CUSTOMER_TRX_ALL.CUSTOMER_TRX_ID = RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_ID)
AND (RA_CUSTOMER_TRX_LINES_ALL.LINK_TO_CUST_TRX_LINE_ID=RA_CUSTOMER_TRX_LINES_ALL1.CUSTOMER_TRX_LINE_ID(+) AND  RA_CUSTOMER_TRX_LINES_ALL.LINK_TO_CUST_TRX_LINE_ID = RA_CUSTOMER_TRX_LINES_ALL1.CUSTOMER_TRX_LINE_ID(+))
AND (RA_CUSTOMER_TRX_ALL.PRIMARY_SALESREP_ID=RA_SALESREPS_ALL.SALESREP_ID AND RA_CUSTOMER_TRX_ALL.ORG_ID=RA_SALESREPS_ALL.ORG_ID)
AND (RA_CUSTOMER_TRX_LINES_ALL.SET_OF_BOOKS_ID=GL_LEDGERS.LEDGER_ID)
AND (TO_NUMBER(RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE6) = OE_ORDER_LINES_ALL.LINE_ID (+))
AND (OE_ORDER_LINES_ALL.HEADER_ID = OE_ORDER_HEADERS_ALL.HEADER_ID (+))
AND (OE_ORDER_LINES_ALL.LINE_ID = PRICE_ATTRIB.LINE_ID (+) AND OE_ORDER_LINES_ALL.HEADER_ID = PRICE_ATTRIB.HEADER_ID (+))
AND (OE_ORDER_LINES_ALL.LINE_ID = OJ_LINES.LINE_ID(+))
AND (OE_ORDER_LINES_ALL.LINE_ID = OJ_LINES2.LINE_ID(+))
AND (OE_ORDER_LINES_ALL.LINE_ID = OJ_LINES3.LINE_ID(+))
AND (OJ_LINES.LINE_ID = CSI_ITEM_INSTANCES.LAST_OE_ORDER_LINE_ID(+))
AND (OJ_LINES.SERVICE_REFERENCE_LINE_ID = SUBQ.SOURCE_TRANSACTION_ID(+))
AND (OJ_LINES2.SERVICE_REFERENCE_LINE_ID = CSI_ITEM_INSTANCES2.INSTANCE_ID(+))
AND (OJ_LINES3.LINE_ID = CSI_ITEM_INSTANCES3.LAST_OE_ORDER_LINE_ID(+))
AND (OJ_LINES3.LINE_ID = SUBQ2.SOURCE_TRANSACTION_ID(+))
AND (RA_CUSTOMER_TRX_ALL.CUSTOMER_TRX_ID = GL_LKP.CUSTOMER_TRX_ID)
AND (RA_CUSTOMER_TRX_ALL.CUSTOMER_TRX_ID = GL_LKP2.CUSTOMER_TRX_ID)
AND (GL_LKP.CUSTOMER_TRX_LINE_ID = RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_LINE_ID)
AND (OE_ORDER_LINES_ALL.LINE_ID = OOL2.LINE_ID(+))
AND (OE_ORDER_LINES_ALL.LINE_ID = OOL3.LINE_ID(+))
AND (OOL2.SERVICE_REFERENCE_LINE_ID = COVERED_PROD.LINE_ID(+))
AND (OOL3.SERVICE_REFERENCE_LINE_ID = COVERED_PROD2.INSTANCE_ID(+))
AND (MTL_SYSTEM_ITEMS_B.INVENTORY_ITEM_ID(+) = RA_CUSTOMER_TRX_LINES_ALL.INVENTORY_ITEM_ID)
AND (RA_CUSTOMER_TRX_ALL.BATCH_SOURCE_ID = BSA.BATCH_SOURCE_ID (+) AND RA_CUSTOMER_TRX_ALL.ORG_ID = BSA.ORG_ID (+))
AND (RA_CUSTOMER_TRX_ALL.BATCH_ID = BA.BATCH_ID (+))
AND (
 CASE WHEN RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_CONTEXT IN('ORDER ENTRY', 'INTERCOMPANY') 
	THEN TO_NUMBER(RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE6) END = OE_ORDER_LINES_ALL.LINE_ID (+) 
//        TO_NUMBER(RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_ATTRIBUTE6)  = OE_ORDER_LINES_ALL.LINE_ID (+) 
		AND OE_ORDER_LINES_ALL.HEADER_ID = OE_ORDER_HEADERS_ALL.HEADER_ID (+))
AND (RA_CUSTOMER_TRX_LINES_ALL.VAT_TAX_ID = AVTA.VAT_TAX_ID(+) AND RA_CUSTOMER_TRX_LINES_ALL.ORG_ID = AVTA.ORG_ID(+))

And (

	

(RA_CUSTOMER_TRX_ALL.LAST_UPDATE_DATE>=IFNULL((
select MAX(LAST_DATE) from "PC_FIVETRAN_DB"."OBIEE_DW"."W_SALES_INVOICE_LINE_F"),'2002-01-23 11:32:25')
OR RA_CUSTOMER_TRX_LINES_ALL.LAST_UPDATE_DATE>=IFNULL((
select MAX(LAST_DATE) from "PC_FIVETRAN_DB"."OBIEE_DW"."W_SALES_INVOICE_LINE_F"),'2002-01-23 11:32:25'))


)
 And (RA_CUSTOMER_TRX_ALL.COMPLETE_FLAG='Y')
 And (OJ_LINES.SERVICE_REFERENCE_TYPE_CODE(+) = 'ORDER')
 And (OJ_LINES2.SERVICE_REFERENCE_TYPE_CODE(+) = 'CUSTOMER_PRODUCT')
 And ((OJ_LINES3.SERVICE_REFERENCE_TYPE_CODE(+) = 'PRODUCT' 
//       OR OJ_LINES3.SERVICE_REFERENCE_TYPE_CODE(+) IS NULL
      )
     )
 And (OOL2.SERVICE_REFERENCE_TYPE_CODE(+) = 'ORDER')
 And (OOL3.SERVICE_REFERENCE_TYPE_CODE(+) = 'CUSTOMER_PRODUCT')
 And (MTL_SYSTEM_ITEMS_B.ORGANIZATION_ID(+) = 307)
 And (RA_CUSTOMER_TRX_LINES_ALL.LINE_TYPE = 'LINE')







)    SQ_BCI_SALES_IVCLNS LEFT OUTER JOIN "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_HEADERS_ALL"    LKP_QUOTE_NUMBER ON TO_CHAR(SQ_BCI_SALES_IVCLNS.X_ORDER_NUMBER)=TO_CHAR(LKP_QUOTE_NUMBER.ORDER_NUMBER)
where	(1=1)


),
PA_ORDER_ATTRIBUTES as
(

 
select	
	DISTINCT
	(CASE
WHEN LKP_PA_ORDER_ATTRIBUTES.PROJECT_ID IS NULL THEN NULL
ELSE CAST(TO_CHAR(LKP_PA_ORDER_ATTRIBUTES.PROJECT_ID)||'.999' AS FLOAT)
END )	   C58_X_PROJECT_ID,
	LKP_PA_ORDER_ATTRIBUTES.SEGMENT1	   C67_X_PROJECT_NAME,
	LKP_PA_ORDER_ATTRIBUTES.BUSINESS_UNIT	   C70_X_PS_BUSINESS_UNIT,
	LKP_PA_ORDER_ATTRIBUTES.X_SERVICE_LINE_DIRECTOR	   C71_X_SERVICE_LINE_DIRECTOR,
	LKP_PA_ORDER_ATTRIBUTES.X_PROJECT_MANAGER	   C72_X_PROJECT_MANAGER,
	LKP_PA_ORDER_ATTRIBUTES.X_TYPE_OF_SERVICE	   C73_X_TYPE_OF_SERVICE,
	LKP_PA_ORDER_ATTRIBUTES.X_PS_PRODUCT_GROUP	   C74_X_PS_PRODUCT_GROUP,
case when LKP_PA_ORDER_ATTRIBUTES.X_TYPE_OF_SERVICE='Aptiv Developer' THEN 'MAINTENANCE' ELSE	
DECODE(LKP_PA_ORDER_ATTRIBUTES.TASK_NUMBER, '1.0', 'SERVICES',
'10.0','SERVICES', 
'2.0','SERVICES',
'12.0','SERVICES',
'13.0',
 CASE WHEN  UPPER(LKP_PA_ORDER_ATTRIBUTES.BUSINESS_UNIT) like '%EDUCATION%' THEN  'TRAINING' ELSE 'SERVICES' END,
'9.0','TRAINING',
'11.0', (CASE
WHEN UPPER(LKP_PA_ORDER_ATTRIBUTES.BUSINESS_UNIT) like '%PREMIUM SUPPORT%' THEN  'MAINTENANCE'
ELSE  'SERVICES'
END ), 'SERVICES') END	   C75_X_PS_REV_TYPE,
	LKP_PA_ORDER_ATTRIBUTES.TASK_NUMBER	   C76_X_TASK_NUMBER,
	LKP_PA_ORDER_ATTRIBUTES.TASK_NAME	   C77_X_TASK_NAME,
	LKP_PA_ORDER_ATTRIBUTES.X_PS_PRODUCT_UNIT	   C78_X_PS_PRODUCT_UNIT,
	LKP_PA_ORDER_ATTRIBUTES.X_FAE	   C80_X_FAE,
	LKP_PA_ORDER_ATTRIBUTES.INVENTORY_ITEM_ID	   C83_INVENTORY_ITEM_ID,
	LKP_PA_ORDER_ATTRIBUTES.ORDER_NUMBER	   C90_ORDER_NUMBER,
	LKP_PA_ORDER_ATTRIBUTES.LINE_NUMBER	   C94_LINE_NUMBER,
	LKP_PA_ORDER_ATTRIBUTES.SERVICE_START_DATE	   C101_SERVICE_START_DATE,
	LKP_PA_ORDER_ATTRIBUTES.SERVICE_END_DATE	   C104_SERVICE_END_DATE,
	LKP_PA_ORDER_ATTRIBUTES.PROJECT_ID	   C107_PROJECT_ID,
	LKP_PA_ORDER_ATTRIBUTES.ORDER_DATE	   C109_ORDER_DATE,
	LKP_PA_ORDER_ATTRIBUTES.CUSTOMER_TRX_LINE_ID	   C128_CUSTOMER_TRX_LINE_ID
from	
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_LKP_PA_ORDER_ATTRIBUTES
*/


select 
    RCTL.CUSTOMER_TRX_LINE_ID CUSTOMER_TRX_LINE_ID,
	PPA.PROJECT_ID PROJECT_ID,
	MAX (PPA.SEGMENT1) ORDER_NUMBER,
	MIN (PPF.DATE_ALLOCATED) ORDER_DATE,
	MAX (PT.TASK_NUMBER) LINE_NUMBER,
	MAX (PPA.START_DATE) SERVICE_START_DATE,
	MAX (PPA.COMPLETION_DATE) SERVICE_END_DATE,
	MAX (PPA.SEGMENT1) SEGMENT1,
	MAX (PPCS_PRODUCT_GP.CLASS_CODE) X_PS_PRODUCT_GROUP,
	NVL(MAX(PPF.ATTRIBUTE4),MAX (PPCS_PRODUCT_UNIT.CLASS_CODE)) X_PS_PRODUCT_UNIT,
	MAX (PPCS_TYPE_OF_SERVICE.CLASS_CODE) X_TYPE_OF_SERVICE,
	MAX (PT.TASK_NUMBER) TASK_NUMBER,
	MAX (PT.TASK_NAME) TASK_NAME,
	MAX (SLD.PERSON_ID) X_SERVICE_LINE_DIRECTOR,
	MAX (PM.PERSON_ID) X_PROJECT_MANAGER,
	MAX (FAE.PERSON_ID) X_FAE,
	NVL (MAX ('WR~PS-PROD~' || PPCS_TARGET_OS.CLASS_CODE||'~'||PPCS_PRODUCT_GP.CLASS_CODE||'~'||PPCS_PRODUCT_UNIT.CLASS_CODE),'WR~PS-PROD~') INVENTORY_ITEM_ID,
	MAX(HOU.NAME) BUSINESS_UNIT
from	"PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECTS_ALL"   PPA, 
 "PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECT_FUNDINGS"   PPF,
  "PC_FIVETRAN_DB"."ERPPRD_PA"."PA_TASKS"   PT, 
  "PC_FIVETRAN_DB"."ERPPRD_PA"."PA_AGREEMENTS_ALL"   PAA, 
  "PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECT_CLASSES"  PPCS_TARGET_OS, 
  "PC_FIVETRAN_DB"."ERPPRD_PA"."PA_DRAFT_INVOICES_ALL"   PDI, 
  "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUSTOMER_TRX_ALL"   RCT, 
  "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUSTOMER_TRX_LINES_ALL"   RCTL, 
  "PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECT_CLASSES"   PPCS_PRODUCT_GP, 
  "PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECT_CLASSES"    PPCS_PRODUCT_UNIT, 
  "PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECT_CLASSES"    PPCS_TYPE_OF_SERVICE, 
  ("PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECT_PLAYERS") SLD, 
  ("PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECT_PLAYERS") PM, 
  ("PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECT_PLAYERS") FAE,
"PC_FIVETRAN_DB"."ERPPRD_HR"."HR_ORGANIZATION_UNITS"   HOU
where	(1=1)
 And (PAA.AGREEMENT_ID = PPF.AGREEMENT_ID)
AND (PPF.PROJECT_ID = PPA.PROJECT_ID)
AND (PPF.PROJECT_ID = PT.PROJECT_ID AND PPF.TASK_ID = PT.TASK_ID)
AND (PPA.PROJECT_ID = PPCS_TARGET_OS.PROJECT_ID(+))
AND (PPA.PROJECT_ID = PDI.PROJECT_ID)
AND (PDI.AGREEMENT_ID = PAA.AGREEMENT_ID)
AND (PDI.AGREEMENT_ID = PPF.AGREEMENT_ID)
AND (PDI.SYSTEM_REFERENCE = RCT.CUSTOMER_TRX_ID)
AND (RCT.CUSTOMER_TRX_ID = RCTL.CUSTOMER_TRX_ID)
AND (PPA.PROJECT_ID = PPCS_PRODUCT_GP.PROJECT_ID(+))
AND (PPA.PROJECT_ID = PPCS_PRODUCT_UNIT.PROJECT_ID(+))
AND (PPA.PROJECT_ID = PPCS_TYPE_OF_SERVICE.PROJECT_ID(+))
AND (PPA.CARRYING_OUT_ORGANIZATION_ID = HOU.ORGANIZATION_ID)
AND (PPA.PROJECT_ID = SLD.PROJECT_ID(+))
AND (PPA.PROJECT_ID = PM.PROJECT_ID(+))
AND (PPA.PROJECT_ID = FAE.PROJECT_ID(+))

And (PPCS_TARGET_OS.CLASS_CATEGORY(+) = 'Target - OS')
 And (PPCS_PRODUCT_GP.CLASS_CATEGORY(+) = 'Product Group')
 And (PPCS_PRODUCT_UNIT.CLASS_CATEGORY(+) = 'Product Unit')
 And (PPCS_TYPE_OF_SERVICE.CLASS_CATEGORY(+) = 'Type of Service')
 And (SLD.PROJECT_ROLE_TYPE(+) = '1045' 
AND SLD.END_DATE_ACTIVE(+) IS NULL)
// And ((SLD.START_DATE_ACTIVE = (SELECT MAX(PPP2.START_DATE_ACTIVE)
//                                  FROM "PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECT_PLAYERS"  PPP2
//                                  WHERE PPP2.PROJECT_ROLE_TYPE = '1045'
//                                    AND SLD.PROJECT_ID = PPP2.PROJECT_ID
//                                  GROUP BY PROJECT_ID)
//OR SLD.START_DATE_ACTIVE IS NULL))
 And (PM.PROJECT_ROLE_TYPE(+) = 'PROJECT MANAGER')
 And (FAE.PROJECT_ROLE_TYPE(+) = 'PROJECT MANAGER')
// And ((FAE.START_DATE_ACTIVE = (SELECT MAX(PPP2.START_DATE_ACTIVE)
//                                  FROM "PC_FIVETRAN_DB"."ERPPRD_PA"."PA_PROJECT_PLAYERS"  PPP2
//                                  WHERE PPP2.PROJECT_ROLE_TYPE = 'PROJECT MANAGER'
//                                    AND FAE.PROJECT_ID = PPP2.PROJECT_ID
//                                  GROUP BY PROJECT_ID)
//OR FAE.START_DATE_ACTIVE IS NULL))
Group By RCTL.CUSTOMER_TRX_LINE_ID,
 PPA.PROJECT_ID





)   LKP_PA_ORDER_ATTRIBUTES
where	(1=1)   
),
SQ_LKP_AR_REVENUE_ADJUSTMENTS_ALL as
(
 select	
	DISTINCT
	LKP_AR_REVENUE_ADJ_ALL.COMMENTS	   C81_X_COMMENTS,
	LKP_AR_REVENUE_ADJ_ALL.CUSTOMER_TRX_ID	   C131_CUSTOMER_TRX_ID,
	LKP_AR_REVENUE_ADJ_ALL.CUSTOMER_TRX_LINE_ID	   C132_CUSTOMER_TRX_LINE_ID,
	LKP_AR_REVENUE_ADJ_ALL.ACTIVE	   C133_ACTIVE
from	
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_LKP_AR_REVENUE_ADJUSTMENTS_ALL
*/


select 
	   

	   DISTINCT
	   AR_REVENUE_ADJUSTMENTS_ALL.REVENUE_ADJUSTMENT_ID REVENUE_ADJUSTMENT_ID,
	AR_REVENUE_ADJUSTMENTS_ALL.REVENUE_ADJUSTMENT_NUMBER REVENUE_ADJUSTMENT_NUMBER,
	AR_REVENUE_ADJUSTMENTS_ALL.REASON_CODE REASON_CODE,
	AR_REVENUE_ADJUSTMENTS_ALL.COMMENTS COMMENTS,
	AR_REVENUE_ADJUSTMENTS_ALL.CUSTOMER_TRX_ID CUSTOMER_TRX_ID,
	RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_LINE_ID CUSTOMER_TRX_LINE_ID,
	ROW_NUMBER()	OVER(PARTITION BY AR_REVENUE_ADJUSTMENTS_ALL.CUSTOMER_TRX_ID,RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_LINE_ID  ORDER BY AR_REVENUE_ADJUSTMENTS_ALL.LAST_UPDATE_DATE DESC) ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUST_TRX_LINE_GL_DIST_ALL"  RA_CUST_TRX_LINE_GL_DIST_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUSTOMER_TRX_LINES_ALL"   RA_CUSTOMER_TRX_LINES_ALL, 
 "PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUSTOMER_TRX_ALL"   RA_CUSTOMER_TRX_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD_AR"."AR_REVENUE_ADJUSTMENTS_ALL"   AR_REVENUE_ADJUSTMENTS_ALL
where	(1=1)
 And (RA_CUST_TRX_LINE_GL_DIST_ALL.REVENUE_ADJUSTMENT_ID = AR_REVENUE_ADJUSTMENTS_ALL.REVENUE_ADJUSTMENT_ID)
AND (RA_CUST_TRX_LINE_GL_DIST_ALL.CUSTOMER_TRX_LINE_ID = RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_LINE_ID)
AND (RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_ID = RA_CUSTOMER_TRX_ALL.CUSTOMER_TRX_ID)

And (RA_CUSTOMER_TRX_LINES_ALL.LINE_TYPE = 'LINE')
 And (AR_REVENUE_ADJUSTMENTS_ALL.REASON_CODE IN ('SI','IS'))
 And (RA_CUST_TRX_LINE_GL_DIST_ALL.ACCOUNT_CLASS = 'REV')
 
)   LKP_AR_REVENUE_ADJ_ALL
where	(1=1)   
),
SQ_LKP_TRANS as
(
 select	
	DISTINCT
	LKP_TRANS.CONTRACT_NUMBER	   C113_CONTRACT_NUMBER,
	LKP_TRANS.ORDER_NUMBER	   C130_ORDER_NUMBER
from	
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_LKP_TRANS
*/
SELECT  /*+PARALLEL(8)*/  DISTINCT  OKC_K_HEADERS_ALL_B.CONTRACT_NUMBER AS CONTRACT_NUMBER,  OE_ORDER_HEADERS_ALL.ORDER_NUMBER AS ORDER_NUMBER 
FROM 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_HEADERS_ALL_B" OKC_K_HEADERS_ALL_B,
   "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_ITEMS"  OKC_K_ITEMS, 
  "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_HEADERS_ALL" OE_ORDER_HEADERS_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_LINES_ALL"  OE_ORDER_LINES_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_LINES_B" OKC_K_LINES_B
WHERE OKC_K_ITEMS.JTOT_OBJECT1_CODE = 'OKX_CUSTPROD'
       AND OKC_K_ITEMS.OBJECT1_ID1 = OE_ORDER_LINES_ALL.SERVICE_REFERENCE_LINE_ID 
       AND OKC_K_ITEMS.DNZ_CHR_ID = OKC_K_HEADERS_ALL_B.ID
       AND OKC_K_LINES_B.DNZ_CHR_ID  = OKC_K_HEADERS_ALL_B.ID
       AND OKC_K_LINES_B.ID = OKC_K_ITEMS.CLE_ID
       AND OKC_K_LINES_B.LSE_ID=9
       AND OE_ORDER_LINES_ALL.SERVICE_REFERENCE_TYPE_CODE = 'CUSTOMER_PRODUCT'
       AND OE_ORDER_HEADERS_ALL.HEADER_ID = OE_ORDER_LINES_ALL.HEADER_ID
       AND (TO_DATE(OE_ORDER_LINES_ALL.SERVICE_START_DATE)=TO_DATE(OKC_K_HEADERS_ALL_B.START_DATE) OR 
            TO_DATE(OE_ORDER_LINES_ALL.SERVICE_START_DATE)=TO_DATE(OKC_K_LINES_B.START_DATE))
       AND (TO_DATE(OE_ORDER_LINES_ALL.SERVICE_END_DATE)=TO_DATE(OKC_K_HEADERS_ALL_B.END_DATE) OR 
            TO_DATE(OE_ORDER_LINES_ALL.SERVICE_END_DATE)=TO_DATE(OKC_K_LINES_B.END_DATE))
UNION
SELECT /*+PARALLEL(8)*/ DISTINCT OKC_K_HEADERS_ALL_B.CONTRACT_NUMBER AS CONTRACT_NUMBER, OE_ORDER_HEADERS_ALL.ORDER_NUMBER AS ORDER_NUMBER
FROM 
  "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_LINES_ALL" OE_ORDER_LINES_ALL ,
  "PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_ITEM_INSTANCES" CSI_ITEM_INSTANCES ,
  "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_HEADERS_ALL" OE_ORDER_HEADERS_ALL ,
   "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_ITEMS" OKC_K_ITEMS ,
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_HEADERS_ALL_B" OKC_K_HEADERS_ALL_B ,
   "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_LINES_B" OKC_K_LINES_B
WHERE  OE_ORDER_LINES_ALL.HEADER_ID = OE_ORDER_HEADERS_ALL.HEADER_ID
       AND SERVICE_REFERENCE_LINE_ID = CSI_ITEM_INSTANCES.LAST_OE_ORDER_LINE_ID
       AND OE_ORDER_LINES_ALL.SERVICE_REFERENCE_TYPE_CODE ='ORDER'
       AND OKC_K_ITEMS.JTOT_OBJECT1_CODE ='OKX_CUSTPROD'
       AND OKC_K_ITEMS.OBJECT1_ID1 = CSI_ITEM_INSTANCES.INSTANCE_ID
       AND OKC_K_HEADERS_ALL_B.ID = OKC_K_ITEMS.DNZ_CHR_ID
       AND OKC_K_LINES_B.ID = OKC_K_ITEMS.CLE_ID          
       AND OKC_K_LINES_B.LSE_ID=9
       AND (TO_DATE(OE_ORDER_LINES_ALL.SERVICE_START_DATE)=TO_DATE(OKC_K_HEADERS_ALL_B.START_DATE) OR 
            TO_DATE(OE_ORDER_LINES_ALL.SERVICE_START_DATE)=TO_DATE(OKC_K_LINES_B.START_DATE))
       AND (TO_DATE(OE_ORDER_LINES_ALL.SERVICE_END_DATE)=TO_DATE(OKC_K_HEADERS_ALL_B.END_DATE) OR 
            TO_DATE(OE_ORDER_LINES_ALL.SERVICE_END_DATE)=TO_DATE(OKC_K_LINES_B.END_DATE))
UNION
SELECT /*+PARALLEL(8)*/ DISTINCT OKC_K_HEADERS_ALL_B.CONTRACT_NUMBER AS CONTRACT_NUMBER, OE_ORDER_HEADERS_ALL.ORDER_NUMBER AS ORDER_NUMBER
  FROM "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_LINES_ALL" OE_ORDER_LINES_ALL,
       "PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_HEADERS_ALL" OE_ORDER_HEADERS_ALL,
       "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_ITEMS" OKC_K_ITEMS,
       "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_HEADERS_ALL_B" OKC_K_HEADERS_ALL_B,
        "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_LINES_B" OKC_K_LINES_B,      
       "PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_T_TRANSACTION_LINES" CSI_T_TRANSACTION_LINES,
       "PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_T_TXN_LINE_DETAILS" CSI_T_TXN_LINE_DETAILS,
       "PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_ITEM_INSTANCES" CSI_ITEM_INSTANCES
WHERE CSI_T_TRANSACTION_LINES.TRANSACTION_LINE_ID = CSI_T_TXN_LINE_DETAILS.TRANSACTION_LINE_ID
   AND CSI_T_TRANSACTION_LINES.SOURCE_TRANSACTION_TABLE ='OE_ORDER_LINES_ALL'
   AND CSI_T_TXN_LINE_DETAILS.INSTANCE_ID = CSI_ITEM_INSTANCES.INSTANCE_ID
  AND CSI_T_TRANSACTION_LINES.SOURCE_TRANSACTION_ID =OE_ORDER_LINES_ALL.LINE_ID
   AND OKC_K_ITEMS.JTOT_OBJECT1_CODE ='OKX_CUSTPROD'
   AND OKC_K_ITEMS.OBJECT1_ID1 = CSI_ITEM_INSTANCES.INSTANCE_ID
   AND OKC_K_HEADERS_ALL_B.ID = OKC_K_ITEMS.DNZ_CHR_ID
   AND OKC_K_LINES_B.ID = OKC_K_ITEMS.CLE_ID          
   AND OE_ORDER_LINES_ALL.HEADER_ID=OE_ORDER_HEADERS_ALL.HEADER_ID 

)   LKP_TRANS
where	(1=1)
),
SQ_LKP_SC_ORDER_ATTRIBUTES as(

    select	
	DISTINCT
	LKP_SC_ORDER_ATTRIBUTES.SIEBEL_ORDER_NUMBER	   C69_X_SIEBEL_ORDER_NUM,
	LKP_SC_ORDER_ATTRIBUTES.ATTRIBUTE10	   C85_ATTRIBUTE10,
	LKP_SC_ORDER_ATTRIBUTES.COVERED_INVENTORY_ITEM_ID	   C86_COVERED_INVENTORY_ITEM_ID,
	LKP_SC_ORDER_ATTRIBUTES.ORDER_NUMBER	   C91_ORDER_NUMBER,
	LKP_SC_ORDER_ATTRIBUTES.LINE_NUMBER	   C95_LINE_NUMBER,
	LKP_SC_ORDER_ATTRIBUTES.SERVICE_START_DATE	   C102_SERVICE_START_DATE,
	LKP_SC_ORDER_ATTRIBUTES.SERVICE_END_DATE	   C105_SERVICE_END_DATE,
	LKP_SC_ORDER_ATTRIBUTES.LICENSE_ID	   C108_LICENSE_ID,
	LKP_SC_ORDER_ATTRIBUTES.ORDER_DATE	   C110_ORDER_DATE,
	LKP_SC_ORDER_ATTRIBUTES.SIMPLIFIED_CONTRACT_NUM	   C114_SIMPLIFIED_CONTRACT_NUM,
	LKP_SC_ORDER_ATTRIBUTES.PRICING_ATTRIBUTE25	   C116_PRICING_ATTRIBUTE25,
	LKP_SC_ORDER_ATTRIBUTES.PRICING_ATTRIBUTE28	   C118_PRICING_ATTRIBUTE28,
	LKP_SC_ORDER_ATTRIBUTES.CUSTOMER_TRX_LINE_ID	   C129_CUSTOMER_TRX_LINE_ID
from	
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_LKP_SC_ORDER_ATTRIBUTES
*/


select 
	   

	   
	   MAX(OKHB.CONTRACT_NUMBER|| DECODE (OKHB.CONTRACT_NUMBER_MODIFIER,NULL, NULL,' ' || OKHB.CONTRACT_NUMBER_MODIFIER)) ORDER_NUMBER,
	MAX(OKHB.DATE_APPROVED) ORDER_DATE,
	MAX(TO_NUMBER(OKLS.LINE_NUMBER ||'.'||OKLB.LINE_NUMBER)) LINE_NUMBER,
	MAX(OKLB.START_DATE) SERVICE_START_DATE,
	MAX(OKLB.END_DATE) SERVICE_END_DATE,
	MAX(TO_CHAR(CII.SYSTEM_ID)) LICENSE_ID,
	MAX(MSI.INVENTORY_ITEM_ID) COVERED_INVENTORY_ITEM_ID,
	MAX(OKHB.CONTRACT_NUMBER) SIMPLIFIED_CONTRACT_NUM,
	MAX(CPAV2.PRICING_ATTRIBUTE25) PRICING_ATTRIBUTE25,
	MAX(CPAV2.PRICING_ATTRIBUTE28) PRICING_ATTRIBUTE28,
	MAX(CHRT.COGNOMEN) SIEBEL_ORDER_NUMBER,
	MAX(TO_CHAR(SOLD_CA.CUST_ACCOUNT_ID)) SOLD_TO_CUSTOMER_ID_SC,
	MAX(OKLB.ATTRIBUTE10) ATTRIBUTE10,
	RLA.CUSTOMER_TRX_LINE_ID CUSTOMER_TRX_LINE_ID
from	"PC_FIVETRAN_DB"."ERPPRD_OKS"."OKS_BILL_CONT_LINES"   OCL, 
 "PC_FIVETRAN_DB"."ERPPRD_OKS"."OKS_BILL_SUB_LINES"   OBL, 
"PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUSTOMER_TRX_LINES_ALL"  RLA, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_ITEMS"   OKI, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_LINES_B"   OKLB, 
 "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_LINES_B"   OKLS, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_HEADERS_TL"   CHRT, 
 "PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_ITEM_INSTANCES"   CII, 
  "PC_FIVETRAN_DB"."ERPPRD_INV"."MTL_SYSTEM_ITEMS_B"   MSI, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_PARTY_ROLES_B"   SOLD_TO_PARTY, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_PRICE_ATT_VALUES"   CPAV2, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_SOLD_CA
*/


select 
	   

	   
	   HZ_CUST_ACCOUNTS.PARTY_ID PARTY_ID,
	MAX(HZ_CUST_ACCOUNTS.CUST_ACCOUNT_ID) CUST_ACCOUNT_ID
from	"PC_FIVETRAN_DB"."ERPPRD_AR"."HZ_CUST_ACCOUNTS"   HZ_CUST_ACCOUNTS
where	(1=1)



Group By HZ_CUST_ACCOUNTS.PARTY_ID





)   SOLD_CA, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_CPAV
*/


select 
	   

	   
	   MAX(CPAV.ID) MAX_ID,
	CPAV.CLE_ID CLE_ID
from	"PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_PRICE_ATT_VALUES"   CPAV
where	(1=1)



Group By CPAV.CLE_ID





)   CPAV, "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_HEADERS_ALL_B"   OKHB
where	(1=1)
 And (OCL.ID = OBL.BCL_ID)
AND (RLA.SOURCE_DATA_KEY1 = OCL.CLE_ID)
AND (RLA.SOURCE_DATA_KEY2 = OBL.BCL_ID)
AND (OKLB.ID = OBL.CLE_ID)
AND (OKLB.ID = OKI.CLE_ID)
AND (MSI.INVENTORY_ITEM_ID = CII.INVENTORY_ITEM_ID AND MSI.ORGANIZATION_ID = CII.INV_MASTER_ORGANIZATION_ID)
AND (CII.INSTANCE_NUMBER = OKI.OBJECT1_ID1)
AND (OKLB.CLE_ID = OKLS.ID(+))
AND (OKLB.DNZ_CHR_ID = SOLD_TO_PARTY.DNZ_CHR_ID(+))
AND (TO_NUMBER (SOLD_TO_PARTY.OBJECT1_ID1) = SOLD_CA.PARTY_ID)
AND (OKLB.ID = CPAV.CLE_ID(+))
AND (CPAV.MAX_ID = CPAV2.ID(+))
AND (OKHB.ID = OKLB.DNZ_CHR_ID)
AND (OKHB.ID= CHRT.ID)

And (RLA.INTERFACE_LINE_CONTEXT = 'OKS CONTRACTS')
 And (RLA.INVOICED_LINE_ACCTG_LEVEL = 'S'
   AND RLA.LINE_TYPE = 'LINE')
 And (OKLS.LSE_ID(+) = 1)
 And (SOLD_TO_PARTY.JTOT_OBJECT1_CODE(+) = 'OKX_PARTY'
   AND SOLD_TO_PARTY.RLE_CODE(+) = 'CUSTOMER'
   AND SOLD_TO_PARTY.CHR_ID = SOLD_TO_PARTY.DNZ_CHR_ID)
 And (CHRT.LANGUAGE = 'US')


Group By RLA.CUSTOMER_TRX_LINE_ID


UNION ALL

select 
	   

	   
	   MAX(OKHB.CONTRACT_NUMBER|| DECODE (OKHB.CONTRACT_NUMBER_MODIFIER,NULL, NULL,' ' || OKHB.CONTRACT_NUMBER_MODIFIER)) ORDER_NUMBER,
	MAX(OKHB.DATE_APPROVED) ORDER_DATE,
	MAX(TO_NUMBER(OKLS.LINE_NUMBER ||'.'||OKLB.LINE_NUMBER)) LINE_NUMBER,
	MAX(OKLB.START_DATE) SERVICE_START_DATE,
	MAX(OKLB.END_DATE) SERVICE_END_DATE,
	MAX(TO_CHAR(CII.SYSTEM_ID)) LICENSE_ID,
	MAX(MSI.INVENTORY_ITEM_ID) COVERED_INVENTORY_ITEM_ID,
	MAX(OKHB.CONTRACT_NUMBER) SIMPLIFIED_CONTRACT_NUM,
	MAX(CPAV2.PRICING_ATTRIBUTE25) PRICING_ATTRIBUTE25,
	MAX(CPAV2.PRICING_ATTRIBUTE28) PRICING_ATTRIBUTE28,
	MAX(CHRT.COGNOMEN) SIEBEL_ORDER_NUMBER,
	MAX(TO_CHAR(SOLD_CA.CUST_ACCOUNT_ID)) SOLD_TO_CUSTOMER_ID_SC,
	MAX(OKLB.ATTRIBUTE10) ATTRIBUTE10,
	RLA.CUSTOMER_TRX_LINE_ID CUSTOMER_TRX_LINE_ID
from	"PC_FIVETRAN_DB"."ERPPRD_OKS"."OKS_BILL_CONT_LINES"    OCL, 
   "PC_FIVETRAN_DB"."ERPPRD_OKS"."OKS_BILL_SUB_LINES"   OBL, 
"PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUSTOMER_TRX_LINES_ALL"   RLA,
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_ITEMS"   OKI,
  "PC_FIVETRAN_DB"."ERPPRD_OKS"."OKS_BILL_TXN_LINES"   OBTL,
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_LINES_B"   OKLB,
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_LINES_B"   OKLS, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_HEADERS_ALL_B"   OKHB, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_HEADERS_TL"   CHRT, 
  "PC_FIVETRAN_DB"."ERPPRD_CSI"."CSI_ITEM_INSTANCES"   CII,
  "PC_FIVETRAN_DB"."ERPPRD_INV"."MTL_SYSTEM_ITEMS_B"   MSI, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_PRICE_ATT_VALUES"   CPAV2, 
  "PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_K_PARTY_ROLES_B"   SOLD_TO_PARTY, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_CPAV
*/


select 
	   

	   
	   MAX(CPAV.ID) MAX_ID,
	CPAV.CLE_ID CLE_ID
from	"PC_FIVETRAN_DB"."ERPPRD_OKC"."OKC_PRICE_ATT_VALUES"   CPAV
where	(1=1)



Group By CPAV.CLE_ID





)   CPAV, 
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_SOLD_CA
*/


select 
	   

	   
	   HZ_CUST_ACCOUNTS.PARTY_ID PARTY_ID,
	MAX(HZ_CUST_ACCOUNTS.CUST_ACCOUNT_ID) CUST_ACCOUNT_ID
from	"PC_FIVETRAN_DB"."ERPPRD_AR"."HZ_CUST_ACCOUNTS"  HZ_CUST_ACCOUNTS
where	(1=1)



Group By HZ_CUST_ACCOUNTS.PARTY_ID





)   SOLD_CA
where	(1=1)
 And (OCL.ID = OBL.BCL_ID)
AND (RLA.SOURCE_DATA_KEY1 = OCL.CLE_ID)
AND (RLA.SOURCE_DATA_KEY2 = OBL.BCL_ID)
AND (OKLB.ID = OBL.CLE_ID)
AND (OKLB.ID = OKI.CLE_ID)
AND (OBTL.BSL_ID = OBL.ID)
AND (OBTL.BILL_INSTANCE_NUMBER = RLA.INTERFACE_LINE_ATTRIBUTE3)
AND (OKHB.ID = OKLB.DNZ_CHR_ID)
AND (MSI.INVENTORY_ITEM_ID = CII.INVENTORY_ITEM_ID AND MSI.ORGANIZATION_ID = CII.INV_MASTER_ORGANIZATION_ID)
AND (CII.INSTANCE_NUMBER = OKI.OBJECT1_ID1)
AND (OKLB.CLE_ID = OKLS.ID(+))
AND (OKLB.ID = CPAV.CLE_ID(+))
AND (CPAV.MAX_ID = CPAV2.ID(+))
AND (OKLB.DNZ_CHR_ID = SOLD_TO_PARTY.DNZ_CHR_ID(+))
AND (TO_NUMBER (SOLD_TO_PARTY.OBJECT1_ID1) = SOLD_CA.PARTY_ID)
AND (OKHB.ID     = CHRT.ID)

And (RLA.INTERFACE_LINE_CONTEXT = 'OKS CONTRACTS')
 And (RLA.LINE_TYPE = 'LINE')
 And (RLA.INVOICED_LINE_ACCTG_LEVEL = 'D')
 And (OKLS.LSE_ID(+) = 1)
 And (SOLD_TO_PARTY.JTOT_OBJECT1_CODE(+) = 'OKX_PARTY'
   AND SOLD_TO_PARTY.RLE_CODE(+) = 'CUSTOMER'
   AND SOLD_TO_PARTY.CHR_ID = SOLD_TO_PARTY.DNZ_CHR_ID)


Group By RLA.CUSTOMER_TRX_LINE_ID





)   LKP_SC_ORDER_ATTRIBUTES
where	(1=1)
),
SQ_LKP_TAX_RATE as
(

 select	
	DISTINCT
	LKP_TAX_RATE.TAX_CODE	   C119_TAX_CODE,
	LKP_TAX_RATE.TAX_RATE	   C121_TAX_RATE,
	LKP_TAX_RATE.EXTENDED_AMOUNT	   C123_EXTENDED_AMOUNT,
	LKP_TAX_RATE.LINK_TO_CUST_TRX_LINE_ID	   C134_LINK_TO_CUST_TRX_LINE_ID,
	LKP_TAX_RATE.ACTIVE	   C135_ACTIVE
from	
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_LKP_TAX_RATE
*/


select 
	   

	   
	   ZX_LINES.TAX_RATE_CODE TAX_CODE,
	ZX_LINES.TAX_RATE TAX_RATE,
	RA_CUSTOMER_TRX_LINES_ALL.LINK_TO_CUST_TRX_LINE_ID LINK_TO_CUST_TRX_LINE_ID,
	RA_CUSTOMER_TRX_LINES_ALL.EXTENDED_AMOUNT EXTENDED_AMOUNT,
	ROW_NUMBER()	OVER(PARTITION BY RA_CUSTOMER_TRX_LINES_ALL.LINK_TO_CUST_TRX_LINE_ID ORDER BY ZX_LINES.LAST_UPDATE_DATE DESC) ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD_AR"."RA_CUSTOMER_TRX_LINES_ALL"   RA_CUSTOMER_TRX_LINES_ALL, "PC_FIVETRAN_DB"."ERPPRD_ZX"."ZX_LINES"    ZX_LINES
where	(1=1)
 And (RA_CUSTOMER_TRX_LINES_ALL.TAX_LINE_ID=ZX_LINES.TAX_LINE_ID)

And (RA_CUSTOMER_TRX_LINES_ALL.LINE_TYPE = 'TAX')







)   LKP_TAX_RATE
where	(1=1)   
),
SQ_LKP_TRANS1  as(

select	
	DISTINCT
	LKP_TRANS1.ATTRIBUTE2	   C79_X_REFERENCE_NUMBER,
	LKP_TRANS1.ORDER_NUMBER	   C136_ORDER_NUMBER
from	
( /* Subselect from SDE_ORA_SalesInvoiceLinesFact.W_SALES_INVOICE_LINE_FS.SQ_LKP_TRANS1
*/


select 
	   

	   
	   OE_ORDER_HEADERS_ALL.ORDER_NUMBER ORDER_NUMBER,
	OE_ORDER_HEADERS_ALL.ATTRIBUTE2 ATTRIBUTE2
from	"PC_FIVETRAN_DB"."ERPPRD_ONT"."OE_ORDER_HEADERS_ALL"   OE_ORDER_HEADERS_ALL
where	(1=1)








)   LKP_TRANS1
where	(1=1)
),

FINAL_INVOICE AS
(
	  
select	
	SALES_ORDLN_ID,
	SALES_PCKLN_ID,
	CHNL_TYPE_ID,
	COMPANY_ORG_ID,
	CUSTOMER_BILL_TO_LOC_ID,
	CUSTOMER_CNTCT_ID,
	CUSTOMER_PAYER_LOC_ID,
	CUSTOMER_SHIP_TO_LOC_ID,
	CUSTOMER_SOLD_TO_LOC_ID,
	FREIGHT_TERMS_ID,
	INVENTORY_ORG_ID,
	INVENTORY_PRODUCT_ID,
	INVOICE_STATUS_ID,
	OPERATING_UNIT_ORG_ID,
	ORDER_XACT_TYPE_ID,
	PAYMENT_METHOD_ID,
	PAYMENT_TERMS_ID,
	PLANT_LOC_ID,
	PRODUCT_ID,
	SALES_ORG_ID,
	SALES_PRODUCT_ID,
	SALES_REP_ID,
	TERR_ID,
	XACT_TYPE_ID,
	CONVERSION_DT,
	INVOICED_ON_DT,
	PAYMENT_TERMS_EFF_DT,
	POSTING_PERIOD_DT,
	NET_AMT,
	LIST_AMT,
	TAX_AMT,
	FREIGHT_AMT,
	DISCOUNT_AMT,
	INVOICED_QTY,
	SALES_UOM_CODE,
	INVOICE_NUM,
	INVOICE_ITEM,
	REF_DOC_NUM,
	SALES_ORDER_NUM,
	SALES_ORDER_ITEM,
	SALES_ORDER_ITEM_DETAIL_NUM,
	PURCH_ORDER_NUM,
	DELETE_FLG,
	DOC_CURR_CODE,
	LOC_CURR_CODE,
	LOC_EXCH_RATE_TYPE,
	LOC_EXCHANGE_RATE,
	EXCHANGE_DT,
	CREATED_BY_ID,
	CHANGED_BY_ID,
	CREATED_ON_DT,
	CHANGED_ON_DT,
	AUX1_CHANGED_ON_DT,
	AUX2_CHANGED_ON_DT,
	AUX4_CHANGED_ON_DT,
	DATASOURCE_NUM_ID,
	INTEGRATION_ID,
	SERVICE_FLG,
	ITEM_TYPE_CODE,
	LEDGER_ID,
	ORDER_SOURCE_ID,
	DISCOUNT_LINE_FLG,
	PROJECT_ID,
	TASK_ID,
	CUSTOMER_ACCOUNT_ID,
	XACT_SOURCE_ID,
	FULFILL_LINE_ID,
	INVOICE_HEADER_ID,
	X_ORDER_SOURCE,
	X_SERVICE_START_DT,
	X_SERVICE_END_DT,
	X_SERVICE_REF_TYPE_CODE,
	X_SERVICE_REF_LINE_ID,
	X_LICENSE_ID,
	X_ORDER_LINE_NUM,
	X_ORDER_DT,
	X_GL_DATE,
	X_GL_POSTED_DATE,
	X_PROJECT_ID,
	X_CUSTOMER_TRX_LINE_ID,
	X_SHIP_TO_CUSTOMER_ID,
	X_SOLD_TO_CUSTOMER_ID,
	X_BILL_TO_CUSTOMER_ID,
	X_CVRD_INV_ITEM_ID,
	X_BATCH_SOURCE,
	X_BATCH_NAME,
	X_CIS_DATE,
	X_SALESREP_ID,
	X_PROJECT_NAME,
	X_SERVICE_ITEM_FLAG,
	X_SIMPLIFIED_CONTRACT_NUM,
	X_REVN_TYPE_PRODUCT_ID,
	X_PRICING_ATTRIBUTE25,
	X_PRICING_ATTRIBUTE28,
	X_SIEBEL_ORDER_NUM,
	X_PS_BUSINESS_UNIT,
	X_SERVICE_LINE_DIRECTOR,
	X_PROJECT_MANAGER,
	X_TYPE_OF_SERVICE,
	X_PS_PRODUCT_GROUP,
	X_PS_REV_TYPE,
	X_TASK_NUMBER,
	X_TASK_NAME,
	X_VAT_TAX_CODE,
	X_PS_PRODUCT_UNIT,
	X_TAX_RATE,
	X_REFERENCE_NUMBER,
	X_TAX_AMT,
	X_FAE,
	X_COMMENTS,
	X_SALES_SPLIT_LINE_WID,
	to_varchar(CURRENT_TIMESTAMP, 'yyyy-MM-DD hh:mi:ss') LAST_DATE
FROM (	


select 	
	DISTINCT
	C1_SALES_ORDLN_ID SALES_ORDLN_ID,
	C2_SALES_PCKLN_ID SALES_PCKLN_ID,
	C3_CHNL_TYPE_ID CHNL_TYPE_ID,
	'COMPANY'||'~'||TO_CHAR(C82_LEGAL_ENTITY_ID) COMPANY_ORG_ID,
	LKP_W_CUST_LOC_USE_PS_INVC.ACCT_SITE_ID CUSTOMER_BILL_TO_LOC_ID,
	TO_CHAR(LKP_PARTY_CNTCT_CUST_CNTCT_ID.CONTACT_PARTY_ID) CUSTOMER_CNTCT_ID,
	LKP_W_CUST_LOC_USE_PS_PYR.ACCT_SITE_ID CUSTOMER_PAYER_LOC_ID,
	LKP_W_CUST_LOC_USE_PS_SHP.ACCT_SITE_ID CUSTOMER_SHIP_TO_LOC_ID,
	LKP_W_CUST_LOC_USE_PS_SLD.ACCT_SITE_ID CUSTOMER_SOLD_TO_LOC_ID,
	C4_FREIGHT_TERMS_ID FREIGHT_TERMS_ID,
	C5_INVENTORY_ORG_ID INVENTORY_ORG_ID,
	C6_INVENTORY_PRODUCT_ID INVENTORY_PRODUCT_ID,
	C7_INVOICE_STATUS_ID INVOICE_STATUS_ID,
	C8_OPERATING_UNIT_ORG_ID OPERATING_UNIT_ORG_ID,
	C9_ORDER_XACT_TYPE_ID ORDER_XACT_TYPE_ID,
	C10_PAYMENT_METHOD_ID PAYMENT_METHOD_ID,
	C11_PAYMENT_TERMS_ID PAYMENT_TERMS_ID,
	C12_PLANT_LOC_ID PLANT_LOC_ID,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN TO_CHAR(C84_O_CVRNG_INV_ITEM_ID_OM)
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN TO_CHAR(C83_INVENTORY_ITEM_ID)||'~'||case when C73_X_TYPE_OF_SERVICE='Aptiv Developer' THEN 'MAINTENANCE' ELSE	
DECODE(C76_X_TASK_NUMBER, '1.0', 'SERVICES',
'10.0','SERVICES', 
'2.0','SERVICES',
'12.0','SERVICES',
'13.0',CASE WHEN  UPPER(C70_X_PS_BUSINESS_UNIT) LIKE '%EDUCATION%' THEN  'TRAINING' ELSE 'SERVICES'
                END,
'9.0','TRAINING',
'11.0', (CASE
WHEN  UPPER(C70_X_PS_BUSINESS_UNIT) LIKE'%PREMIUM SUPPORT%' THEN  'MAINTENANCE'
ELSE  'SERVICES'
END ), 'SERVICES') END
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN (CASE
WHEN C85_ATTRIBUTE10='Y' THEN TO_CHAR(C87_INVENTORY_ITEM_ID)
ELSE TO_CHAR(C86_COVERED_INVENTORY_ITEM_ID)
END )
ELSE NULL
END )
END )
END ) PRODUCT_ID,
	C13_SALES_ORG_ID SALES_ORG_ID,
	C14_SALES_PRODUCT_ID SALES_PRODUCT_ID,
	TO_CHAR(C88_SALESREP_ID) SALES_REP_ID,
	C15_TERR_ID TERR_ID,
	C16_XACT_TYPE_ID XACT_TYPE_ID,
	C17_CONVERSION_DT CONVERSION_DT,
	C18_INVOICED_ON_DT INVOICED_ON_DT,
	C19_PAYMENT_TERMS_EFF_DT PAYMENT_TERMS_EFF_DT,
	C20_POSTING_PERIOD_DT POSTING_PERIOD_DT,
	C21_NET_AMT NET_AMT,
	C22_LIST_AMT LIST_AMT,
	C23_TAX_AMT TAX_AMT,
	C24_FREIGHT_AMT FREIGHT_AMT,
	C25_DISCOUNT_AMT DISCOUNT_AMT,
	C26_INVOICED_QTY INVOICED_QTY,
	COALESCE(C89_UOM_CODE,'__UNASSIGNED__') SALES_UOM_CODE,
	C27_INVOICE_NUM INVOICE_NUM,
	C28_INVOICE_ITEM INVOICE_ITEM,
	C29_REF_DOC_NUM REF_DOC_NUM,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN TO_CHAR(C92_ORDER_NUMBER)
ELSE (CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN TO_CHAR(C90_ORDER_NUMBER)
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN TO_CHAR(C91_ORDER_NUMBER)
ELSE NULL

END )
END )
END ) SALES_ORDER_NUM,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN TO_CHAR(C93_LINE_NUMBER)
ELSE (CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN TO_CHAR(C94_LINE_NUMBER)
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN TO_CHAR(C95_LINE_NUMBER)
ELSE NULL

END )
END )
END ) SALES_ORDER_ITEM,
	C30_SALES_ORDER_ITEM_DETAIL_NU SALES_ORDER_ITEM_DETAIL_NUM,
	C31_PURCH_ORDER_NUM PURCH_ORDER_NUM,
	C32_DELETE_FLG DELETE_FLG,
	COALESCE(C96_INVOICE_CURRENCY_CODE,'__UNASSIGNED__') DOC_CURR_CODE,
	COALESCE(C97_LOC_CURR_CODE,'__UNASSIGNED__') LOC_CURR_CODE,
	C33_LOC_EXCH_RATE_TYPE LOC_EXCH_RATE_TYPE,
	C34_LOC_EXCHANGE_RATE LOC_EXCHANGE_RATE,
	C35_EXCHANGE_DT EXCHANGE_DT,
	C36_CREATED_BY_ID CREATED_BY_ID,
	C37_CHANGED_BY_ID CHANGED_BY_ID,
	C38_CREATED_ON_DT CREATED_ON_DT,
	C39_CHANGED_ON_DT CHANGED_ON_DT,
	C40_AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
	C41_AUX2_CHANGED_ON_DT AUX2_CHANGED_ON_DT,
	GREATEST(
COALESCE(LKP_W_CUST_LOC_USE_PS_SHP.AUX1_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SHP.AUX2_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SHP.AUX3_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SHP.AUX4_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SHP.CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_PYR.AUX1_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_PYR.AUX2_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_PYR.AUX3_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_PYR.AUX4_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_PYR.CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_INVC.AUX1_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_INVC.AUX2_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_INVC.AUX3_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_INVC.AUX4_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_INVC.CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SLD.AUX1_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SLD.AUX2_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SLD.AUX3_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SLD.AUX4_CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS')),
COALESCE(LKP_W_CUST_LOC_USE_PS_SLD.CHANGED_ON_DT,TO_DATE(SUBSTR('1899-01-01 00:00:00',0,19),'YYYY-MM-DD HH24:MI:SS'))
) AUX4_CHANGED_ON_DT,
	380 DATASOURCE_NUM_ID,
	C42_INTEGRATION_ID INTEGRATION_ID,
	C43_SERVICE_FLG SERVICE_FLG,
	C44_ITEM_TYPE_CODE ITEM_TYPE_CODE,
	C45_LEDGER_ID LEDGER_ID,
	C46_ORDER_SOURCE_ID ORDER_SOURCE_ID,
	(CASE
WHEN NOT C98_INTERFACE_LINE_ATTRIBUTE11 IS NULL AND C98_INTERFACE_LINE_ATTRIBUTE11 <> '0' AND C99_TYPE='INV' THEN 'Y'
ELSE 'N'
END ) DISCOUNT_LINE_FLG,
	C47_PROJECT_ID PROJECT_ID,
	C48_TASK_ID TASK_ID,
	C49_CUSTOMER_ACCOUNT_ID CUSTOMER_ACCOUNT_ID,
	C50_XACT_SOURCE_ID XACT_SOURCE_ID,
	C51_FULFILL_LINE_ID FULFILL_LINE_ID,
	C52_INVOICE_HEADER_ID INVOICE_HEADER_ID,
	C53_X_ORDER_SOURCE X_ORDER_SOURCE,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN C100_SERVICE_START_DATE
ELSE (CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN C101_SERVICE_START_DATE
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN C102_SERVICE_START_DATE
ELSE NULL
END )
END )
END ) X_SERVICE_START_DT,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN C103_SERVICE_END_DATE
ELSE (CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN C104_SERVICE_END_DATE
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN C105_SERVICE_END_DATE
ELSE NULL
END )
END )
END ) X_SERVICE_END_DT,
	C54_X_SERVICE_REF_TYPE_CODE X_SERVICE_REF_TYPE_CODE,
	C55_X_SERVICE_REF_LINE_ID X_SERVICE_REF_LINE_ID,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN C106_X_LICENSE_ID
ELSE (CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN ('999.'||TO_CHAR(C107_PROJECT_ID))
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN C108_LICENSE_ID
ELSE NULL
END )
END )
END ) X_LICENSE_ID,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN TO_CHAR(C93_LINE_NUMBER)
ELSE (CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN TO_CHAR(C94_LINE_NUMBER)
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN TO_CHAR(C95_LINE_NUMBER)
ELSE NULL

END )
END )
END ) X_ORDER_LINE_NUM,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN C111_ORDERED_DATE
ELSE (CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN C109_ORDER_DATE
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN C110_ORDER_DATE
ELSE NULL
END )
END )
END ) X_ORDER_DT,
	C56_X_GL_DATE X_GL_DATE,
	C57_X_GL_POSTED_DATE X_GL_POSTED_DATE,
	C58_X_PROJECT_ID X_PROJECT_ID,
	C59_X_CUSTOMER_TRX_LINE_ID X_CUSTOMER_TRX_LINE_ID,
	C60_X_SHIP_TO_CUSTOMER_ID X_SHIP_TO_CUSTOMER_ID,
	C61_X_SOLD_TO_CUSTOMER_ID X_SOLD_TO_CUSTOMER_ID,
	C62_X_BILL_TO_CUSTOMER_ID X_BILL_TO_CUSTOMER_ID,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN C112_O_CVRD_INV_ITEM_ID
ELSE (CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN NULL
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN (CASE
WHEN C85_ATTRIBUTE10='Y' THEN C86_COVERED_INVENTORY_ITEM_ID
ELSE C87_INVENTORY_ITEM_ID
END )
ELSE NULL
END )
END )
END ) X_CVRD_INV_ITEM_ID,
	C63_X_BATCH_SOURCE X_BATCH_SOURCE,
	C64_X_BATCH_NAME X_BATCH_NAME,
	C65_X_CIS_DATE X_CIS_DATE,
	C66_X_SALESREP_ID X_SALESREP_ID,
	C67_X_PROJECT_NAME X_PROJECT_NAME,
	C68_X_SERVICE_ITEM_FLAG X_SERVICE_ITEM_FLAG,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN "MAX"(C113_CONTRACT_NUMBER)OVER (PARTITION BY C59_X_CUSTOMER_TRX_LINE_ID)
ELSE (CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN NULL
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN "MAX"(C114_SIMPLIFIED_CONTRACT_NUM) OVER (PARTITION BY C59_X_CUSTOMER_TRX_LINE_ID)
ELSE NULL
END )
END )
END ) X_SIMPLIFIED_CONTRACT_NUM,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN TO_CHAR(C87_INVENTORY_ITEM_ID)
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='PROJECTS INVOICES' THEN (CASE
WHEN C83_INVENTORY_ITEM_ID||'~'||
case when C73_X_TYPE_OF_SERVICE='Aptiv Developer' THEN 'MAINTENANCE' ELSE	
DECODE(C76_X_TASK_NUMBER, '1.0', 'SERVICES',
'10.0','SERVICES', 
'2.0','SERVICES',
'12.0','SERVICES',
'13.0',CASE WHEN  UPPER(C70_X_PS_BUSINESS_UNIT) LIKE '%EDUCATION%'  THEN  'TRAINING' ELSE 'SERVICES'
                END,
'9.0','TRAINING',
'11.0', (CASE
WHEN  UPPER(C70_X_PS_BUSINESS_UNIT) LIKE '%PREMIUM SUPPORT%'  THEN  'MAINTENANCE'
ELSE  'SERVICES'
END ), 'SERVICES') END
 IS NULL THEN 'WR~PS-PROD~'
ELSE C83_INVENTORY_ITEM_ID||'~'||
case when C73_X_TYPE_OF_SERVICE='Aptiv Developer' THEN 'MAINTENANCE' ELSE	
DECODE(C76_X_TASK_NUMBER, '1.0', 'SERVICES',
'10.0','SERVICES', 
'2.0','SERVICES',
'12.0','SERVICES',
'13.0',CASE WHEN UPPER(C70_X_PS_BUSINESS_UNIT) LIKE '%EDUCATION%'  THEN  'TRAINING' ELSE 'SERVICES'
                END,
'9.0','TRAINING',
'11.0', (CASE
WHEN UPPER(C70_X_PS_BUSINESS_UNIT) LIKE '%PREMIUM SUPPORT%' THEN  'MAINTENANCE'
ELSE  'SERVICES'
END ), 'SERVICES') END

END )
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN TO_CHAR(C87_INVENTORY_ITEM_ID)
ELSE NULL
END )
END )
END ) X_REVN_TYPE_PRODUCT_ID,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN  C115_PRICING_ATTRIBUTE25
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN C116_PRICING_ATTRIBUTE25
ELSE  NULL
END )
END ) X_PRICING_ATTRIBUTE25,
	(CASE
WHEN C53_X_ORDER_SOURCE IS NULL OR C53_X_ORDER_SOURCE = 'ORDER ENTRY' THEN  C117_PRICING_ATTRIBUTE28
ELSE 
(CASE
WHEN C53_X_ORDER_SOURCE='OKS CONTRACTS' THEN C118_PRICING_ATTRIBUTE28
ELSE  NULL
END )
END ) X_PRICING_ATTRIBUTE28,
	C69_X_SIEBEL_ORDER_NUM X_SIEBEL_ORDER_NUM,
	C70_X_PS_BUSINESS_UNIT X_PS_BUSINESS_UNIT,
	C71_X_SERVICE_LINE_DIRECTOR X_SERVICE_LINE_DIRECTOR,
	C72_X_PROJECT_MANAGER X_PROJECT_MANAGER,
	C73_X_TYPE_OF_SERVICE X_TYPE_OF_SERVICE,
	C74_X_PS_PRODUCT_GROUP X_PS_PRODUCT_GROUP,
	C75_X_PS_REV_TYPE X_PS_REV_TYPE,
	C76_X_TASK_NUMBER X_TASK_NUMBER,
	C77_X_TASK_NAME X_TASK_NAME,
	(CASE
WHEN C119_TAX_CODE IS NULL THEN C120_VAT_TAX_CODE
ELSE C119_TAX_CODE
END ) X_VAT_TAX_CODE,
	C78_X_PS_PRODUCT_UNIT X_PS_PRODUCT_UNIT,
	(CASE
WHEN C121_TAX_RATE IS NULL THEN C122_VAT_TAX_RATE
ELSE C121_TAX_RATE
END ) X_TAX_RATE,
	C79_X_REFERENCE_NUMBER X_REFERENCE_NUMBER,
	C123_EXTENDED_AMOUNT X_TAX_AMT,
	C80_X_FAE X_FAE,
	C81_X_COMMENTS X_COMMENTS ,
	case when C107_PROJECT_ID is null then C59_X_CUSTOMER_TRX_LINE_ID else C107_PROJECT_ID end  X_SALES_SPLIT_LINE_WID
from	((((((((((slaesinvoice LEFT OUTER JOIN 
( /* Subselect from LKP_W_CUST_LOC_USE_PS_SLD_TO_ID
*/


select 
	   

	   
	   W_CUST_LOC_USE_PS.ACCT_SITE_ID ACCT_SITE_ID,
	W_CUST_LOC_USE_PS.CUST_ACCNT_ID CUST_ACCNT_ID,
	W_CUST_LOC_USE_PS.SITE_USE_ID SITE_USE_ID,
	W_CUST_LOC_USE_PS.DATASOURCE_NUM_ID DATASOURCE_NUM_ID,
	W_CUST_LOC_USE_PS.SRC_EFF_FROM_DT SRC_EFF_FROM_DT,
	W_CUST_LOC_USE_PS.SRC_EFF_TO_DT SRC_EFF_TO_DT,
	W_CUST_LOC_USE_PS.CHANGED_ON_DT CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX2_CHANGED_ON_DT AUX2_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX3_CHANGED_ON_DT AUX3_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX4_CHANGED_ON_DT AUX4_CHANGED_ON_DT
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_CUST_LOC_USE_PS"   W_CUST_LOC_USE_PS
where	(1=1)

And (W_CUST_LOC_USE_PS.SITE_USE_CODE IN ('SOLD_TO', 'BILL_TO'))







)    LKP_W_CUST_LOC_USE_PS_SLD ON TO_CHAR(C124_SOLD_TO_SITE_USE_ID) =LKP_W_CUST_LOC_USE_PS_SLD.SITE_USE_ID 
AND 	380=LKP_W_CUST_LOC_USE_PS_SLD.DATASOURCE_NUM_ID 
AND 	C38_CREATED_ON_DT >=LKP_W_CUST_LOC_USE_PS_SLD.SRC_EFF_FROM_DT 
AND 	C38_CREATED_ON_DT <LKP_W_CUST_LOC_USE_PS_SLD.SRC_EFF_TO_DT) LEFT OUTER JOIN 
( /* Subselect from LKP_W_CUST_LOC_USE_PS_PYR_TO_ID
*/


select 
	   

	   
	   W_CUST_LOC_USE_PS.ACCT_SITE_ID ACCT_SITE_ID,
	W_CUST_LOC_USE_PS.CUST_ACCNT_ID CUST_ACCNT_ID,
	W_CUST_LOC_USE_PS.SITE_USE_ID SITE_USE_ID,
	W_CUST_LOC_USE_PS.DATASOURCE_NUM_ID DATASOURCE_NUM_ID,
	W_CUST_LOC_USE_PS.SRC_EFF_FROM_DT SRC_EFF_FROM_DT,
	W_CUST_LOC_USE_PS.SRC_EFF_TO_DT SRC_EFF_TO_DT,
	W_CUST_LOC_USE_PS.CHANGED_ON_DT CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX2_CHANGED_ON_DT AUX2_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX3_CHANGED_ON_DT AUX3_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX4_CHANGED_ON_DT AUX4_CHANGED_ON_DT
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_CUST_LOC_USE_PS"   W_CUST_LOC_USE_PS
where	(1=1)

And (W_CUST_LOC_USE_PS.SITE_USE_CODE IN ('BILL_TO','DRAWEE'))







)    LKP_W_CUST_LOC_USE_PS_PYR ON TO_CHAR(COALESCE(C125_PAYING_SITE_USE_ID,C126_BILL_TO_SITE_USE_ID)) =LKP_W_CUST_LOC_USE_PS_PYR.SITE_USE_ID 
AND  	380 =LKP_W_CUST_LOC_USE_PS_PYR.DATASOURCE_NUM_ID
AND	C38_CREATED_ON_DT >=LKP_W_CUST_LOC_USE_PS_PYR.SRC_EFF_FROM_DT
AND	C38_CREATED_ON_DT <LKP_W_CUST_LOC_USE_PS_PYR.SRC_EFF_TO_DT) LEFT OUTER JOIN 
( /* Subselect from LKP_W_CUST_LOC_USE_PS_SHP_TO_ID
*/


select 
	   

	   
	   W_CUST_LOC_USE_PS.ACCT_SITE_ID ACCT_SITE_ID,
	W_CUST_LOC_USE_PS.CUST_ACCNT_ID CUST_ACCNT_ID,
	W_CUST_LOC_USE_PS.TERRITORY_ID TERRITORY_ID,
	W_CUST_LOC_USE_PS.SITE_USE_ID SITE_USE_ID,
	W_CUST_LOC_USE_PS.DATASOURCE_NUM_ID DATASOURCE_NUM_ID,
	W_CUST_LOC_USE_PS.SRC_EFF_FROM_DT SRC_EFF_FROM_DT,
	W_CUST_LOC_USE_PS.SRC_EFF_TO_DT SRC_EFF_TO_DT,
	W_CUST_LOC_USE_PS.CHANGED_ON_DT CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX2_CHANGED_ON_DT AUX2_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX3_CHANGED_ON_DT AUX3_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX4_CHANGED_ON_DT AUX4_CHANGED_ON_DT
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_CUST_LOC_USE_PS"   W_CUST_LOC_USE_PS
where	(1=1)

And (W_CUST_LOC_USE_PS.SITE_USE_CODE = 'SHIP_TO')







)    LKP_W_CUST_LOC_USE_PS_SHP ON TO_CHAR(C127_SHIP_TO_SITE_USE_ID) =LKP_W_CUST_LOC_USE_PS_SHP.SITE_USE_ID
AND	380 =LKP_W_CUST_LOC_USE_PS_SHP.DATASOURCE_NUM_ID
AND	C38_CREATED_ON_DT >=LKP_W_CUST_LOC_USE_PS_SHP.SRC_EFF_FROM_DT
AND	C38_CREATED_ON_DT <LKP_W_CUST_LOC_USE_PS_SHP.SRC_EFF_TO_DT) LEFT OUTER JOIN 
( /* Subselect from LKP_W_CUST_LOC_USE_PS_INVC_TO_ID
*/


select 
	   

	   
	   W_CUST_LOC_USE_PS.ACCT_SITE_ID ACCT_SITE_ID,
	W_CUST_LOC_USE_PS.CUST_ACCNT_ID CUST_ACCNT_ID,
	W_CUST_LOC_USE_PS.SITE_USE_ID SITE_USE_ID,
	W_CUST_LOC_USE_PS.DATASOURCE_NUM_ID DATASOURCE_NUM_ID,
	W_CUST_LOC_USE_PS.SRC_EFF_FROM_DT SRC_EFF_FROM_DT,
	W_CUST_LOC_USE_PS.SRC_EFF_TO_DT SRC_EFF_TO_DT,
	W_CUST_LOC_USE_PS.CHANGED_ON_DT CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX2_CHANGED_ON_DT AUX2_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX3_CHANGED_ON_DT AUX3_CHANGED_ON_DT,
	W_CUST_LOC_USE_PS.AUX4_CHANGED_ON_DT AUX4_CHANGED_ON_DT
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_CUST_LOC_USE_PS"   W_CUST_LOC_USE_PS
where	(1=1)

And (W_CUST_LOC_USE_PS.SITE_USE_CODE = 'BILL_TO')







)    LKP_W_CUST_LOC_USE_PS_INVC ON TO_CHAR(C126_BILL_TO_SITE_USE_ID) = LKP_W_CUST_LOC_USE_PS_INVC.SITE_USE_ID
AND	380 = LKP_W_CUST_LOC_USE_PS_INVC.DATASOURCE_NUM_ID
AND	C38_CREATED_ON_DT >= LKP_W_CUST_LOC_USE_PS_INVC.SRC_EFF_FROM_DT
AND	C38_CREATED_ON_DT < LKP_W_CUST_LOC_USE_PS_INVC.SRC_EFF_TO_DT) LEFT OUTER JOIN PA_ORDER_ATTRIBUTES ON C59_X_CUSTOMER_TRX_LINE_ID=C128_CUSTOMER_TRX_LINE_ID) 
LEFT OUTER JOIN SQ_LKP_SC_ORDER_ATTRIBUTES ON C59_X_CUSTOMER_TRX_LINE_ID=C129_CUSTOMER_TRX_LINE_ID) LEFT OUTER JOIN 
SQ_LKP_TRANS ON C92_ORDER_NUMBER=C130_ORDER_NUMBER) LEFT OUTER JOIN 
SQ_LKP_AR_REVENUE_ADJUSTMENTS_ALL ON C52_INVOICE_HEADER_ID=C131_CUSTOMER_TRX_ID AND C59_X_CUSTOMER_TRX_LINE_ID=C132_CUSTOMER_TRX_LINE_ID AND C133_ACTIVE=1) LEFT OUTER JOIN 
SQ_LKP_TAX_RATE ON C59_X_CUSTOMER_TRX_LINE_ID=C134_LINK_TO_CUST_TRX_LINE_ID AND C135_ACTIVE=1) LEFT OUTER JOIN SQ_LKP_TRANS1 ON C92_ORDER_NUMBER=C136_ORDER_NUMBER) LEFT OUTER JOIN 
( /* Subselect from LKP_PARTY_CONTACT_CUST_CONTACT_ID
*/


select 
	   

	   
	   W_ORA_PARTY_CONTACT_PS.CONTACT_PARTY_ID CONTACT_PARTY_ID,
	W_ORA_PARTY_CONTACT_PS.CUST_ACCOUNT_ROLE_ID CUST_ACCOUNT_ROLE_ID,
	W_ORA_PARTY_CONTACT_PS.DATASOURCE_NUM_ID DATASOURCE_NUM_ID,
	DECODE(ROW_NUMBER() OVER (PARTITION BY 
	W_ORA_PARTY_CONTACT_PS.CUST_ACCOUNT_ROLE_ID,W_ORA_PARTY_CONTACT_PS.DATASOURCE_NUM_ID ORDER BY 
	W_ORA_PARTY_CONTACT_PS.CONTACT_PARTY_ID
),1,1,0) LKP_ACTIVE
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_ORA_PARTY_CONTACT_PS"   W_ORA_PARTY_CONTACT_PS
where	(1=1)

And (W_ORA_PARTY_CONTACT_PS.CUST_ACCOUNT_ROLE_ID>0)







)    LKP_PARTY_CNTCT_CUST_CNTCT_ID ON C137_SOLD_TO_CONTACT_ID = LKP_PARTY_CNTCT_CUST_CNTCT_ID.CUST_ACCOUNT_ROLE_ID
AND	380= LKP_PARTY_CNTCT_CUST_CNTCT_ID.DATASOURCE_NUM_ID AND LKP_PARTY_CNTCT_CUST_CNTCT_ID.LKP_ACTIVE=1
where		(1=1)	






)    ODI_GET_FROM

)

SELECT * FROM FINAL_INVOICE







