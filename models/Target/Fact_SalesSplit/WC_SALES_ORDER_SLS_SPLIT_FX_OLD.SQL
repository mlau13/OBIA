{{ config (
    materialized="table"
)}}


select	
	X_SALES_SPLIT_LINE_WID,
	SALESREP_ID,
	SALES_REP_WID,
	PERCENT,
	SALES_REP_TERR_WID,
	CREDIT_TYPE_CODE,
	ORIG_SALESFORCE_ACCOUNT_ID,
	SPLIT_SALESFORCE_ACCOUNT_ID
	
FROM (	


select 	
	
	WC_BKGS_SPLIT_OLD_SQ.LINE_ID X_SALES_SPLIT_LINE_WID,
	WC_BKGS_SPLIT_OLD_SQ.SALESREP_ID SALESREP_ID,
	WC_BKGS_SPLIT_OLD_SQ.SALES_REP_WID SALES_REP_WID,
	WC_BKGS_SPLIT_OLD_SQ.PERCENT PERCENT,
	WC_BKGS_SPLIT_OLD_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	COALESCE(WC_BKGS_SPLIT_OLD_SQ.CREDIT_TYPE_CODE,'Unspecified') CREDIT_TYPE_CODE,
	null ORIG_SALESFORCE_ACCOUNT_ID,
	null SPLIT_SALESFORCE_ACCOUNT_ID 
from	
( /* Subselect from WR_SIL_SalesSplitFact_Order.WC_SALES_ORDER_SLS_SPLIT_FX_OLD_TMP
*/


select 
	   

	   
	   WC_INV_SC_SALES_SPL_TMP_SQ.LINE_ID LINE_ID,
	WC_INV_SC_SALES_SPL_TMP_SQ.SALESREP_ID SALESREP_ID,
	WC_INV_SC_SALES_SPL_TMP_SQ.SALES_REP_WID SALES_REP_WID,
	WC_INV_SC_SALES_SPL_TMP_SQ.PERCENT PERCENT,
	WC_INV_SC_SALES_SPL_TMP_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	WC_INV_SC_SALES_SPL_TMP_SQ.CREDIT_TYPE_CODE CREDIT_TYPE_CODE
from	(

select 	
	WC_INV_SC_SALES_SPL_TMP.LINE_ID    LINE_ID,	WC_INV_SC_SALES_SPL_TMP.SALESREP_ID    SALESREP_ID,	SUM (WC_INV_SC_SALES_SPL_TMP.EXTENDED_AMOUNT
           * WC_INV_SC_SALES_SPL_TMP.REVENUE_PERCENT_SPLIT)
         / DECODE (WC_INV_SC_SALES_SPL_TMP.TOTAL_LINE_AMT, 0, DECODE(sum(WC_INV_SC_SALES_SPL_TMP.EXTENDED_AMOUNT),0,1,sum(WC_INV_SC_SALES_SPL_TMP.EXTENDED_AMOUNT)),
                   WC_INV_SC_SALES_SPL_TMP.TOTAL_LINE_AMT)    PERCENT,	MAX(WC_INV_SC_SALES_SPL_TMP.INVOICED_ON_DT)    ORDERED_DATE,	
 -- WC_INV_SC_SALES_SPL_TMP.DATASOURCE_NUM_ID    DATASOURCE_NUM_ID,	
  WC_INV_SC_SALES_SPL_TMP.PERSON_ID    PERSON_ID,	WC_INV_SC_SALES_SPL_TMP.TOTAL_LINE_AMT    TOTAL_LINE_AMT,	
  MAX(W_EMPLOYEE_D.INTEGRATION_ID)    SALES_REP_WID,	MAX(WC_SALESREP_TERRITORY_D.INTEGRATION_ID)    SALES_REP_TERR_WID,	null    CREDIT_TYPE_CODE
from	"PC_FIVETRAN_DB"."OBIEE_DW"."WC_INV_SC_SALES_SPL_TMP"   WC_INV_SC_SALES_SPL_TMP, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."W_EMPLOYEE_D"   W_EMPLOYEE_D, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALESREP_TERRITORIES_D"   WC_SALESREP_TERRITORY_D
where	(1=1)
 And ((CASE
WHEN WC_INV_SC_SALES_SPL_TMP.PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(WC_INV_SC_SALES_SPL_TMP.SALESREP_ID)
ELSE 'PER~'||TO_CHAR(WC_INV_SC_SALES_SPL_TMP.PERSON_ID) 
END )=W_EMPLOYEE_D.INTEGRATION_ID (+))
AND (WC_INV_SC_SALES_SPL_TMP.SALESREP_ID=WC_SALESREP_TERRITORY_D.INTEGRATION_ID (+))
--And (W_EMPLOYEE_D.CURRENT_FLG (+)='Y')
Group By WC_INV_SC_SALES_SPL_TMP.LINE_ID,
 WC_INV_SC_SALES_SPL_TMP.SALESREP_ID,
 --WC_INV_SC_SALES_SPL_TMP.DATASOURCE_NUM_ID,
 WC_INV_SC_SALES_SPL_TMP.PERSON_ID,
 WC_INV_SC_SALES_SPL_TMP.TOTAL_LINE_AMT

)   WC_INV_SC_SALES_SPL_TMP_SQ
where	(1=1)





UNION

select 
	   

	   
	   WC_BKG_SC_SALES_SPL_TMP_SQ.LINE_ID LINE_ID,
	WC_BKG_SC_SALES_SPL_TMP_SQ.SALESREP_ID SALESREP_ID,
	WC_BKG_SC_SALES_SPL_TMP_SQ.SALES_REP_WID SALES_REP_WID,
	WC_BKG_SC_SALES_SPL_TMP_SQ.PERCENT PERCENT,
	WC_BKG_SC_SALES_SPL_TMP_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	WC_BKG_SC_SALES_SPL_TMP_SQ.CREDIT_TYPE_CODE CREDIT_TYPE_CODE
from	(

select 	
	WC_BKG_SC_SALES_SPL_TMP.LINE_ID    LINE_ID,	WC_BKG_SC_SALES_SPL_TMP.SALESREP_ID    SALESREP_ID,	WC_BKG_SC_SALES_SPL_TMP.PERCENT    PERCENT,	
  TO_DATE(WC_BKG_SC_SALES_SPL_TMP.ORDERED_DATE)    ORDERED_DATE,
  --WC_BKG_SC_SALES_SPL_TMP.DATASOURCE_NUM_ID    DATASOURCE_NUM_ID,
  WC_BKG_SC_SALES_SPL_TMP.PERSON_ID    PERSON_ID,	MAX(W_EMPLOYEE_D.INTEGRATION_ID)    SALES_REP_WID,	MAX(WC_SALESREP_TERRITORY_D.INTEGRATION_ID)    SALES_REP_TERR_WID,	null    CREDIT_TYPE_CODE
from	"PC_FIVETRAN_DB"."OBIEE_DW"."WC_BKG_SC_SALES_SPL_TMP"   WC_BKG_SC_SALES_SPL_TMP, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."W_EMPLOYEE_D"   W_EMPLOYEE_D,
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALESREP_TERRITORIES_D"   WC_SALESREP_TERRITORY_D
where	(1=1)
 And ((CASE
WHEN WC_BKG_SC_SALES_SPL_TMP.PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(WC_BKG_SC_SALES_SPL_TMP.SALESREP_ID)
ELSE 'PER~'||TO_CHAR(WC_BKG_SC_SALES_SPL_TMP.PERSON_ID) 
END )=W_EMPLOYEE_D.INTEGRATION_ID (+))
AND (WC_BKG_SC_SALES_SPL_TMP.SALESREP_ID=WC_SALESREP_TERRITORY_D.INTEGRATION_ID (+))
And (WC_BKG_SC_SALES_SPL_TMP.LINE_ID  not in
(select line_id from "PC_FIVETRAN_DB"."OBIEE_DW"."WC_INV_SC_SALES_SPL_TMP" ))
-- And (W_EMPLOYEE_D.CURRENT_FLG (+)='Y')
Group By WC_BKG_SC_SALES_SPL_TMP.LINE_ID,
 WC_BKG_SC_SALES_SPL_TMP.SALESREP_ID,
 WC_BKG_SC_SALES_SPL_TMP.PERCENT,
 TO_DATE(WC_BKG_SC_SALES_SPL_TMP.ORDERED_DATE),
 --WC_BKG_SC_SALES_SPL_TMP.DATASOURCE_NUM_ID,
 WC_BKG_SC_SALES_SPL_TMP.PERSON_ID

)   WC_BKG_SC_SALES_SPL_TMP_SQ
where	(1=1)





UNION

select 
	   

	   
	   WC_BKG_SC_SALES_SPL_TMP_SQ.LINE_ID LINE_ID,
	WC_BKG_SC_SALES_SPL_TMP_SQ.SALESREP_ID SALESREP_ID,
	WC_BKG_SC_SALES_SPL_TMP_SQ.SALES_REP_WID SALES_REP_WID,
	WC_BKG_SC_SALES_SPL_TMP_SQ.PERCENT PERCENT,
	WC_BKG_SC_SALES_SPL_TMP_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	WC_BKG_SC_SALES_SPL_TMP_SQ.CREDIT_TYPE_CODE CREDIT_TYPE_CODE
from	(

select 	
	TO_CHAR(WC_INV_OM_SALES_SPL_TMP.LINE_ID)    LINE_ID,	WC_INV_OM_SALES_SPL_TMP.SALESREP_ID    SALESREP_ID,
  SUM(WC_INV_OM_SALES_SPL_TMP.EXTENDED_AMOUNT*WC_INV_OM_SALES_SPL_TMP.REVENUE_PERCENT_SPLIT)/decode(WC_INV_OM_SALES_SPL_TMP.TOTAL_LINE_AMT,0,1,WC_INV_OM_SALES_SPL_TMP.TOTAL_LINE_AMT)    PERCENT,	
  MAX(WC_INV_OM_SALES_SPL_TMP.INVOICED_ON_DT)    ORDERED_DATE,	
  --WC_INV_OM_SALES_SPL_TMP.DATASOURCE_NUM_ID    DATASOURCE_NUM_ID,	
  WC_INV_OM_SALES_SPL_TMP.PERSON_ID    PERSON_ID,	MAX(W_EMPLOYEE_D.INTEGRATION_ID)    SALES_REP_WID,	MAX(WC_SALESREP_TERRITORY_D.INTEGRATION_ID)    SALES_REP_TERR_WID,
  WC_INV_OM_SALES_SPL_TMP.TOTAL_LINE_AMT    TOTAL_LINE_AMT,	null    CREDIT_TYPE_CODE
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_EMPLOYEE_D"   W_EMPLOYEE_D,
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALESREP_TERRITORIES_D"   WC_SALESREP_TERRITORY_D, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_INV_OM_SALES_SPL_TMP"   WC_INV_OM_SALES_SPL_TMP
where	(1=1)
 And ((CASE
WHEN WC_INV_OM_SALES_SPL_TMP.PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(WC_INV_OM_SALES_SPL_TMP.SALESREP_ID)
ELSE 'PER~'||TO_CHAR(WC_INV_OM_SALES_SPL_TMP.PERSON_ID) 
END )=W_EMPLOYEE_D.INTEGRATION_ID (+))
AND (WC_INV_OM_SALES_SPL_TMP.SALESREP_ID=WC_SALESREP_TERRITORY_D.INTEGRATION_ID (+))
--And (W_EMPLOYEE_D.CURRENT_FLG (+)='Y')
Group By TO_CHAR(WC_INV_OM_SALES_SPL_TMP.LINE_ID),
 WC_INV_OM_SALES_SPL_TMP.SALESREP_ID,
 --WC_INV_OM_SALES_SPL_TMP.DATASOURCE_NUM_ID,
 WC_INV_OM_SALES_SPL_TMP.PERSON_ID,
 WC_INV_OM_SALES_SPL_TMP.TOTAL_LINE_AMT

)   WC_BKG_SC_SALES_SPL_TMP_SQ
where	(1=1)





UNION

select 
	   

	   
	   WC_INV_OM_SALES_SPL_TMP_SQ.LINE_ID LINE_ID,
	WC_INV_OM_SALES_SPL_TMP_SQ.SALESREP_ID SALESREP_ID,
	WC_INV_OM_SALES_SPL_TMP_SQ.SALES_REP_WID SALES_REP_WID,
	WC_INV_OM_SALES_SPL_TMP_SQ.PERCENT PERCENT,
	WC_INV_OM_SALES_SPL_TMP_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	WC_INV_OM_SALES_SPL_TMP_SQ.CREDIT_TYPE_CODE CREDIT_TYPE_CODE
from	(

select 	
	TO_CHAR(WC_BKG_OM_SALES_SPL_TMP.LINE_ID)    LINE_ID,	WC_BKG_OM_SALES_SPL_TMP.SALESREP_ID    SALESREP_ID,
  WC_BKG_OM_SALES_SPL_TMP.CREDIT_PERCENTAGE    PERCENT,	TO_DATE(WC_BKG_OM_SALES_SPL_TMP.ORDERED_DATE)    ORDERED_DATE,	
 -- WC_BKG_OM_SALES_SPL_TMP.DATASOURCE_NUM_ID    DATASOURCE_NUM_ID,	
  WC_BKG_OM_SALES_SPL_TMP.PERSON_ID    PERSON_ID,	MAX(W_EMPLOYEE_D.INTEGRATION_ID)    SALES_REP_WID,	MAX(WC_SALESREP_TERRITORY_D.INTEGRATION_ID)    SALES_REP_TERR_WID,	null    CREDIT_TYPE_CODE
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_EMPLOYEE_D"   W_EMPLOYEE_D,
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALESREP_TERRITORIES_D"   WC_SALESREP_TERRITORY_D,
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_BKG_OM_SALES_SPL_TMP"   WC_BKG_OM_SALES_SPL_TMP
where	(1=1)
 And ((CASE
WHEN WC_BKG_OM_SALES_SPL_TMP.PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(WC_BKG_OM_SALES_SPL_TMP.SALESREP_ID)
ELSE 'PER~'||TO_CHAR(WC_BKG_OM_SALES_SPL_TMP.PERSON_ID) 
END )=W_EMPLOYEE_D.INTEGRATION_ID (+))
AND (WC_BKG_OM_SALES_SPL_TMP.SALESREP_ID=WC_SALESREP_TERRITORY_D.INTEGRATION_ID (+))
And (WC_BKG_OM_SALES_SPL_TMP.LINE_ID not in
(select line_id from "PC_FIVETRAN_DB"."OBIEE_DW"."WC_INV_OM_SALES_SPL_TMP"))
-- And (W_EMPLOYEE_D.CURRENT_FLG (+)='Y')
Group By TO_CHAR(WC_BKG_OM_SALES_SPL_TMP.LINE_ID),
 WC_BKG_OM_SALES_SPL_TMP.SALESREP_ID,
 WC_BKG_OM_SALES_SPL_TMP.CREDIT_PERCENTAGE,
 TO_DATE(WC_BKG_OM_SALES_SPL_TMP.ORDERED_DATE),
 --WC_BKG_OM_SALES_SPL_TMP.DATASOURCE_NUM_ID,
 WC_BKG_OM_SALES_SPL_TMP.PERSON_ID

)   WC_INV_OM_SALES_SPL_TMP_SQ
where	(1=1)





UNION

select 
	   

	   
	   WC_SALES_ORDER_SPLIT_FX_BKG_SQ.LINE_ID LINE_ID,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.SALESREP_ID SALESREP_ID,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.SALES_REP_WID SALES_REP_WID,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.PERCENT PERCENT,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.CREDIT_TYPE_CODE CREDIT_TYPE_CODE
from	(

select 	
	'999.'||TO_CHAR(WC_BKG_PA_SALES_SPL_TMP.PROJECT_ID)    LINE_ID,	WC_BKG_PA_SALES_SPL_TMP.SALESREP_ID    SALESREP_ID,	
  WC_BKG_PA_SALES_SPL_TMP.CREDIT_PERCENTAGE    PERCENT,	WC_BKG_PA_SALES_SPL_TMP.ORDERED_DATE    ORDERED_DATE,	
 -- WC_BKG_PA_SALES_SPL_TMP.DATASOURCE_NUM_ID    DATASOURCE_NUM_ID,	
  WC_BKG_PA_SALES_SPL_TMP.PERSON_ID    PERSON_ID,	WC_BKG_PA_SALES_SPL_TMP.CREDIT_TYPE_CODE    CREDIT_TYPE_CODE,	
  MAX(W_EMPLOYEE_D.INTEGRATION_ID)    SALES_REP_WID,	WC_SALESREP_TERRITORY_D.INTEGRATION_ID    SALES_REP_TERR_WID
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_EMPLOYEE_D"   W_EMPLOYEE_D,
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALESREP_TERRITORIES_D"   WC_SALESREP_TERRITORY_D, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_BKG_PA_SALES_SPL_TMP"   WC_BKG_PA_SALES_SPL_TMP
where	(1=1)
 And ((CASE
WHEN WC_BKG_PA_SALES_SPL_TMP.PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(WC_BKG_PA_SALES_SPL_TMP.SALESREP_ID)
ELSE 'PER~'||TO_CHAR(WC_BKG_PA_SALES_SPL_TMP.PERSON_ID) 
END )=W_EMPLOYEE_D.INTEGRATION_ID (+))
AND (WC_BKG_PA_SALES_SPL_TMP.SALESREP_ID=WC_SALESREP_TERRITORY_D.INTEGRATION_ID (+))
--And (W_EMPLOYEE_D.CURRENT_FLG (+)='Y')
Group By '999.'||TO_CHAR(WC_BKG_PA_SALES_SPL_TMP.PROJECT_ID),
 WC_BKG_PA_SALES_SPL_TMP.SALESREP_ID,
 WC_BKG_PA_SALES_SPL_TMP.CREDIT_PERCENTAGE,
 WC_BKG_PA_SALES_SPL_TMP.ORDERED_DATE,
 --WC_BKG_PA_SALES_SPL_TMP.DATASOURCE_NUM_ID,
 WC_BKG_PA_SALES_SPL_TMP.PERSON_ID,
 WC_BKG_PA_SALES_SPL_TMP.CREDIT_TYPE_CODE,
 WC_SALESREP_TERRITORY_D.INTEGRATION_ID

)   WC_SALES_ORDER_SPLIT_FX_BKG_SQ
where	(1=1)








)   WC_BKGS_SPLIT_OLD_SQ
where		(1=1)	

--And (WC_BKGS_SPLIT_OLD_SQ.LINE_ID NOT IN (SELECT X_SALES_SPLIT_LINE_WID FROM WC_SALES_ORDER_SLS_SPLIT_FX))




)    ODI_GET_FROM