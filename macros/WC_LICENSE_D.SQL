{% macro WC_LICENSE_D() %}
--To Do -- Clean up added records that are no longer needed

  {% set sql %}
  
  --Delete inserted records

delete from OBIEE_DW.WC_LICENSE_D where INTEGRATION_ID in(
select 	
	TARGET_TABLE.INTEGRATION_ID INTEGRATION_ID 
from	"PC_FIVETRAN_DB"."OBIEE_DW"."WC_LICENSE_D"  TARGET_TABLE, "PC_FIVETRAN_DB"."OBIEE_DW"."WC_LICENSE_DS"    PE_STAGE_TABLE
where TARGET_TABLE.INTEGRATION_ID=PE_STAGE_TABLE.INTEGRATION_ID);


  --Inserts records that don't have actuals for a given day, but have a daily budget
    insert into OBIEE_DW.WC_LICENSE_D
(
SYSTEM_ID	,
OPERATING_UNIT_ID	,
CUSTOMER_ID	,
NAME	,
DESCRIPTION	,
SYSTEM_TYPE_CODE	,
SYSTEM_NUMBER	,
INSTALL_SITE_USE_ID	,
START_DATE_ACTIVE	,
END_DATE_ACTIVE	,
ATTRIBUTE1	,
ATTRIBUTE2	,
ATTRIBUTE3	,
ATTRIBUTE4	,
ATTRIBUTE5	,
ATTRIBUTE6	,
ATTRIBUTE7	,
ATTRIBUTE8	,
ATTRIBUTE9	,
ATTRIBUTE10	,
ATTRIBUTE11	,
ATTRIBUTE12	,
ATTRIBUTE13	,
ATTRIBUTE14	,
ATTRIBUTE15	,
CREATED_BY_ID	,
CHANGED_BY_ID	,
CREATED_ON_DT	,
CHANGED_ON_DT	,
LAST_UPDATE_LOGIN	,
AUX1_CHANGED_ON_DT	,
INTEGRATION_ID	,
INSTALL_CUSTOMER_ID	,
INSTALL_CUSTOMER_NUMBER	,
INSTALL_CUSTOMER	,
INSTALL_PARTY_TYPE	,
INSTALL_FIRST_NAME	,
INSTALL_LAST_NAME	,
INSTALL_SITE_NUMBER	,
INSTALL_LOCATION_ID	,
INSTALL_DESCRIPTION	,
INSTALL_ADDRESS1	,
INSTALL_ADDRESS2	,
INSTALL_ADDRESS3	,
INSTALL_ADDRESS4	,
INSTALL_LOCATION	,
INSTALL_STATE	,
INSTALL_POSTAL_CODE	,
INSTALL_COUNTRY	,
SRC_EFF_FROM_DT	,
SRC_EFF_TO_DT	,
LAST_DATE	
)
select 
 SYSTEM_ID	,
OPERATING_UNIT_ID	,
CUSTOMER_ID	,
NAME	,
DESCRIPTION	,
SYSTEM_TYPE_CODE	,
SYSTEM_NUMBER	,
INSTALL_SITE_USE_ID	,
START_DATE_ACTIVE	,
END_DATE_ACTIVE	,
ATTRIBUTE1	,
ATTRIBUTE2	,
ATTRIBUTE3	,
ATTRIBUTE4	,
ATTRIBUTE5	,
ATTRIBUTE6	,
ATTRIBUTE7	,
ATTRIBUTE8	,
ATTRIBUTE9	,
ATTRIBUTE10	,
ATTRIBUTE11	,
ATTRIBUTE12	,
ATTRIBUTE13	,
ATTRIBUTE14	,
ATTRIBUTE15	,
CREATED_BY_ID	,
CHANGED_BY_ID	,
CREATED_ON_DT	,
CHANGED_ON_DT	,
LAST_UPDATE_LOGIN	,
AUX1_CHANGED_ON_DT	,
INTEGRATION_ID	,
INSTALL_CUSTOMER_ID	,
INSTALL_CUSTOMER_NUMBER	,
INSTALL_CUSTOMER	,
INSTALL_PARTY_TYPE	,
INSTALL_FIRST_NAME	,
INSTALL_LAST_NAME	,
INSTALL_SITE_NUMBER	,
INSTALL_LOCATION_ID	,
INSTALL_DESCRIPTION	,
INSTALL_ADDRESS1	,
INSTALL_ADDRESS2	,
INSTALL_ADDRESS3	,
INSTALL_ADDRESS4	,
INSTALL_LOCATION	,
INSTALL_STATE	,
INSTALL_POSTAL_CODE	,
INSTALL_COUNTRY	,
SRC_EFF_FROM_DT	,
SRC_EFF_TO_DT	,
LAST_DATE		
from  OBIEE_DW.WC_LICENSE_DS;

{% endset %}

{% do run_query(sql) %}

{% do log("WC_LICENSE_D", info=True) %}

{% endmacro %}