{{ config (
    materialized="table"
)}}


select	
	X_SALES_SPLIT_LINE_WID,
	SALESREP_ID,
	SALES_REP_WID,
	PERCENT,
	SALES_REP_TERR_WID,
	CREDIT_TYPE_CODE,
	ORIG_SALESFORCE_ACCOUNT_ID,
	SPLIT_SALESFORCE_ACCOUNT_ID
	
FROM (	


select 	
	
	WC_INV_OM_SALES_SPL_TMP_SQ.LINE_ID X_SALES_SPLIT_LINE_WID,
	WC_INV_OM_SALES_SPL_TMP_SQ.SALESREP_ID SALESREP_ID,
	WC_INV_OM_SALES_SPL_TMP_SQ.SALES_REP_WID SALES_REP_WID,
	WC_INV_OM_SALES_SPL_TMP_SQ.PERCENT PERCENT,
	WC_INV_OM_SALES_SPL_TMP_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	COALESCE(WC_INV_OM_SALES_SPL_TMP_SQ.CREDIT_TYPE_CODE,'Unspecified') CREDIT_TYPE_CODE,
	WC_INV_OM_SALES_SPL_TMP_SQ.ORIG_SF_ACCOUNT_ID ORIG_SALESFORCE_ACCOUNT_ID,
	WC_INV_OM_SALES_SPL_TMP_SQ.SPLIT_SF_ACCOUNT_ID SPLIT_SALESFORCE_ACCOUNT_ID 
from	(

select 	
	WC_INV_CST_OM_SALES_SPL_TMP.LINE_ID    LINE_ID,	WC_INV_CST_OM_SALES_SPL_TMP.SPLIT_SALESREP_ID    SALESREP_ID,	
  NVL(WC_INV_CST_OM_SALES_SPL_TMP.SPLIT_PERCENTAGE,100)    PERCENT,	WC_INV_CST_OM_SALES_SPL_TMP.INVOICED_ON_DATE    ORDERED_DATE,	
 -- WC_INV_CST_OM_SALES_SPL_TMP.DATASOURCE_NUM_ID    DATASOURCE_NUM_ID,	
  WC_INV_CST_OM_SALES_SPL_TMP.PERSON_ID    PERSON_ID,	W_EMPLOYEE_D.INTEGRATION_ID    SALES_REP_WID,	WC_SALESREP_TERRITORY_D.INTEGRATION_ID    SALES_REP_TERR_WID,	WC_INV_CST_OM_SALES_SPL_TMP.ORIG_SF_ACCOUNT_ID    ORIG_SF_ACCOUNT_ID,	WC_INV_CST_OM_SALES_SPL_TMP.SPLIT_SF_ACCOUNT_ID    SPLIT_SF_ACCOUNT_ID,	null    CREDIT_TYPE_CODE
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_EMPLOYEE_D"   W_EMPLOYEE_D, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALESREP_TERRITORIES_D"   WC_SALESREP_TERRITORY_D, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_INV_CST_OM_SALES_SPL_TMP"   WC_INV_CST_OM_SALES_SPL_TMP
where	(1=1)
 And ((CASE
WHEN WC_INV_CST_OM_SALES_SPL_TMP.PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(WC_INV_CST_OM_SALES_SPL_TMP.SPLIT_SALESREP_ID)
ELSE 'PER~'||TO_CHAR(WC_INV_CST_OM_SALES_SPL_TMP.PERSON_ID) 
END )=W_EMPLOYEE_D.INTEGRATION_ID)
AND (WC_SALESREP_TERRITORY_D.INTEGRATION_ID=WC_INV_CST_OM_SALES_SPL_TMP.SPLIT_SALESREP_ID)
--And (W_EMPLOYEE_D.CURRENT_FLG='Y')


)   WC_INV_OM_SALES_SPL_TMP_SQ
where		(1=1)	






UNION ALL
select 	
	
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.LINE_ID X_SALES_SPLIT_LINE_WID,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.SALESREP_ID SALESREP_ID,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.SALES_REP_WID SALES_REP_WID,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.PERCENT PERCENT,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.SALES_REP_TERR_WID SALES_REP_TERR_WID,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.CREDIT_TYPE_CODE CREDIT_TYPE_CODE,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.ORIG_SF_ACCOUNT_ID ORIG_SALESFORCE_ACCOUNT_ID,
	WC_SALES_ORDER_SPLIT_FX_BKG_SQ.SPLIT_SF_ACCOUNT_ID SPLIT_SALESFORCE_ACCOUNT_ID 
from	(

select 	DISTINCT
	WC_INV_CST_SC_SALES_SPL_TMP.CUSTOMER_TRX_LINE_ID    LINE_ID,	WC_INV_CST_SC_SALES_SPL_TMP.SPLIT_SALESREP_ID    SALESREP_ID,	
  WC_INV_CST_SC_SALES_SPL_TMP.SPLIT_PERCENTAGE    PERCENT,	MAX(WC_INV_CST_SC_SALES_SPL_TMP.ORDERED_DATE)    ORDERED_DATE,	
  --WC_INV_CST_SC_SALES_SPL_TMP.DATASOURCE_NUM_ID    DATASOURCE_NUM_ID,	
  WC_INV_CST_SC_SALES_SPL_TMP.PERSON_ID    PERSON_ID,	
  MAX(W_EMPLOYEE_D.INTEGRATION_ID)    SALES_REP_WID,	MAX(WC_SALESREP_TERRITORY_D.INTEGRATION_ID)    SALES_REP_TERR_WID,	null    CUST_TRX_LINE_SALESREP_ID,	WC_INV_CST_SC_SALES_SPL_TMP.SPLIT_SF_ACCOUNT_ID    SPLIT_SF_ACCOUNT_ID,	WC_INV_CST_SC_SALES_SPL_TMP.ORIG_SF_ACCOUNT_ID    ORIG_SF_ACCOUNT_ID,	null    CREDIT_TYPE_CODE
from	"PC_FIVETRAN_DB"."OBIEE_DW"."W_EMPLOYEE_D"   W_EMPLOYEE_D, 
 "PC_FIVETRAN_DB"."OBIEE_DW"."WC_SALESREP_TERRITORIES_D"   WC_SALESREP_TERRITORY_D, 
  "PC_FIVETRAN_DB"."OBIEE_DW"."WC_INV_CST_SC_SALES_SPL_TMP"   WC_INV_CST_SC_SALES_SPL_TMP
where	(1=1)
 And (WC_SALESREP_TERRITORY_D.INTEGRATION_ID=WC_INV_CST_SC_SALES_SPL_TMP.SPLIT_SALESREP_ID)
AND ((CASE
WHEN WC_INV_CST_SC_SALES_SPL_TMP.PERSON_ID IS NULL THEN 'SALES_REP~'||TO_CHAR(WC_INV_CST_SC_SALES_SPL_TMP.SPLIT_SALESREP_ID)
ELSE 'PER~'||TO_CHAR(WC_INV_CST_SC_SALES_SPL_TMP.PERSON_ID) 
END )=W_EMPLOYEE_D.INTEGRATION_ID)

Group By WC_INV_CST_SC_SALES_SPL_TMP.CUSTOMER_TRX_LINE_ID,
 WC_INV_CST_SC_SALES_SPL_TMP.SPLIT_SALESREP_ID,
 WC_INV_CST_SC_SALES_SPL_TMP.SPLIT_PERCENTAGE,
 --WC_INV_CST_SC_SALES_SPL_TMP.DATASOURCE_NUM_ID,
 WC_INV_CST_SC_SALES_SPL_TMP.PERSON_ID,
 WC_INV_CST_SC_SALES_SPL_TMP.SPLIT_SF_ACCOUNT_ID,
 WC_INV_CST_SC_SALES_SPL_TMP.ORIG_SF_ACCOUNT_ID

)   WC_SALES_ORDER_SPLIT_FX_BKG_SQ
where		(1=1)	






)    ODI_GET_FROM
