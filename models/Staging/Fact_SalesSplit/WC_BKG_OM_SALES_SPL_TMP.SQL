{{ config (
    materialized="table"
)}}

WITH WC_BKG_OM_SALES_SPL_TMP AS
(
    select	
	DISTINCT
	STAGING.LINE_ID LINE_ID,
	0 CUSTOMER_TRX_LINE_ID,
	STAGING.SALESREP_ID SALESREP_ID,
	STAGING.PERCENT CREDIT_PERCENTAGE,
	STAGING.ORDERED_DATE ORDERED_DATE,
	380 DATASOURCE_NUM_ID,
	SALESPERSON_LOOKUP.SOURCE_ID PERSON_ID 
from	
( /* Subselect from WR_SDE_ORA_SalesSplitTempTables.WC_BKG_OM_SALES_SPL_TMP_EXTRACT
*/


select 
	   

	   DISTINCT
	   OE_ORDER_LINES_ALL.LINE_ID LINE_ID,
	NVL(OE_SALES_CREDITS.SALESREP_ID,OE_ORDER_HEADERS_ALL.SALESREP_ID) SALESREP_ID,
	NVL(OE_SALES_CREDITS.PERCENT,100) PERCENT,
	OE_ORDER_HEADERS_ALL.ORDERED_DATE ORDERED_DATE
from	"PC_FIVETRAN_DB"."ERPPRD1_ONT"."OE_ORDER_HEADERS_ALL"
  OE_ORDER_HEADERS_ALL, "PC_FIVETRAN_DB"."ERPPRD1_ONT"."OE_ORDER_LINES_ALL"
   OE_ORDER_LINES_ALL, "PC_FIVETRAN_DB"."ERPPRD1_ONT"."OE_SALES_CREDITS"
   OE_SALES_CREDITS
where	(1=1)
 And (OE_ORDER_HEADERS_ALL.HEADER_ID=OE_ORDER_LINES_ALL.HEADER_ID)
AND (OE_SALES_CREDITS.LINE_ID=OE_ORDER_LINES_ALL.LINE_ID)

And (OE_ORDER_HEADERS_ALL.CREATION_DATE > TO_DATE(SUBSTR('2002-01-21 01:39:20',0,19),'YYYY-MM-DD HH24:MI:SS'))
)   STAGING, 
(

select 	
	RA_SALESREPS_ALL.SALESREP_ID    SALESREP_ID,	JTF_RS_RESOURCE_EXTNS.SOURCE_ID    SOURCE_ID
from	 "PC_FIVETRAN_DB"."ERPPRD1_JTF"."JTF_RS_SALESREPS"  RA_SALESREPS_ALL, 
   "PC_FIVETRAN_DB"."ERPPRD1_JTF"."JTF_RS_RESOURCE_EXTNS" JTF_RS_RESOURCE_EXTNS
where	(1=1)
 And (RA_SALESREPS_ALL.RESOURCE_ID=JTF_RS_RESOURCE_EXTNS.RESOURCE_ID)
And (JTF_RS_RESOURCE_EXTNS.CATEGORY IN ('EMPLOYEE', 'OTHER'))


)   SALESPERSON_LOOKUP
where	(1=1)

 And (STAGING.SALESREP_ID=SALESPERSON_LOOKUP.SALESREP_ID (+))
)
SELECT * FROM WC_BKG_OM_SALES_SPL_TMP