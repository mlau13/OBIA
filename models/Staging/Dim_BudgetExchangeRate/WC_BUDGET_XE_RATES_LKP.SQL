WITH BUDXE AS
(
    

select	
	
	SQ_WC_BUDGET_XE_RATES_LKP.PERIOD_NAME	   C1_PERIOD_NAME,
	SQ_WC_BUDGET_XE_RATES_LKP.PERIOD_START_DT	   C2_PERIOD_START_DT,
	SQ_WC_BUDGET_XE_RATES_LKP.PERIOD_END_DT	   C3_PERIOD_END_DT,
	SQ_WC_BUDGET_XE_RATES_LKP.PERIOD_START_DT_WID	   C4_PERIOD_START_DT_WID,
	SQ_WC_BUDGET_XE_RATES_LKP.PERIOD_END_DT_WID	   C5_PERIOD_END_DT_WID,
	SQ_WC_BUDGET_XE_RATES_LKP.TO_CURRENCY_CODE	   C6_FROM_CURRENCY_CODE,
	SQ_WC_BUDGET_XE_RATES_LKP.AVG_RATE	   C7_AVG_RATE,
	SQ_WC_BUDGET_XE_RATES_LKP.SHOW_AVG_RATE	   C8_SHOW_AVG_RATE,
	SQ_WC_BUDGET_XE_RATES_LKP.EOP_RATE	   C9_EOP_RATE,
	SQ_WC_BUDGET_XE_RATES_LKP.SHOW_EOP_RATE	   C10_SHOW_EOP_RATE,
	SQ_WC_BUDGET_XE_RATES_LKP.REV_RATE	   C11_REV_RATE,
	SQ_WC_BUDGET_XE_RATES_LKP.SHOW_REV_RATE	   C12_SHOW_REV_RATE,
	SQ_WC_BUDGET_XE_RATES_LKP.AVG_RATE_NUMERATOR	   C13_AVG_RATE_NUMERATOR,
	SQ_WC_BUDGET_XE_RATES_LKP.AVG_RATE_DENOMINATOR	   C14_AVG_RATE_DENOMINATOR,
	SQ_WC_BUDGET_XE_RATES_LKP.EOP_RATE_NUMERATOR	   C15_EOP_RATE_NUMERATOR,
	SQ_WC_BUDGET_XE_RATES_LKP.EOP_RATE_DENOMINATOR	   C16_EOP_RATE_DENOMINATOR,
	SQ_WC_BUDGET_XE_RATES_LKP.ACTUAL_FLAG	   C17_ACTUAL_FLAG,
	SQ_WC_BUDGET_XE_RATES_LKP.CREATED_BY	   C18_CREATED_BY,
	SQ_WC_BUDGET_XE_RATES_LKP.LAST_UPDATED_BY	   C19_CHANGED_BY,
	SQ_WC_BUDGET_XE_RATES_LKP.CREATED_BY	   C20_CREATED_ON_DT,
	SQ_WC_BUDGET_XE_RATES_LKP.LAST_UPDATE_DATE	   C21_CHANGED_ON_DT,
	SQ_WC_BUDGET_XE_RATES_LKP.PERIOD_NAME||'~'||SQ_WC_BUDGET_XE_RATES_LKP.TO_CURRENCY_CODE	   C22_INTEGRATION_ID
from	
( /* Subselect from SDE_ORA_BudgetExchangeRate.WC_BUDGET_XE_RATES_LKP_SQ_WC_BUDGET_XE_RATES_LKP
*/


select 
	   

	   
	   GL_TRANSLATION_RATES.PERIOD_NAME PERIOD_NAME,
	GL_PERIOD_STATUSES.START_DATE PERIOD_START_DT,
	GL_PERIOD_STATUSES.END_DATE PERIOD_END_DT,
	cast(TO_CHAR(GL_PERIOD_STATUSES.START_DATE,'YYYYMMDD') as number(10,0)) PERIOD_START_DT_WID,
	cast(TO_CHAR(GL_PERIOD_STATUSES.END_DATE,'YYYYMMDD') as number(10,0)) PERIOD_END_DT_WID,
	GL_TRANSLATION_RATES.AVG_RATE AVG_RATE,
	ROUND(GL_TRANSLATION_RATES.AVG_RATE, 10) SHOW_AVG_RATE,
	GL_TRANSLATION_RATES.TO_CURRENCY_CODE TO_CURRENCY_CODE,
	GL_TRANSLATION_RATES.EOP_RATE EOP_RATE,
	ROUND(GL_TRANSLATION_RATES.EOP_RATE, 10) SHOW_EOP_RATE,
	(1/GL_TRANSLATION_RATES.EOP_RATE) REV_RATE,
	ROUND((1/GL_TRANSLATION_RATES.EOP_RATE),10) SHOW_REV_RATE,
	GL_TRANSLATION_RATES.AVG_RATE_NUMERATOR AVG_RATE_NUMERATOR,
	GL_TRANSLATION_RATES.AVG_RATE_DENOMINATOR AVG_RATE_DENOMINATOR,
	GL_TRANSLATION_RATES.EOP_RATE_NUMERATOR EOP_RATE_NUMERATOR,
	GL_TRANSLATION_RATES.EOP_RATE_DENOMINATOR EOP_RATE_DENOMINATOR,
	GL_TRANSLATION_RATES.ACTUAL_FLAG ACTUAL_FLAG,
	GL_TRANSLATION_RATES.CREATED_BY CREATED_BY,
	GL_TRANSLATION_RATES.LAST_UPDATED_BY LAST_UPDATED_BY,
	GL_TRANSLATION_RATES.CREATION_DATE CREATION_DATE,
	GL_TRANSLATION_RATES.LAST_UPDATE_DATE LAST_UPDATE_DATE
from	(SELECT lgr.ledger_id SET_OF_BOOKS_ID, ps.period_name PERIOD_NAME, pert.to_currency TO_CURRENCY_CODE, decode(mult.multiplier, 1, 'A', 2, 'B') ACTUAL_FLAG, 
part.conversion_rate AVG_RATE, pert.conversion_rate EOP_RATE, part.conversion_rate AVG_RATE_NUMERATOR, pert.conversion_rate EOP_RATE_NUMERATOR, 
1 AVG_RATE_DENOMINATOR, 1 EOP_RATE_DENOMINATOR, decode(NULL, 'X',suspense_allowed_flag, 'N') UPDATE_FLAG, NULL LAST_UPDATE_DATE, NULL LAST_UPDATED_BY, 
NULL CREATION_DATE, NULL CREATED_BY, NULL LAST_UPDATE_LOGIN, NULL ATTRIBUTE1, NULL ATTRIBUTE2, NULL ATTRIBUTE3, NULL ATTRIBUTE4, NULL ATTRIBUTE5, NULL CONTEXT 
 FROM "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_LEDGERS" lgr, "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIOD_STATUSES" ps, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_ROW_MULTIPLIERS" mult,"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES"  pert, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES" part 
 WHERE ps.application_id = 101 AND ps.ledger_id = lgr.ledger_id AND mult.multiplier in (1,2) AND 
 pert.from_currency = lgr.currency_code AND pert.conversion_date = ps.end_date 
 AND pert.conversion_type = decode(mult.multiplier, 1, lgr.period_end_rate_type, lgr.budget_period_end_rate_type) 
 AND part.from_currency = pert.from_currency AND part.to_currency = pert.to_currency AND pert.conversion_date = part.conversion_date 
 AND part.conversion_type = decode(mult.multiplier, 1, lgr.period_average_rate_type, lgr.budget_period_avg_rate_type))  GL_TRANSLATION_RATES, PC_FIVETRAN_DB."ERPPRD_GL"."GL_PERIOD_STATUSES"   GL_PERIOD_STATUSES
where	(1=1)
 And (GL_TRANSLATION_RATES.SET_OF_BOOKS_ID=GL_PERIOD_STATUSES.SET_OF_BOOKS_ID  AND GL_TRANSLATION_RATES.PERIOD_NAME=GL_PERIOD_STATUSES.PERIOD_NAME)

And (GL_PERIOD_STATUSES.APPLICATION_ID = '101' AND 
GL_PERIOD_STATUSES.SET_OF_BOOKS_ID = '28')







)   SQ_WC_BUDGET_XE_RATES_LKP
where	(1=1)

),

BUDXETOTAL AS 
(

    select	
	PERIOD_NAME,
	PERIOD_START_DT,
	PERIOD_END_DT,
	PERIOD_START_DT_WID,
	PERIOD_END_DT_WID,
	FROM_CURRENCY_CODE,
	AVG_RATE,
	SHOW_AVG_RATE,
	EOP_RATE,
	SHOW_EOP_RATE,
	REV_RATE,
	SHOW_REV_RATE,
	AVG_RATE_NUMERATOR,
	AVG_RATE_DENOMINATOR,
	EOP_RATE_NUMERATOR,
	EOP_RATE_DENOMINATOR,
	ACTUAL_FLAG,
	CREATED_BY,
	CHANGED_BY,
	CREATED_ON_DT,
	CHANGED_ON_DT,
	INTEGRATION_ID,
	380 DATASOURCE_NUM_ID
FROM (	


select 	
	
	C1_PERIOD_NAME PERIOD_NAME,
	C2_PERIOD_START_DT PERIOD_START_DT,
	C3_PERIOD_END_DT PERIOD_END_DT,
	C4_PERIOD_START_DT_WID PERIOD_START_DT_WID,
	C5_PERIOD_END_DT_WID PERIOD_END_DT_WID,
	C6_FROM_CURRENCY_CODE FROM_CURRENCY_CODE,
	C7_AVG_RATE AVG_RATE,
	C8_SHOW_AVG_RATE SHOW_AVG_RATE,
	C9_EOP_RATE EOP_RATE,
	C10_SHOW_EOP_RATE SHOW_EOP_RATE,
	C11_REV_RATE REV_RATE,
	C12_SHOW_REV_RATE SHOW_REV_RATE,
	C13_AVG_RATE_NUMERATOR AVG_RATE_NUMERATOR,
	C14_AVG_RATE_DENOMINATOR AVG_RATE_DENOMINATOR,
	C15_EOP_RATE_NUMERATOR EOP_RATE_NUMERATOR,
	C16_EOP_RATE_DENOMINATOR EOP_RATE_DENOMINATOR,
	C17_ACTUAL_FLAG ACTUAL_FLAG,
	C18_CREATED_BY CREATED_BY,
	C19_CHANGED_BY CHANGED_BY,
	C20_CREATED_ON_DT CREATED_ON_DT,
	C21_CHANGED_ON_DT CHANGED_ON_DT,
	C22_INTEGRATION_ID INTEGRATION_ID 
from	BUDXE
where		(1=1)	






)    ODI_GET_FROM


)

SELECT * FROM BUDXETOTAL