{{ config (
    materialized="table"
)}}

WITH AVGXE AS
(
   

select	
	
	SQ_WC_AVG_XE_RATES_LKP.PERIOD_NAME	   C1_PERIOD_NAME,
	SQ_WC_AVG_XE_RATES_LKP.PERIOD_START_DT	   C2_PERIOD_START_DT,
	SQ_WC_AVG_XE_RATES_LKP.PERIOD_END_DT	   C3_PERIOD_END_DT,
	(CASE
WHEN SQ_WC_AVG_XE_RATES_LKP.PERIOD_START_DT IS NULL THEN NULL
ELSE 
TO_NUMBER(TO_CHAR(SQ_WC_AVG_XE_RATES_LKP.PERIOD_START_DT,'YYYYMMDD'))
END )	   C4_PERIOD_START_DT_WID,
	
(CASE
WHEN SQ_WC_AVG_XE_RATES_LKP.PERIOD_END_DT IS NULL THEN NULL
ELSE 
TO_NUMBER(TO_CHAR(SQ_WC_AVG_XE_RATES_LKP.PERIOD_END_DT,'YYYYMMDD'))
END )
	   C5_PERIOD_END_DT_WID,
	SQ_WC_AVG_XE_RATES_LKP.FROM_CURRENCY_CODE	   C6_FROM_CURRENCY_CODE,
	SQ_WC_AVG_XE_RATES_LKP.AVG_RATE	   C7_AVG_RATE,
	SQ_WC_AVG_XE_RATES_LKP.SHOW_AVG_RATE	   C8_SHOW_AVG_RATE,
	SQ_WC_AVG_XE_RATES_LKP.EOP_RATE	   C9_EOP_RATE,
	SQ_WC_AVG_XE_RATES_LKP.SHOW_EOP_RATE	   C10_SHOW_EOP_RATE,
	SQ_WC_AVG_XE_RATES_LKP.REV_RATE	   C11_REV_RATE,
	SQ_WC_AVG_XE_RATES_LKP.SHOW_REV_RATE	   C12_SHOW_REV_RATE,
	SQ_WC_AVG_XE_RATES_LKP.AVG_RATE_NUMERATOR	   C13_AVG_RATE_NUMERATOR,
	SQ_WC_AVG_XE_RATES_LKP.AVG_RATE_DENOMINATOR	   C14_AVG_RATE_DENOMINATOR,
	SQ_WC_AVG_XE_RATES_LKP.EOP_RATE_NUMERATOR	   C15_EOP_RATE_NUMERATOR,
	SQ_WC_AVG_XE_RATES_LKP.EOP_RATE_DENOMINATOR	   C16_EOP_RATE_DENOMINATOR,
	SQ_WC_AVG_XE_RATES_LKP.ACTUAL_FLAG	   C17_ACTUAL_FLAG,
	SQ_WC_AVG_XE_RATES_LKP.CREATED_BY	   C18_CREATED_BY,
	SQ_WC_AVG_XE_RATES_LKP.CHANGED_BY	   C19_CHANGED_BY,
	SQ_WC_AVG_XE_RATES_LKP.CREATION_DATE	   C20_CREATED_ON_DT,
	SQ_WC_AVG_XE_RATES_LKP.CHANGED_ON_DT	   C21_CHANGED_ON_DT,
	TO_CHAR(SQ_WC_AVG_XE_RATES_LKP.PERIOD_NAME||'~'||SQ_WC_AVG_XE_RATES_LKP.FROM_CURRENCY_CODE)	   C22_INTEGRATION_ID,
	TO_NUMBER('1009'||TO_CHAR(SQ_WC_AVG_XE_RATES_LKP.PERIOD_START_DT,'YYYYMMDD')||'000')
	   C23_PERIOD_START_CAL_DT_WID,
	TO_NUMBER('1009'||TO_CHAR(SQ_WC_AVG_XE_RATES_LKP.PERIOD_END_DT,'YYYYMMDD')||'000')	   C24_PERIOD_END_CAL_DT_WID,
	SQ_WC_AVG_XE_RATES_LKP.PREVIOUS_EOP_RATE	   C25_X_PREV_EOP_RATE,
	SQ_WC_AVG_XE_RATES_LKP.PREVIOUS_AVG_RATE	   C26_X_PREV_AVG_RATE,
	SQ_WC_AVG_XE_RATES_LKP.PREVIOUS_PERIOD	   C27_X_PREV_PERIOD,
	SQ_WC_AVG_XE_RATES_LKP.PRIOR_PERIOD	   C28_X_PRIOR_PERIOD,
	 SQ_WC_AVG_XE_RATES_LKP.PRIOR_EOP_RATE	   C29_X_PRIOR_EOP_RATE,
	SQ_WC_AVG_XE_RATES_LKP.PRIOR_AVG_RATE	   C30_X_PRIOR_AVG_RATE
from	
( /* Subselect from SDE_ORA_BudgetExchange_WC_AVG_XE_RATES_LKP_SQ_WC_AVG_XE_RATES_LKP
*/
SELECT 
GL_TRANSLATION_RATES.ACTUAL_FLAG,
GL_TRANSLATION_RATES.AVG_RATE,
GL_TRANSLATION_RATES.AVG_RATE_DENOMINATOR,
GL_TRANSLATION_RATES.AVG_RATE_NUMERATOR,
GL_TRANSLATION_RATES.LAST_UPDATED_BY CHANGED_BY,
TO_DATE(MAX (GL_TRANSLATION_RATES.LAST_UPDATE_DATE), 'MM/DD/YYYY HH24:mi:ss') CHANGED_ON_DT,
GL_TRANSLATION_RATES.CREATED_BY,
TO_DATE(MAX (GL_TRANSLATION_RATES.CREATION_DATE), 'MM/DD/YYYY HH24:mi:ss') CREATION_DATE,
GL_TRANSLATION_RATES.EOP_RATE,
GL_TRANSLATION_RATES.EOP_RATE_DENOMINATOR,
GL_TRANSLATION_RATES.EOP_RATE_NUMERATOR,
GL_SETS_OF_BOOKS.CURRENCY_CODE FROM_CURRENCY_CODE,
DECODE (GL_PERIODS.END_DATE, MAX (GL_PERIODS.END_DATE) OVER (PARTITION BY CURRENCY_CODE), MAX (GL_PERIODS.END_DATE) OVER (PARTITION BY CURRENCY_CODE) + 10000, 
GL_PERIODS.END_DATE ) AS PERIOD_END_DT,
GL_TRANSLATION_RATES.PERIOD_NAME PERIOD_NAME,
GL_PERIODS.START_DATE AS PERIOD_START_DT,
  (1/GL_TRANSLATION_RATES.EOP_RATE) REV_RATE,
 ROUND(GL_TRANSLATION_RATES.AVG_RATE, 10) SHOW_AVG_RATE,
 ROUND(GL_TRANSLATION_RATES.EOP_RATE, 10) SHOW_EOP_RATE,
 ROUND((1/GL_TRANSLATION_RATES.EOP_RATE),10) SHOW_REV_RATE,
NVL(PREV.AVG_RATE, 1) AS PREVIOUS_AVG_RATE,
  NVL(PREV.EOP_RATE, 1) AS PREVIOUS_EOP_RATE,
  PREV.PERIOD_NAME AS PREVIOUS_PERIOD,
  NVL(PRIOR_PER.AVG_RATE, 1) AS PRIOR_AVG_RATE,
  NVL(PRIOR_PER.EOP_RATE, 1) AS PRIOR_EOP_RATE,
  PRIOR_PER.PERIOD_NAME AS PRIOR_PERIOD
  FROM (SELECT lgr.ledger_id SET_OF_BOOKS_ID, ps.period_name PERIOD_NAME, pert.to_currency TO_CURRENCY_CODE, decode(mult.multiplier, 1, 'A', 2, 'B') ACTUAL_FLAG, 
part.conversion_rate AVG_RATE, pert.conversion_rate EOP_RATE, part.conversion_rate AVG_RATE_NUMERATOR, pert.conversion_rate EOP_RATE_NUMERATOR, 
1 AVG_RATE_DENOMINATOR, 1 EOP_RATE_DENOMINATOR, decode(NULL, 'X',suspense_allowed_flag, 'N') UPDATE_FLAG, NULL LAST_UPDATE_DATE, NULL LAST_UPDATED_BY, 
NULL CREATION_DATE, NULL CREATED_BY, NULL LAST_UPDATE_LOGIN, NULL ATTRIBUTE1, NULL ATTRIBUTE2, NULL ATTRIBUTE3, NULL ATTRIBUTE4, NULL ATTRIBUTE5, NULL CONTEXT 
 FROM "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_LEDGERS" lgr, "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIOD_STATUSES" ps, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_ROW_MULTIPLIERS" mult,"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES"  pert, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES" part 
 WHERE ps.application_id = 101 AND ps.ledger_id = lgr.ledger_id AND mult.multiplier in (1,2) AND 
 pert.from_currency = lgr.currency_code AND pert.conversion_date = ps.end_date 
 AND pert.conversion_type = decode(mult.multiplier, 1, lgr.period_end_rate_type, lgr.budget_period_end_rate_type) 
 AND part.from_currency = pert.from_currency AND part.to_currency = pert.to_currency AND pert.conversion_date = part.conversion_date 
 AND part.conversion_type = decode(mult.multiplier, 1, lgr.period_average_rate_type, lgr.budget_period_avg_rate_type)) GL_TRANSLATION_RATES,/* GL_TRANSLATION_RATES_V repalced GL_TRANSLATION_RATES for R12 Upgrade, reference Oracle Document ID:(Doc ID 268150.1, Doc ID 741605.1), changed by Yadul Mohammed on 20-Dec-2017*/
  ("PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIODS"
) GL_PERIODS,
 (SELECT lgr.LEDGER_ID SET_OF_BOOKS_ID, lgr.NAME NAME, lgr.SHORT_NAME SHORT_NAME, lgr.CHART_OF_ACCOUNTS_ID CHART_OF_ACCOUNTS_ID, lgr.CURRENCY_CODE CURRENCY_CODE, lgr.PERIOD_SET_NAME PERIOD_SET_NAME, lgr.ACCOUNTED_PERIOD_TYPE ACCOUNTED_PERIOD_TYPE, lgr.SUSPENSE_ALLOWED_FLAG SUSPENSE_ALLOWED_FLAG, lgr.ALLOW_INTERCOMPANY_POST_FLAG ALLOW_INTERCOMPANY_POST_FLAG, lgr.TRACK_ROUNDING_IMBALANCE_FLAG TRACK_ROUNDING_IMBALANCE_FLAG, lgr.ENABLE_AVERAGE_BALANCES_FLAG ENABLE_AVERAGE_BALANCES_FLAG, lgr.ENABLE_BUDGETARY_CONTROL_FLAG ENABLE_BUDGETARY_CONTROL_FLAG, lgr.REQUIRE_BUDGET_JOURNALS_FLAG REQUIRE_BUDGET_JOURNALS_FLAG, lgr.ENABLE_JE_APPROVAL_FLAG ENABLE_JE_APPROVAL_FLAG, lgr.ENABLE_AUTOMATIC_TAX_FLAG ENABLE_AUTOMATIC_TAX_FLAG, lgr.CONSOLIDATION_LEDGER_FLAG CONSOLIDATION_SOB_FLAG, lgr.TRANSLATE_EOD_FLAG TRANSLATE_EOD_FLAG, lgr.TRANSLATE_QATD_FLAG TRANSLATE_QATD_FLAG, lgr.TRANSLATE_YATD_FLAG TRANSLATE_YATD_FLAG, decode(lgr.alc_ledger_type_code, 'TARGET', 'R', 'SOURCE', 'P', 'N') MRC_SOB_TYPE_CODE, 'N' ALLOW_POSTING_WARNING_FLAG, lgr.LAST_UPDATE_DATE LAST_UPDATE_DATE, lgr.LAST_UPDATED_BY LAST_UPDATED_BY, lgr.CREATION_DATE CREATION_DATE, lgr.CREATED_BY CREATED_BY, lgr.LAST_UPDATE_LOGIN LAST_UPDATE_LOGIN, lgr.FUTURE_ENTERABLE_PERIODS_LIMIT FUTURE_ENTERABLE_PERIODS_LIMIT, lgr.LATEST_OPENED_PERIOD_NAME LATEST_OPENED_PERIOD_NAME, lgr.LATEST_ENCUMBRANCE_YEAR LATEST_ENCUMBRANCE_YEAR, lgr.RET_EARN_CODE_COMBINATION_ID RET_EARN_CODE_COMBINATION_ID, lgr.CUM_TRANS_CODE_COMBINATION_ID CUM_TRANS_CODE_COMBINATION_ID, lgr.RES_ENCUMB_CODE_COMBINATION_ID RES_ENCUMB_CODE_COMBINATION_ID, lgr.NET_INCOME_CODE_COMBINATION_ID NET_INCOME_CODE_COMBINATION_ID, lgr.ROUNDING_CODE_COMBINATION_ID ROUNDING_CODE_COMBINATION_ID, lgr.TRANSACTION_CALENDAR_ID TRANSACTION_CALENDAR_ID, lgr.DAILY_TRANSLATION_RATE_TYPE DAILY_TRANSLATION_RATE_TYPE, NULL EARLIEST_UNTRANS_PERIOD_NAME, lgr.DESCRIPTION DESCRIPTION, lgr.ATTRIBUTE1 ATTRIBUTE1, lgr.ATTRIBUTE2 ATTRIBUTE2, lgr.ATTRIBUTE3 ATTRIBUTE3, lgr.ATTRIBUTE4 ATTRIBUTE4, lgr.ATTRIBUTE5 ATTRIBUTE5, lgr.ATTRIBUTE6 ATTRIBUTE6, lgr.ATTRIBUTE7 ATTRIBUTE7, lgr.ATTRIBUTE8 ATTRIBUTE8, lgr.ATTRIBUTE9 ATTRIBUTE9, lgr.ATTRIBUTE10 ATTRIBUTE10, lgr.ATTRIBUTE11 ATTRIBUTE11, lgr.ATTRIBUTE12 ATTRIBUTE12, lgr.ATTRIBUTE13 ATTRIBUTE13, lgr.ATTRIBUTE14 ATTRIBUTE14, lgr.ATTRIBUTE15 ATTRIBUTE15, lgr.CONTEXT CONTEXT, NULL GLOBAL_ATTRIBUTE_CATEGORY, NULL GLOBAL_ATTRIBUTE1, NULL GLOBAL_ATTRIBUTE2, NULL GLOBAL_ATTRIBUTE3, NULL GLOBAL_ATTRIBUTE4, NULL GLOBAL_ATTRIBUTE5, NULL GLOBAL_ATTRIBUTE6, NULL GLOBAL_ATTRIBUTE7, NULL GLOBAL_ATTRIBUTE8, NULL GLOBAL_ATTRIBUTE9, NULL GLOBAL_ATTRIBUTE10, lgr.SLA_LEDGER_CASH_BASIS_FLAG SLA_LEDGER_CASH_BASIS_FLAG 
FROM "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_LEDGERS" lgr WHERE object_type_code = 'L' AND nvl(complete_flag, 'Y') = 'Y') GL_SETS_OF_BOOKS,
  (SELECT A.AVG_RATE, A.EOP_RATE, A.TO_CURRENCY_CODE, A.SET_OF_BOOKS_ID, A.PERIOD_NAME, B.PERIOD_NAME CURRENT_PERIOD
FROM (SELECT lgr.ledger_id SET_OF_BOOKS_ID, ps.period_name PERIOD_NAME, pert.to_currency TO_CURRENCY_CODE, decode(mult.multiplier, 1, 'A', 2, 'B') ACTUAL_FLAG, 
part.conversion_rate AVG_RATE, pert.conversion_rate EOP_RATE, part.conversion_rate AVG_RATE_NUMERATOR, pert.conversion_rate EOP_RATE_NUMERATOR, 
1 AVG_RATE_DENOMINATOR, 1 EOP_RATE_DENOMINATOR, decode(NULL, 'X',suspense_allowed_flag, 'N') UPDATE_FLAG, NULL LAST_UPDATE_DATE, NULL LAST_UPDATED_BY, 
NULL CREATION_DATE, NULL CREATED_BY, NULL LAST_UPDATE_LOGIN, NULL ATTRIBUTE1, NULL ATTRIBUTE2, NULL ATTRIBUTE3, NULL ATTRIBUTE4, NULL ATTRIBUTE5, NULL CONTEXT 
 FROM "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_LEDGERS" lgr, "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIOD_STATUSES" ps, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_ROW_MULTIPLIERS" mult,"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES"  pert, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES" part 
 WHERE ps.application_id = 101 AND ps.ledger_id = lgr.ledger_id AND mult.multiplier in (1,2) AND 
 pert.from_currency = lgr.currency_code AND pert.conversion_date = ps.end_date 
 AND pert.conversion_type = decode(mult.multiplier, 1, lgr.period_end_rate_type, lgr.budget_period_end_rate_type) 
 AND part.from_currency = pert.from_currency AND part.to_currency = pert.to_currency AND pert.conversion_date = part.conversion_date 
 AND part.conversion_type = decode(mult.multiplier, 1, lgr.period_average_rate_type, lgr.budget_period_avg_rate_type)) A, /* GL_TRANSLATION_RATES_V repalced GL_TRANSLATION_RATES for R12 Upgrade, reference Oracle Document ID:(Doc ID 268150.1, Doc ID 741605.1), changed by Yadul Mohammed on 20-Dec-2017*/
(SELECT lgr.ledger_id SET_OF_BOOKS_ID, ps.period_name PERIOD_NAME, pert.to_currency TO_CURRENCY_CODE, decode(mult.multiplier, 1, 'A', 2, 'B') ACTUAL_FLAG, 
part.conversion_rate AVG_RATE, pert.conversion_rate EOP_RATE, part.conversion_rate AVG_RATE_NUMERATOR, pert.conversion_rate EOP_RATE_NUMERATOR, 
1 AVG_RATE_DENOMINATOR, 1 EOP_RATE_DENOMINATOR, decode(NULL, 'X',suspense_allowed_flag, 'N') UPDATE_FLAG, NULL LAST_UPDATE_DATE, NULL LAST_UPDATED_BY, 
NULL CREATION_DATE, NULL CREATED_BY, NULL LAST_UPDATE_LOGIN, NULL ATTRIBUTE1, NULL ATTRIBUTE2, NULL ATTRIBUTE3, NULL ATTRIBUTE4, NULL ATTRIBUTE5, NULL CONTEXT 
 FROM "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_LEDGERS" lgr, "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIOD_STATUSES" ps, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_ROW_MULTIPLIERS" mult,"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES"  pert, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES" part 
 WHERE ps.application_id = 101 AND ps.ledger_id = lgr.ledger_id AND mult.multiplier in (1,2) AND 
 pert.from_currency = lgr.currency_code AND pert.conversion_date = ps.end_date 
 AND pert.conversion_type = decode(mult.multiplier, 1, lgr.period_end_rate_type, lgr.budget_period_end_rate_type) 
 AND part.from_currency = pert.from_currency AND part.to_currency = pert.to_currency AND pert.conversion_date = part.conversion_date 
 AND part.conversion_type = decode(mult.multiplier, 1, lgr.period_average_rate_type, lgr.budget_period_avg_rate_type)) B /* GL_TRANSLATION_RATES_V repalced GL_TRANSLATION_RATES for R12 Upgrade, reference Oracle Document ID:(Doc ID 268150.1, Doc ID 741605.1), changed by Yadul Mohammed on 20-Dec-2017*/
WHERE A.PERIOD_NAME = TO_CHAR(ADD_MONTHS(to_Date('25' || SUBSTR(B.PERIOD_NAME, 1, 3) || SUBSTR(B.PERIOD_NAME, 5, 4), 'DDMONYYYY'), -1), 'MON' || SUBSTR(B.PERIOD_NAME, 4, 1)  || 'YYYY' )
and A.to_currency_code = B.to_currency_code
     and A.set_of_books_id = B.set_of_books_id
     --AND B.PERIOD_NAME      = 'JUN 2010'
     ) PREV,
(SELECT A.AVG_RATE, A.EOP_RATE, A.TO_CURRENCY_CODE, A.SET_OF_BOOKS_ID, A.PERIOD_NAME, B.PERIOD_NAME CURRENT_PERIOD
FROM (SELECT lgr.ledger_id SET_OF_BOOKS_ID, ps.period_name PERIOD_NAME, pert.to_currency TO_CURRENCY_CODE, decode(mult.multiplier, 1, 'A', 2, 'B') ACTUAL_FLAG, 
part.conversion_rate AVG_RATE, pert.conversion_rate EOP_RATE, part.conversion_rate AVG_RATE_NUMERATOR, pert.conversion_rate EOP_RATE_NUMERATOR, 
1 AVG_RATE_DENOMINATOR, 1 EOP_RATE_DENOMINATOR, decode(NULL, 'X',suspense_allowed_flag, 'N') UPDATE_FLAG, NULL LAST_UPDATE_DATE, NULL LAST_UPDATED_BY, 
NULL CREATION_DATE, NULL CREATED_BY, NULL LAST_UPDATE_LOGIN, NULL ATTRIBUTE1, NULL ATTRIBUTE2, NULL ATTRIBUTE3, NULL ATTRIBUTE4, NULL ATTRIBUTE5, NULL CONTEXT 
 FROM "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_LEDGERS" lgr, "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIOD_STATUSES" ps, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_ROW_MULTIPLIERS" mult,"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES"  pert, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES" part 
 WHERE ps.application_id = 101 AND ps.ledger_id = lgr.ledger_id AND mult.multiplier in (1,2) AND 
 pert.from_currency = lgr.currency_code AND pert.conversion_date = ps.end_date 
 AND pert.conversion_type = decode(mult.multiplier, 1, lgr.period_end_rate_type, lgr.budget_period_end_rate_type) 
 AND part.from_currency = pert.from_currency AND part.to_currency = pert.to_currency AND pert.conversion_date = part.conversion_date 
 AND part.conversion_type = decode(mult.multiplier, 1, lgr.period_average_rate_type, lgr.budget_period_avg_rate_type)) A, /* GL_TRANSLATION_RATES_V repalced GL_TRANSLATION_RATES for R12 Upgrade, reference Oracle Document ID:(Doc ID 268150.1, Doc ID 741605.1), changed by Yadul Mohammed on 20-Dec-2017*/
(SELECT lgr.ledger_id SET_OF_BOOKS_ID, ps.period_name PERIOD_NAME, pert.to_currency TO_CURRENCY_CODE, decode(mult.multiplier, 1, 'A', 2, 'B') ACTUAL_FLAG, 
part.conversion_rate AVG_RATE, pert.conversion_rate EOP_RATE, part.conversion_rate AVG_RATE_NUMERATOR, pert.conversion_rate EOP_RATE_NUMERATOR, 
1 AVG_RATE_DENOMINATOR, 1 EOP_RATE_DENOMINATOR, decode(NULL, 'X',suspense_allowed_flag, 'N') UPDATE_FLAG, NULL LAST_UPDATE_DATE, NULL LAST_UPDATED_BY, 
NULL CREATION_DATE, NULL CREATED_BY, NULL LAST_UPDATE_LOGIN, NULL ATTRIBUTE1, NULL ATTRIBUTE2, NULL ATTRIBUTE3, NULL ATTRIBUTE4, NULL ATTRIBUTE5, NULL CONTEXT 
 FROM "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_LEDGERS" lgr, "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIOD_STATUSES" ps, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_ROW_MULTIPLIERS" mult,"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES"  pert, 
"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_DAILY_RATES" part 
 WHERE ps.application_id = 101 AND ps.ledger_id = lgr.ledger_id AND mult.multiplier in (1,2) AND 
 pert.from_currency = lgr.currency_code AND pert.conversion_date = ps.end_date 
 AND pert.conversion_type = decode(mult.multiplier, 1, lgr.period_end_rate_type, lgr.budget_period_end_rate_type) 
 AND part.from_currency = pert.from_currency AND part.to_currency = pert.to_currency AND pert.conversion_date = part.conversion_date 
 AND part.conversion_type = decode(mult.multiplier, 1, lgr.period_average_rate_type, lgr.budget_period_avg_rate_type)) B /* GL_TRANSLATION_RATES_V repalced GL_TRANSLATION_RATES for R12 Upgrade, reference Oracle Document ID:(Doc ID 268150.1, Doc ID 741605.1), changed by Yadul Mohammed on 20-Dec-2017*/
WHERE A.PERIOD_NAME = TO_CHAR(ADD_MONTHS(to_Date('25' || SUBSTR(B.PERIOD_NAME, 1, 3) || SUBSTR(B.PERIOD_NAME, 5, 4), 'DDMONYYYY'), -2), 'MON' || SUBSTR(B.PERIOD_NAME, 4, 1)  || 'YYYY' )
and A.to_currency_code = B.to_currency_code
     and A.set_of_books_id = B.set_of_books_id
     --AND B.PERIOD_NAME      = 'JUN 2010'
) PRIOR_PER     
WHERE GL_TRANSLATION_RATES.ACTUAL_FLAG    = 'A'
AND GL_TRANSLATION_RATES.SET_OF_BOOKS_ID  = GL_SETS_OF_BOOKS.SET_OF_BOOKS_ID
AND GL_TRANSLATION_RATES.TO_CURRENCY_CODE = 'USD'
AND GL_PERIODS.PERIOD_NAME                  = GL_TRANSLATION_RATES.PERIOD_NAME
AND GL_PERIODS.PERIOD_TYPE                  = 'Month'
AND GL_PERIODS.PERIOD_SET_NAME              = 'CORPORATE'
AND GL_PERIODS.ADJUSTMENT_PERIOD_FLAG       = 'N'
AND GL_SETS_OF_BOOKS.CURRENCY_CODE         <> 'USB'
--AND GL_TRANSLATION_RATES_V.PERIOD_NAME      = 'OCT-2010' 
--AND GL_PERIODS.START_DATE >= '01-NOV-2009'
AND GL_TRANSLATION_RATES.PERIOD_NAME =PREV.CURRENT_PERIOD(+) 
AND GL_TRANSLATION_RATES.TO_CURRENCY_CODE = PREV.TO_CURRENCY_CODE(+) 
AND GL_TRANSLATION_RATES.SET_OF_BOOKS_ID = PREV.SET_OF_BOOKS_ID(+)
AND GL_TRANSLATION_RATES.PERIOD_NAME =PRIOR_PER.CURRENT_PERIOD(+) 
AND GL_TRANSLATION_RATES.TO_CURRENCY_CODE = PRIOR_PER.TO_CURRENCY_CODE(+) 
AND GL_TRANSLATION_RATES.SET_OF_BOOKS_ID = PRIOR_PER.SET_OF_BOOKS_ID(+)
GROUP BY GL_TRANSLATION_RATES.PERIOD_NAME,
  GL_PERIODS.START_DATE,
  GL_PERIODS.END_DATE,
  GL_PERIODS.START_DATE,
  GL_PERIODS.END_DATE,
  GL_SETS_OF_BOOKS.CURRENCY_CODE,
  GL_TRANSLATION_RATES.AVG_RATE,
 -- GL_TRANSLATION_RATES.SHOW_AVG_RATE, /* Commented for R12 Upgrade by Yadul Mohammed on 20-Dec-2017*/
  GL_TRANSLATION_RATES.EOP_RATE,
 -- GL_TRANSLATION_RATES.SHOW_EOP_RATE, /* Commented for R12 Upgrade by Yadul Mohammed on 20-Dec-2017*/
 -- GL_TRANSLATION_RATES.REV_RATE, /* Commented for R12 Upgrade by Yadul Mohammed on 20-Dec-2017*/
--  GL_TRANSLATION_RATES.SHOW_REV_RATE, /* Commented for R12 Upgrade by Yadul Mohammed on 20-Dec-2017*/
  GL_TRANSLATION_RATES.AVG_RATE_NUMERATOR,
  GL_TRANSLATION_RATES.AVG_RATE_DENOMINATOR,
  GL_TRANSLATION_RATES.EOP_RATE_NUMERATOR,
  GL_TRANSLATION_RATES.EOP_RATE_DENOMINATOR,
  GL_TRANSLATION_RATES.ACTUAL_FLAG,
  GL_TRANSLATION_RATES.CREATED_BY,
  GL_TRANSLATION_RATES.LAST_UPDATED_BY,
  GL_TRANSLATION_RATES.TO_CURRENCY_CODE,
PREV.AVG_RATE,
  PREV.EOP_RATE, 
PREV.PERIOD_NAME,
PRIOR_PER.AVG_RATE, 
PRIOR_PER.EOP_RATE, 
PRIOR_PER.PERIOD_NAME
union all
SELECT 
'Y' ACTUAL_FLAG,
1 AVG_RATE,
1 AVG_RATE_DENOMINATOR,
1 AVG_RATE_NUMERATOR,
0 CHANGED_BY,
current_date  CHANGED_ON_DT,
0 CREATED_BY,
TO_DATE('01/01/2000 00:00:00', 'MM/DD/YYYY HH24:mi:ss')  CREATION_DATE,
1 EOP_RATE,
1 EOP_RATE_DENOMINATOR,
1 EOP_RATE_NUMERATOR,
'USD' FROM_CURRENCY_CODE,
current_date + 10000 AS PERIOD_END_DT,
'ALL' PERIOD_NAME,
TO_DATE('01/01/2000 00:00:00', 'MM/DD/YYYY HH24:mi:ss') AS PERIOD_START_DT,
 1 REV_RATE,
 1 SHOW_AVG_RATE,
 1 SHOW_EOP_RATE,
 1 SHOW_REV_RATE,
 1 PREVIOUS_AVG_RATE,
 1 PREVIOUS_EOP_RATE,
'ALL'  PREVIOUS_PERIOD,
  1 PRIOR_AVG_RATE,
  1 PRIOR_EOP_RATE,
 'ALL' PRIOR_PERIOD
FROM DUAL 

)   SQ_WC_AVG_XE_RATES_LKP
where	(1=1)
),

AVGXETOTAL AS
(

 select	
	PERIOD_NAME,
	PERIOD_START_DT,
	PERIOD_END_DT,
	PERIOD_START_DT_WID,
	PERIOD_END_DT_WID,
	FROM_CURRENCY_CODE,
	AVG_RATE,
	SHOW_AVG_RATE,
	EOP_RATE,
	SHOW_EOP_RATE,
	REV_RATE,
	SHOW_REV_RATE,
	AVG_RATE_NUMERATOR,
	AVG_RATE_DENOMINATOR,
	EOP_RATE_NUMERATOR,
	EOP_RATE_DENOMINATOR,
	ACTUAL_FLAG,
	CREATED_BY,
	CHANGED_BY,
	CREATED_ON_DT,
	CHANGED_ON_DT,
	INTEGRATION_ID,
	PERIOD_START_CAL_DT_WID,
	PERIOD_END_CAL_DT_WID,
	X_PREV_EOP_RATE,
	X_PREV_AVG_RATE,
	X_PREV_PERIOD,
	X_PRIOR_PERIOD,
	X_PRIOR_EOP_RATE,
	X_PRIOR_AVG_RATE
	,380 DATASOURCE_NUM_ID
FROM (	


select 	
	
	C1_PERIOD_NAME PERIOD_NAME,
	C2_PERIOD_START_DT PERIOD_START_DT,
	C3_PERIOD_END_DT PERIOD_END_DT,
	C4_PERIOD_START_DT_WID PERIOD_START_DT_WID,
	C5_PERIOD_END_DT_WID PERIOD_END_DT_WID,
	C6_FROM_CURRENCY_CODE FROM_CURRENCY_CODE,
	C7_AVG_RATE AVG_RATE,
	C8_SHOW_AVG_RATE SHOW_AVG_RATE,
	C9_EOP_RATE EOP_RATE,
	C10_SHOW_EOP_RATE SHOW_EOP_RATE,
	C11_REV_RATE REV_RATE,
	C12_SHOW_REV_RATE SHOW_REV_RATE,
	C13_AVG_RATE_NUMERATOR AVG_RATE_NUMERATOR,
	C14_AVG_RATE_DENOMINATOR AVG_RATE_DENOMINATOR,
	C15_EOP_RATE_NUMERATOR EOP_RATE_NUMERATOR,
	C16_EOP_RATE_DENOMINATOR EOP_RATE_DENOMINATOR,
	C17_ACTUAL_FLAG ACTUAL_FLAG,
	C18_CREATED_BY CREATED_BY,
	C19_CHANGED_BY CHANGED_BY,
	C20_CREATED_ON_DT CREATED_ON_DT,
	C21_CHANGED_ON_DT CHANGED_ON_DT,
	C22_INTEGRATION_ID INTEGRATION_ID,
	C23_PERIOD_START_CAL_DT_WID PERIOD_START_CAL_DT_WID,
	C24_PERIOD_END_CAL_DT_WID PERIOD_END_CAL_DT_WID,
	C25_X_PREV_EOP_RATE X_PREV_EOP_RATE,
	C26_X_PREV_AVG_RATE X_PREV_AVG_RATE,
	C27_X_PREV_PERIOD X_PREV_PERIOD,
	C28_X_PRIOR_PERIOD X_PRIOR_PERIOD,
	C29_X_PRIOR_EOP_RATE X_PRIOR_EOP_RATE,
	C30_X_PRIOR_AVG_RATE X_PRIOR_AVG_RATE 
from	AVGXE
where		(1=1)	






)    ODI_GET_FROM   
)

SELECT * FROM AVGXETOTAL