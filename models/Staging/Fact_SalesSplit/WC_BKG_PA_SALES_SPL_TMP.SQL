
{{ config (
    materialized="table"
)}}

WITH WC_BKG_PA_SALES_SPL_TMP AS
(
    select	
	DISTINCT
	STAGING.PROJECT_ID	   PROJECT_ID,
	STAGING.SALESREP_ID	    SALESREP_ID,
	STAGING.PERCENT	        CREDIT_PERCENTAGE,
	STAGING.TOTAL_PERCENT	   TOTAL_PCT,
	STAGING.START_DATE_ACTIVE	   ORDERED_DATE,
	SALESPERSON_LOOKUP.SOURCE_ID	   PERSON_ID,
	STAGING.CREDIT_TYPE_CODE	   CREDIT_TYPE_CODE
from	
( /* Subselect from WR_SDE_ORA_SalesSplitTempTables.WC_BKG_PA_SALES_SPL_TMP_EXTRACT
*/


select 
	   

	   
	   PA_CREDIT_RECEIVERS.PROJECT_ID PROJECT_ID,
	PA_CREDIT_RECEIVERS.SALESREP_ID SALESREP_ID,
	PA_CREDIT_RECEIVERS.CREDIT_PERCENTAGE PERCENT,
	SUM(PA_CREDIT_RECEIVERS.CREDIT_PERCENTAGE) OVER (PARTITION BY PA_CREDIT_RECEIVERS.PROJECT_ID) TOTAL_PERCENT,
	PA_CREDIT_RECEIVERS.START_DATE_ACTIVE START_DATE_ACTIVE,
	PA_CREDIT_RECEIVERS.CREDIT_TYPE_CODE CREDIT_TYPE_CODE
from	"PC_FIVETRAN_DB"."ERPPRD_PA"."PA_CREDIT_RECEIVERS"   PA_CREDIT_RECEIVERS
where	(1=1)

And (PA_CREDIT_RECEIVERS.TRANSFER_TO_AR_FLAG='Y')


Group By PA_CREDIT_RECEIVERS.PROJECT_ID,
 PA_CREDIT_RECEIVERS.SALESREP_ID,
 PA_CREDIT_RECEIVERS.CREDIT_PERCENTAGE,
 PA_CREDIT_RECEIVERS.START_DATE_ACTIVE,
 PA_CREDIT_RECEIVERS.CREDIT_TYPE_CODE





)   STAGING, (

select 	
	RA_SALESREPS_ALL.SALESREP_ID    SALESREP_ID,	JTF_RS_RESOURCE_EXTNS.SOURCE_ID    SOURCE_ID
from	 "PC_FIVETRAN_DB"."ERPPRD_JTF"."JTF_RS_SALESREPS"  RA_SALESREPS_ALL, 
   "PC_FIVETRAN_DB"."ERPPRD_JTF"."JTF_RS_RESOURCE_EXTNS" JTF_RS_RESOURCE_EXTNS
where	(1=1)
 And (RA_SALESREPS_ALL.RESOURCE_ID=JTF_RS_RESOURCE_EXTNS.RESOURCE_ID)
And (JTF_RS_RESOURCE_EXTNS.CATEGORY IN ('EMPLOYEE', 'OTHER'))


)   SALESPERSON_LOOKUP
where	(1=1)

 And (STAGING.SALESREP_ID=SALESPERSON_LOOKUP.SALESREP_ID (+))

)
SELECT * FROM WC_BKG_PA_SALES_SPL_TMP