{{ config (
    materialized="table"
)}}


select	
	
	SQ_EMPLOYEES.FIRST_NAME	    FST_NAME,
	SQ_EMPLOYEES.MIDDLE_NAMES	   MID_NAME,
	SQ_EMPLOYEES.LAST_NAME	    LAST_NAME,
	SQ_EMPLOYEES.PREVIOUS_LAST_NAME	    PREV_LAST_NAME,
	case 'L,F' when 'L,F' then SQ_EMPLOYEES.LAST_NAME||','||SQ_EMPLOYEES.FIRST_NAME

 when 'L,M,F' then SQ_EMPLOYEES.LAST_NAME||','||SQ_EMPLOYEES.MIDDLE_NAMES||','||SQ_EMPLOYEES.FIRST_NAME

when 'F L' then SQ_EMPLOYEES.FIRST_NAME||' '||SQ_EMPLOYEES.LAST_NAME

when 'F M L' then SQ_EMPLOYEES.FIRST_NAME||' '||SQ_EMPLOYEES.MIDDLE_NAMES||' '||SQ_EMPLOYEES.LAST_NAME

 when 'L F' then SQ_EMPLOYEES.LAST_NAME||' '||SQ_EMPLOYEES.FIRST_NAME

else SQ_EMPLOYEES.LAST_NAME||','||SQ_EMPLOYEES.FIRST_NAME

end	   FULL_NAME,
	SQ_EMPLOYEES.PRE_NAME_ADJUNCT	  NAME_PREFIX,
	SQ_EMPLOYEES.TITLE	   INDV_TITLE,
	SQ_EMPLOYEES.SUFFIX	    NAME_SUFFIX,
	SQ_EMPLOYEES.PARTY_ID	   PARTY_ID,
	SQ_EMPLOYEES.EMAIL_ADDRESS	   EMAIL_ADDR,
	SQ_EMPLOYEES.EMP_HIRE_DT	   EMP_HIRE_DT,
	SQ_EMPLOYEES.ORIG_HIRE_DT	   ORIG_HIRE_DT,
	SQ_EMPLOYEES.ADJUSTED_SVC_DATE	   ADJ_SERVICE_DT,
	LKP_CONTRACTS.EFFECTIVE_START_DATE	  CONTRACT_ST_DT,
	LKP_CONTRACTS.EFFECTIVE_END_DATE	   CONTRACT_END_DT,
	SQ_EMPLOYEES.EMPLOYEE_NUMBER	   EMPLOYEE_NUM,
	LKP_SUPERVISOR_DATA.EMPLOYEE_NUMBER	   SUPERVISOR_NUM,
	LKP_SUPERVISOR_DATA.FULL_NAME	   SUPERVISOR_NAME,
	SQ_EMPLOYEES.NPW_NUMBER	   CONTINGENT_WORKER_NUM,
	SQ_EMPLOYEES.APPLICANT_NUMBER	   APPLICANT_NUM,
	COALESCE(TO_CHAR(SQ_EMPLOYEES.ORGANIZATION_ID),'__UNASSIGNED__')	   DEPARTMENT_CODE,
	SUBSTR(LKP_POSITION_TYPE.NAME,1,50)	   C22_HELD_POSTN,
	COALESCE(LKP_POSITION_TYPE.POSITION_TYPE,'__UNASSIGNED__')	   POSITION_TYPE_CODE,
	SQ_EMPLOYEES.JOB_TITLE	   JOB_TITLE,
	LKP_SUPERVISOR_POSITION.POSITION_ID	   PAR_HELD_POSTN,
	TO_CHAR(SQ_EMPLOYEES.POSITION_ID)	   PR_POSTN,
	SQ_EMPLOYEES.CURRENT_EMPLOYEE_FLAG	   EMP_FLG,
	SQ_EMPLOYEES.SALES_REP_FLG	   SALES_REP_FLG,
	SQ_EMPLOYEES.BUYER_FLG	   BUYER_FLG,
	SQ_EMPLOYEES.REQUESTOR_FLG	  REQUESTOR_FLG,
	SQ_EMPLOYEES.CURRENT_APPLICANT_FLAG	   APPLICANT_FLG,
	SQ_EMPLOYEES.MANAGER_FLG	   MANAGER_FLG,
	LKP_LOGIN.USER_NAME	           LOGIN,
	SQ_EMPLOYEES.EFFECTIVE_START_DATE	   SRC_EFF_FROM_DT,
	SQ_EMPLOYEES.EFFECTIVE_END_DATE	   SRC_EFF_TO_DT,
	'PER~'||TO_CHAR(SQ_EMPLOYEES.PERSON_ID) 	  INTEGRATION_ID,
	SQ_EMPLOYEES.X_CUSTOM	   X_CUSTOM,
	SQ_EMPLOYEES.DELETE_FLG	   DELETE_FLG,
	TO_CHAR(SQ_EMPLOYEES.SUPERVISOR_ID)	   PAR_INTEGRATION_ID,
	TO_CHAR(SQ_EMPLOYEES.ORGANIZATION_ID)	   VIS_PR_BU_ID,
	'PER~'||SQ_EMPLOYEES.PERSON_ID	   VIS_PR_POS_ID,
	TO_CHAR(SQ_EMPLOYEES.CREATED_BY)	 CREATED_BY_ID,
	TO_CHAR(SQ_EMPLOYEES.LAST_UPDATED_BY)	   CHANGED_BY_ID,
	SQ_EMPLOYEES.CREATION_DATE	   CREATED_ON_DT,
	SQ_EMPLOYEES.LAST_UPDATE_DATE	  CHANGED_ON_DT,
	SQ_EMPLOYEES.AUX1_CHANGED_ON_DT	  AUX1_CHANGED_ON_DT,
	SQ_EMPLOYEES.AUX2_CHANGED_ON_DT	  AUX2_CHANGED_ON_DT,
	SQ_EMPLOYEES.AUX3_CHANGED_ON_DT	   AUX3_CHANGED_ON_DT,
	SQ_EMPLOYEES.LAST_WORKED_DT	   LAST_WORKED_DT,
	'PER~'||TO_CHAR(SQ_EMPLOYEES.PERSON_ID)	   REQUESTOR_ID,
	'PER~'||TO_CHAR(SQ_EMPLOYEES.PERSON_ID)	   BUYER_ID,
	SQ_EMPLOYEES.AUX6_CHANGED_ON_DT	   AUX6_CHANGED_ON_DT,
	SQ_EMPLOYEES.X_SALESREP_NUMBER	  X_SALESREP_NUMBER,
	SQ_EMPLOYEES.PERSON_ID	   PERSON_ID
from	((((
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS_SQ_EMPLOYEES
*/


select 
	   

	   
	   P.PERSON_ID PERSON_ID,
	P.FIRST_NAME FIRST_NAME,
	P.MIDDLE_NAMES MIDDLE_NAMES,
	P.LAST_NAME LAST_NAME,
	P.PREVIOUS_LAST_NAME PREVIOUS_LAST_NAME,
	P.FULL_NAME FULL_NAME,
	P.PRE_NAME_ADJUNCT PRE_NAME_ADJUNCT,
	P.SUFFIX SUFFIX,
	P.TITLE TITLE,
	P.COUNTRY_OF_BIRTH COUNTRY_OF_BIRTH,
	P.SEX SEX,
	P.EMAIL_ADDRESS EMAIL_ADDRESS,
	SVC.EMP_HIRE_DT EMP_HIRE_DT,
	SVC.ORIG_HIRE_DT ORIG_HIRE_DT,
	SVC.ADJ_SERVICE_DT ADJUSTED_SVC_DATE,
	P.EMPLOYEE_NUMBER EMPLOYEE_NUMBER,
	P.APPLICANT_NUMBER APPLICANT_NUMBER,
	P.NPW_NUMBER NPW_NUMBER,
	(
	CASE
WHEN(P.CURRENT_EMPLOYEE_FLAG='Y' OR P.CURRENT_NPW_FLAG='Y') THEN 'Y'
ELSE 'N'
END
) CURRENT_EMPLOYEE_FLAG,
	(
	CASE
WHEN SR.RESOURCE_ID1 IS NULL THEN 'N'
ELSE 'Y'
END
) SALES_REP_FLG,
	(
	CASE
WHEN BUY.AGENT_ID IS NULL THEN 'N'
ELSE 'Y'
END
) BUYER_FLG,
	(
	CASE
WHEN P.CURRENT_EMPLOYEE_FLAG IS NULL THEN 'N'
ELSE 'Y'
END
) REQUESTOR_FLG,
	(
	CASE
WHEN P.CURRENT_APPLICANT_FLAG IS NULL THEN 'N'
ELSE 'Y'
END
) CURRENT_APPLICANT_FLAG,
	P.CREATED_BY CREATED_BY,
	P.LAST_UPDATED_BY LAST_UPDATED_BY,
	P.CREATION_DATE CREATION_DATE,
	
 P.LAST_UPDATE_DATE
 LAST_UPDATE_DATE,
	SR.AUX1_CHANGED_ON_DT AUX1_CHANGED_ON_DT,
	
 BUY.LAST_UPDATE_DATE
 AUX2_CHANGED_ON_DT,
	P.EFFECTIVE_START_DATE EFFECTIVE_START_DATE,
	P.EFFECTIVE_END_DATE EFFECTIVE_END_DATE,
	A.POSITION_ID POSITION_ID,
	A.BUSINESS_GROUP_ID BUSINESS_GROUP_ID,
	A.LOCATION_ID LOCATION_ID,
	A.ORGANIZATION_ID ORGANIZATION_ID,
	A.SUPERVISOR_ID SUPERVISOR_ID,
	'0' X_CUSTOM,
	TO_CHAR(SR.RESOURCE_ID) PARTY_ID,
	A.MANAGER_FLG MANAGER_FLG,
	SUBSTR(PER_JOBS.NAME,1,75) JOB_TITLE,
	(CASE
WHEN A.EFFECTIVE_START_DATE>A.LAST_UPDATE_DATE THEN A.EFFECTIVE_START_DATE
ELSE A.LAST_UPDATE_DATE
END ) AUX3_CHANGED_ON_DT,
	SVC.ACTUAL_TERMINATION_DATE-1 LAST_WORKED_DT,
	SVC.LAST_UPDATE_DT AUX6_CHANGED_ON_DT,
	
'N'
 DELETE_FLG,
	SR.X_SALESREP_NUMBER X_SALESREP_NUMBER
from	((((("PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"    P LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS_EMPLOYEES.SERVICE
*/


select 
	   

	   
	   PER_PERIODS_OF_SERVICE.PERSON_ID PERSON_ID,
	MAX(PER_PERIODS_OF_SERVICE.DATE_START) EMP_HIRE_DT,
	MIN(PER_PERIODS_OF_SERVICE.DATE_START) ORIG_HIRE_DT,
	MAX(PER_PERIODS_OF_SERVICE.ADJUSTED_SVC_DATE) ADJ_SERVICE_DT,
	MAX(
PER_PERIODS_OF_SERVICE.LAST_UPDATE_DATE
) LAST_UPDATE_DT,
	MAX(PER_PERIODS_OF_SERVICE.ACTUAL_TERMINATION_DATE) ACTUAL_TERMINATION_DATE
from	"PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_PERIODS_OF_SERVICE"  PER_PERIODS_OF_SERVICE
where	(1=1)



Group By PER_PERIODS_OF_SERVICE.PERSON_ID





)    SVC ON P.PERSON_ID=SVC.PERSON_ID) LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS_EMPLOYEES.SALESREP
*/


select 
	   

	   
	   RES.SOURCE_ID PERSON_ID,
	MAX(
RES.LAST_UPDATE_DATE
) AUX1_CHANGED_ON_DT,
	MAX(RES.RESOURCE_ID) RESOURCE_ID,
	MAX(SR.RESOURCE_ID) RESOURCE_ID1,
	MAX(SR.SALESREP_NUMBER) X_SALESREP_NUMBER
from	"PC_FIVETRAN_DB"."ERPPRD1_JTF"."JTF_RS_RESOURCE_EXTNS"    RES LEFT OUTER JOIN "PC_FIVETRAN_DB"."ERPPRD1_JTF"."JTF_RS_SALESREPS"    SR ON RES.RESOURCE_ID=SR.RESOURCE_ID
where	(1=1)

And (RES.CATEGORY='EMPLOYEE')


Group By RES.SOURCE_ID





)    SR ON P.PERSON_ID=SR.PERSON_ID) LEFT OUTER JOIN "PC_FIVETRAN_DB"."ERPPRD1_PO"."PO_AGENTS"    BUY ON P.PERSON_ID=BUY.AGENT_ID) INNER JOIN
          "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_PERSON_TYPES"    PPT ON P.PERSON_TYPE_ID=PPT.PERSON_TYPE_ID) INNER JOIN (
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS_EMPLOYEES.ASSIGNMENT
*/


select 
	   

	   
	   A.PERSON_ID PERSON_ID,
	A.ASSIGNMENT_ID ASSIGNMENT_ID,
	A.EFFECTIVE_START_DATE EFFECTIVE_START_DATE,
	A.EFFECTIVE_END_DATE EFFECTIVE_END_DATE,
	A.POSITION_ID POSITION_ID,
	A.SUPERVISOR_ID SUPERVISOR_ID,
	A.BUSINESS_GROUP_ID BUSINESS_GROUP_ID,
	A.ORGANIZATION_ID ORGANIZATION_ID,
	A.LOCATION_ID LOCATION_ID,
	A.PERIOD_OF_SERVICE_ID PERIOD_OF_SERVICE_ID,
	A.ASSIGNMENT_STATUS_TYPE_ID ASSIGNMENT_STATUS_TYPE_ID,
	A.ASSIGNMENT_TYPE ASSIGNMENT_TYPE,
	A.CREATION_DATE CREATION_DATE,
	
  A.LAST_UPDATE_DATE
 LAST_UPDATE_DATE,
	RANK() OVER(
	PARTITION BY A.PERSON_ID ORDER BY DECODE(A.ASSIGNMENT_TYPE,'E',1,'C',2,3),
	A.PRIMARY_FLAG DESC,
	A.EFFECTIVE_START_DATE DESC,
	A.ASSIGNMENT_ID DESC,
        A.EFFECTIVE_END_DATE DESC
) CNT,
	A.MANAGER_FLAG MANAGER_FLG,
	A.JOB_ID JOB_ID
from	"PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_ASSIGNMENTS_F"   A, "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ASSIGNMENT_STATUS_TYPES"   T
where	(1=1)
 And (A.ASSIGNMENT_STATUS_TYPE_ID=T.ASSIGNMENT_STATUS_TYPE_ID)

And (T.PER_SYSTEM_STATUS NOT IN ('TERM_APL','TERM_ASSIGN','SUSP_ASSIGN','SUSP_CWK_ASG'))
 And (A.ASSIGNMENT_TYPE IN ('E','C','A'))
 And (A.EFFECTIVE_START_DATE<=TO_DATE(SUBSTR('2022-02-25 17:59:09',0,19),'YYYY-MM-DD HH24:MI:SS'))







)    A LEFT OUTER JOIN "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_JOBS"    PER_JOBS ON A.JOB_ID=PER_JOBS.JOB_ID) ON P.PERSON_ID=A.PERSON_ID) INNER JOIN (

select 	
	PER_ALL_PEOPLE_F.PERSON_ID    PERSON_ID,	PER_ALL_PEOPLE_F.EFFECTIVE_START_DATE    EFFECTIVE_START_DATE,	MAX(PER_ALL_PEOPLE_F.EFFECTIVE_END_DATE)    EFFECTIVE_END_DATE
from	"PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"   PER_ALL_PEOPLE_F
where	(1=1)


Group By PER_ALL_PEOPLE_F.PERSON_ID,
 PER_ALL_PEOPLE_F.EFFECTIVE_START_DATE

)    MAXENDDATE ON P.PERSON_ID=MAXENDDATE.PERSON_ID AND P.EFFECTIVE_START_DATE=MAXENDDATE.EFFECTIVE_START_DATE AND 
  P.EFFECTIVE_END_DATE=MAXENDDATE.EFFECTIVE_END_DATE
where	(1=1)

And (A.CNT=1)
 And (



(EXISTS (SELECT 1 FROM  (
 SELECT P.PERSON_ID FROM 
     "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P WHERE
 P.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
      "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P WHERE
 P.CREATION_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
      "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P,
 
     "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_PERIODS_OF_SERVICE"
 SVC WHERE P.PERSON_ID=SVC.PERSON_ID AND
 SVC.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
      "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P,
 
     "PC_FIVETRAN_DB"."ERPPRD1_JTF"."JTF_RS_RESOURCE_EXTNS"
 SR WHERE P.PERSON_ID=SR.RESOURCE_ID AND
 SR.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
    "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P, 
    "PC_FIVETRAN_DB"."ERPPRD1_PO"."PO_AGENTS"
 BUY
 WHERE P.PERSON_ID=BUY.AGENT_ID AND
 BUY.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
     "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P, 
     "PC_FIVETRAN_DB"."ERPPRD1_PO"."PO_AGENTS"
 BUY
 WHERE P.PERSON_ID=BUY.AGENT_ID AND
 BUY.CREATION_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
     "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P,
 
     "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_ASSIGNMENTS_F"
 A WHERE P.PERSON_ID=A.PERSON_ID AND
 A.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
      "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P,
 
      "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_ASSIGNMENTS_F"
 A WHERE P.PERSON_ID=A.PERSON_ID AND
 A.CREATION_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
     "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P,
 
     "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_ASSIGNMENTS_F"
 A WHERE P.PERSON_ID=A.PERSON_ID AND
 A.EFFECTIVE_START_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
     "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P, 
     "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ADDRESSES"

 AD WHERE P.PERSON_ID=AD.PERSON_ID AND
 AD.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 UNION ALL
 SELECT P.PERSON_ID FROM 
      "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"
 P, 
     "PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_PHONES"
 PH
 WHERE P.PERSON_ID=PH.PARENT_ID AND
 PH.LAST_UPDATE_DATE>TO_DATE(SUBSTR('2022-01-23 11:39:58',0,19),'YYYY-MM-DD HH24:MI:SS')
 ) TEMP
 WHERE P.PERSON_ID = TEMP.PERSON_ID
 ))

)
 And (PPT.SYSTEM_PERSON_TYPE IN ('APL','APL_EX_APL','CWK','EMP','EMP_APL','EX_APL','EX_CWK','EX_EMP','EX_EMP_APL','OTHER','PRTN','RETIREE'))







)    SQ_EMPLOYEES LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS.LKP_POSITION_TYPE
 - aggregate lookup */

select	 
	 

	
	LKP_POSITION_TYPE.POSITION_ID POSITION_ID,
	LKP_POSITION_TYPE.BUSINESS_GROUP_ID BUSINESS_GROUP_ID,
	LKP_POSITION_TYPE.LOCATION_ID LOCATION_ID,
	LKP_POSITION_TYPE.ORGANIZATION_ID ORGANIZATION_ID,
	MAX(LKP_POSITION_TYPE.POSITION_TYPE) POSITION_TYPE,
	MAX(LKP_POSITION_TYPE.NAME) NAME,
	1 LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD1_HR"."HR_ALL_POSITIONS_F"   LKP_POSITION_TYPE
where	(1=1)



group by	LKP_POSITION_TYPE.POSITION_ID,
	LKP_POSITION_TYPE.BUSINESS_GROUP_ID,
	LKP_POSITION_TYPE.LOCATION_ID,
	LKP_POSITION_TYPE.ORGANIZATION_ID

)    LKP_POSITION_TYPE ON COALESCE(SQ_EMPLOYEES.POSITION_ID,-1) = COALESCE(LKP_POSITION_TYPE.POSITION_ID,-1)
AND	COALESCE(SQ_EMPLOYEES.BUSINESS_GROUP_ID,-1) = COALESCE(LKP_POSITION_TYPE.BUSINESS_GROUP_ID,-1)
AND	COALESCE(SQ_EMPLOYEES.LOCATION_ID,-1) = COALESCE(LKP_POSITION_TYPE.LOCATION_ID,-1)
AND	COALESCE(SQ_EMPLOYEES.ORGANIZATION_ID,-1) = COALESCE(LKP_POSITION_TYPE.ORGANIZATION_ID,-1)
AND	1=LKP_POSITION_TYPE.LKP_ACTIVE) LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS.LKP_CONTRACTS
 - aggregate lookup */

select	 
	 

	
	LKP_CONTRACTS.PERSON_ID PERSON_ID,
	MAX(LKP_CONTRACTS.BUSINESS_GROUP_ID) BUSINESS_GROUP_ID,
	MAX(LKP_CONTRACTS.EFFECTIVE_START_DATE) EFFECTIVE_START_DATE,
	MAX(LKP_CONTRACTS.EFFECTIVE_END_DATE) EFFECTIVE_END_DATE,
	1 LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_CONTRACTS_F"   LKP_CONTRACTS
where	(1=1)



group by	LKP_CONTRACTS.PERSON_ID

)    LKP_CONTRACTS ON COALESCE(SQ_EMPLOYEES.PERSON_ID,-1) = COALESCE(LKP_CONTRACTS.PERSON_ID,-1)
AND	SQ_EMPLOYEES.EFFECTIVE_END_DATE >= LKP_CONTRACTS.EFFECTIVE_START_DATE
AND	1=LKP_CONTRACTS.LKP_ACTIVE) LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS.LKP_LOGIN
 - aggregate lookup */

select	 
	 

	
	LKP_LOGIN.EMPLOYEE_ID EMPLOYEE_ID,
	MAX(LKP_LOGIN.START_DATE) START_DATE,
	MAX(LKP_LOGIN.USER_NAME) USER_NAME,
	1 LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD1_APPLSYS"."FND_USER"   LKP_LOGIN
where	(1=1)



group by	LKP_LOGIN.EMPLOYEE_ID

)    LKP_LOGIN ON COALESCE(SQ_EMPLOYEES.PERSON_ID,-1) = COALESCE(LKP_LOGIN.EMPLOYEE_ID,-1)
AND	SQ_EMPLOYEES.EFFECTIVE_END_DATE >= LKP_LOGIN.START_DATE
AND	1=LKP_LOGIN.LKP_ACTIVE) LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS.LKP_SUPERVISOR_DATA
 - aggregate lookup */

select	 
	 

	
	LKP_SUPERVISOR_DATA.PERSON_ID PERSON_ID,
	MAX(LKP_SUPERVISOR_DATA.EFFECTIVE_START_DATE) EFFECTIVE_START_DATE,
	MAX(LKP_SUPERVISOR_DATA.EMPLOYEE_NUMBER) EMPLOYEE_NUMBER,
	MAX(LKP_SUPERVISOR_DATA.FULL_NAME) FULL_NAME,
	1 LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_PEOPLE_F"   LKP_SUPERVISOR_DATA
where	(1=1)



group by	LKP_SUPERVISOR_DATA.PERSON_ID

)    LKP_SUPERVISOR_DATA ON COALESCE(SQ_EMPLOYEES.SUPERVISOR_ID,-1) = COALESCE(LKP_SUPERVISOR_DATA.PERSON_ID,-1)
AND	SQ_EMPLOYEES.EFFECTIVE_END_DATE >= LKP_SUPERVISOR_DATA.EFFECTIVE_START_DATE
AND	1=LKP_SUPERVISOR_DATA.LKP_ACTIVE) LEFT OUTER JOIN 
( /* Subselect from SDE_ORA_EmployeeDimension.W_EMPLOYEE_DS.LKP_SUPERVISOR_POSITION
*/


select 
	   

	   
	   LKP_SUPERVISOR_POSITION.PERSON_ID PERSON_ID,
	LKP_SUPERVISOR_POSITION.EFFECTIVE_START_DATE EFFECTIVE_START_DATE,
	LKP_SUPERVISOR_POSITION.POSITION_ID POSITION_ID,
	DECODE(ROW_NUMBER() OVER (PARTITION BY 
	LKP_SUPERVISOR_POSITION.PERSON_ID ORDER BY 
	LKP_SUPERVISOR_POSITION.EFFECTIVE_START_DATE DESC,LKP_SUPERVISOR_POSITION.POSITION_ID DESC
),1,1,0) LKP_ACTIVE
from	"PC_FIVETRAN_DB"."ERPPRD1_HR"."PER_ALL_ASSIGNMENTS_F"   LKP_SUPERVISOR_POSITION
where	(1=1)








)    LKP_SUPERVISOR_POSITION ON COALESCE(SQ_EMPLOYEES.SUPERVISOR_ID,-1) = COALESCE(LKP_SUPERVISOR_POSITION.PERSON_ID,-1)
AND	SQ_EMPLOYEES.EFFECTIVE_END_DATE >= LKP_SUPERVISOR_POSITION.EFFECTIVE_START_DATE
AND	1=LKP_SUPERVISOR_POSITION.LKP_ACTIVE

where	(1=1)






 

