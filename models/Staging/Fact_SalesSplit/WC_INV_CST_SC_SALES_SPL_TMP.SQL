{{ config (
    materialized="table"
)}}

WITH WC_INV_CST_SC_SALES_SPL_TMP AS
(

select	
	
	STAGING.ID	   LINE_ID,
	STAGING.CUSTOMER_TRX_LINE_ID	   CUSTOMER_TRX_LINE_ID,
	STAGING.ORIG_SALESPERSON_ID	   ORIG_SALESREP_ID,
	STAGING.SPLIT_SALESPERSON_ID	   SPLIT_SALESREP_ID,
	STAGING.ORIG_SALESFORCE_ACCOUNT_ID	   ORIG_SF_ACCOUNT_ID,
	STAGING.SPLIT_SALESFORCE_ACCOUNT_ID	  SPLIT_SF_ACCOUNT_ID,
	STAGING.SALES_SPLIT_PERCENTAGE	  SPLIT_PERCENTAGE,
	STAGING.TRX_DATE	   ORDERED_DATE,
	STAGING.CM_FLG	  TRANSACTION_TYPE,
	SALESPERSON_LOOKUP.SOURCE_ID	   PERSON_ID
from	
( /* Subselect from WR_SDE_ORA_SalesSplitTempTables.WC_INV_CST_SC_SALES_SPL_TMP_EXTRACT
*/


select 
	   

	   
	   OKC_K_LINES_B.ID ID,
	RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_LINE_ID CUSTOMER_TRX_LINE_ID,
	RA_CUSTOMER_TRX_ALL.TRX_DATE TRX_DATE,
	DECODE(WRS_SC_SPLIT_ALL.TRANSACTION_TYPE,'CM','Y',NULL) CM_FLG,
	WRS_SC_SPLIT_ALL.ORIG_SALESPERSON_ID ORIG_SALESPERSON_ID,
	WRS_SC_SPLIT_ALL.SPLIT_SALESPERSON_ID SPLIT_SALESPERSON_ID,
	WRS_SC_SPLIT_ALL.ORIG_SALESFORCE_ACCOUNT_ID ORIG_SALESFORCE_ACCOUNT_ID,
	NVL(WRS_SC_SPLIT_ALL.SPLIT_SALESFORCE_ACCOUNT_ID, WRS_SC_SPLIT_ALL.ORIG_SALESFORCE_ACCOUNT_ID) SPLIT_SALESFORCE_ACCOUNT_ID,
	WRS_SC_SPLIT_ALL.SALES_SPLIT_PERCENTAGE SALES_SPLIT_PERCENTAGE
from	"PC_FIVETRAN_DB"."ERPPRD1_AR"."RA_CUSTOMER_TRX_ALL"   RA_CUSTOMER_TRX_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD1_AR"."RA_CUSTOMER_TRX_LINES_ALL"  RA_CUSTOMER_TRX_LINES_ALL, 
 "PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_LINES_B"   OKC_K_LINES_B, 
  "PC_FIVETRAN_DB"."ERPPRD1_OKC"."OKC_K_HEADERS_ALL_B"   OKC_K_HEADERS_ALL_B, 
  "PC_FIVETRAN_DB"."ERPPRD1_OKS"."OKS_BILL_CONT_LINES" OKS_BILL_CONT_LINES, 
  "PC_FIVETRAN_DB"."ERPPRD1_OKS"."OKS_BILL_SUB_LINES"   OKS_BILL_SUB_LINES, 
 "PC_FIVETRAN_DB"."ERPPRD1_WRSAPP"."WRS_SC_SPLIT_ALL"   WRS_SC_SPLIT_ALL
where	(1=1)
 And (OKC_K_LINES_B.ID=OKS_BILL_CONT_LINES.CLE_ID)
AND (RA_CUSTOMER_TRX_LINES_ALL.SOURCE_DATA_KEY2=OKS_BILL_SUB_LINES.BCL_ID)
AND (RA_CUSTOMER_TRX_LINES_ALL.SOURCE_DATA_KEY1=OKS_BILL_CONT_LINES.CLE_ID)
AND (OKS_BILL_CONT_LINES.ID=OKS_BILL_SUB_LINES.BCL_ID)
AND (RA_CUSTOMER_TRX_LINES_ALL.CUSTOMER_TRX_ID=RA_CUSTOMER_TRX_ALL.CUSTOMER_TRX_ID)
AND (OKC_K_LINES_B.DNZ_CHR_ID=OKC_K_HEADERS_ALL_B.ID)
AND (WRS_SC_SPLIT_ALL.CLE_ID=OKC_K_LINES_B.ID)
AND (WRS_SC_SPLIT_ALL.DNZ_CHAR_ID=OKC_K_HEADERS_ALL_B.ID)

And (RA_CUSTOMER_TRX_LINES_ALL.INTERFACE_LINE_CONTEXT = 'OKS CONTRACTS')
)   STAGING, (

select 	
	RA_SALESREPS_ALL.SALESREP_ID    SALESREP_ID,	JTF_RS_RESOURCE_EXTNS.SOURCE_ID    SOURCE_ID
from	"PC_FIVETRAN_DB"."ERPPRD1_JTF"."JTF_RS_SALESREPS"   RA_SALESREPS_ALL, 
  "PC_FIVETRAN_DB"."ERPPRD1_JTF"."JTF_RS_RESOURCE_EXTNS" JTF_RS_RESOURCE_EXTNS
where	(1=1)
 And (RA_SALESREPS_ALL.RESOURCE_ID=JTF_RS_RESOURCE_EXTNS.RESOURCE_ID)
And (JTF_RS_RESOURCE_EXTNS.CATEGORY IN ('EMPLOYEE', 'OTHER'))


)   SALESPERSON_LOOKUP
where	(1=1)

 And (STAGING.SPLIT_SALESPERSON_ID=SALESPERSON_LOOKUP.SALESREP_ID)
)
SELECT * FROM WC_INV_CST_SC_SALES_SPL_TMP