WITH MCALPERIOD AS (

select	
	
	SQ_GL_PERIODS.PERIOD_SET_NAME||'~'||SQ_GL_PERIODS.PERIOD_TYPE	   C1_MCAL_CAL_ID,
	SQ_GL_PERIODS.PERIOD_SET_NAME	   C2_MCAL_CAL_NAME,
	SQ_GL_PERIODS.ADJUSTMENT_PERIOD_FLAG	   C3_ADJUSTMENT_PERIOD_FLG,
	SQ_GL_PERIODS.PERIOD_TYPE	   C4_MCAL_PERIOD_TYPE,
	SQ_GL_PERIODS.PERIOD_NAME	   C5_MCAL_PERIOD_NAME,
	SQ_GL_PERIODS.PERIOD_NUM	   C6_MCAL_PERIOD,
	SQ_GL_PERIODS.START_DATE	   C7_MCAL_PERIOD_ST_DT,
	SQ_GL_PERIODS.END_DATE	   C8_MCAL_PERIOD_END_DT,
	SQ_GL_PERIODS.QUARTER_NUM	   C9_MCAL_QTR,
	SQ_GL_PERIODS.PERIOD_YEAR	   C10_MCAL_YEAR,
	SQ_GL_PERIODS.QUARTER_START_DATE	   C11_MCAL_QTR_START_DT,
	SQ_GL_PERIODS.QUARTER_END_DATE	   C12_MCAL_QTR_END_DT,
	SQ_GL_PERIODS.YEAR_START_DATE	   C13_MCAL_YEAR_START_DT,
	SQ_GL_PERIODS.YEAR_END_DATE	   C14_MCAL_YEAR_END_DT,
	SQ_GL_PERIODS.PERIOD_SET_NAME||'~'|| SQ_GL_PERIODS.PERIOD_NAME	   C15_INTEGRATION_ID,
	SQ_GL_PERIODS.X_CUSTOM	   C16_X_CUSTOM
from	
( /* Subselect from SDE_ORA_TimeDimension_MCalPeriod.W_MCAL_PERIOD_DS_SQ_GL_PERIODS
*/


select 
	   

	   
	   GLP.PERIOD_YEAR PERIOD_YEAR,
	GLP.PERIOD_TYPE PERIOD_TYPE,
	GLP.QUARTER_NUM QUARTER_NUM,
	GLP.PERIOD_NUM PERIOD_NUM,
	GLP.PERIOD_NAME PERIOD_NAME,
	GLP_QTR_END_DATE.QUARTER_END_DATE QUARTER_END_DATE,
	GLP.START_DATE START_DATE,
	GLP.ADJUSTMENT_PERIOD_FLAG ADJUSTMENT_PERIOD_FLAG,
	GLP.QUARTER_START_DATE QUARTER_START_DATE,
	GLP.PERIOD_SET_NAME PERIOD_SET_NAME,
	GLP_YEAR_END_DATE.YEAR_END_DATE YEAR_END_DATE,
	'0' X_CUSTOM,
	GLP.END_DATE END_DATE,
	GLP.YEAR_START_DATE YEAR_START_DATE
from	(
( /* Subselect from SDE_ORA_TimeDimension_MCalPeriod.W_MCAL_PERIOD_DS_S_Q_GL_PERIODS.GLP_QTR_END_DATE
*/


select 
	   

	   
	   GLP.PERIOD_YEAR PERIOD_YEAR,
	GLP.QUARTER_NUM QUARTER_NUM,
	MAX(GLP.PERIOD_NUM) PERIOD_NUM,
	GLPS.PERIOD_SET_NAME PERIOD_SET_NAME,
	MAX(GLP.END_DATE) QUARTER_END_DATE,
	GLP.PERIOD_TYPE PERIOD_TYPE
from	"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIODS"    GLP INNER JOIN "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIOD_SETS"    GLPS ON GLP.PERIOD_SET_NAME=GLPS.PERIOD_SET_NAME
where	(1=1)



Group By GLP.PERIOD_YEAR,
 GLP.QUARTER_NUM,
 GLPS.PERIOD_SET_NAME,
 GLP.PERIOD_TYPE





)    GLP_QTR_END_DATE INNER JOIN (
( /* Subselect from SDE_ORA_TimeDimension_MCalPeriod.W_MCAL_PERIOD_DS_S_Q_GL_PERIODS.GLP_YEAR_END_DATE
*/


select 
	   

	   
	   GLPS.PERIOD_SET_NAME PERIOD_SET_NAME,
	MAX(GLP.PERIOD_NUM) PERIOD_NUM,
	GLP.PERIOD_YEAR PERIOD_YEAR,
	MAX(GLP.END_DATE) YEAR_END_DATE,
	GLP.PERIOD_TYPE PERIOD_TYPE
from	"PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIODS"    GLP INNER JOIN "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIOD_SETS"   GLPS ON GLP.PERIOD_SET_NAME=GLPS.PERIOD_SET_NAME
where	(1=1)



Group By GLPS.PERIOD_SET_NAME,
 GLP.PERIOD_YEAR,
 GLP.PERIOD_TYPE





)    GLP_YEAR_END_DATE INNER JOIN "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIODS"   GLP ON GLP_YEAR_END_DATE.PERIOD_TYPE=GLP.PERIOD_TYPE 
AND GLP_YEAR_END_DATE.PERIOD_YEAR=GLP.PERIOD_YEAR 
AND GLP.PERIOD_SET_NAME=GLP_YEAR_END_DATE.PERIOD_SET_NAME) ON GLP_QTR_END_DATE.PERIOD_YEAR=GLP.PERIOD_YEAR AND GLP.QUARTER_NUM=GLP_QTR_END_DATE.QUARTER_NUM AND GLP.PERIOD_TYPE=GLP_QTR_END_DATE.PERIOD_TYPE AND GLP_QTR_END_DATE.PERIOD_SET_NAME=GLP.PERIOD_SET_NAME) INNER JOIN "PC_FIVETRAN_DB"."ERPPRD_GL"."GL_PERIOD_SETS"    GLPS ON GLP_QTR_END_DATE.PERIOD_SET_NAME=GLPS.PERIOD_SET_NAME
where	(1=1)








)   SQ_GL_PERIODS
where	(1=1)

),

MCALPERIODTOTAL AS
(
select	
	MCAL_CAL_ID,
	MCAL_CAL_NAME,
	ADJUSTMENT_PERIOD_FLG,
	MCAL_PERIOD_TYPE,
	MCAL_PERIOD_NAME,
	MCAL_PERIOD,
	MCAL_PERIOD_ST_DT,
	MCAL_PERIOD_END_DT,
	MCAL_QTR,
	MCAL_YEAR,
	MCAL_QTR_START_DT,
	MCAL_QTR_END_DT,
	MCAL_YEAR_START_DT,
	MCAL_YEAR_END_DT,
	INTEGRATION_ID,
	DATASOURCE_NUM_ID,
	W_INSERT_DT,
	W_UPDATE_DT,
	X_CUSTOM
	,'OLTP Sourced',
	COALESCE(NULL,'__NOT_APPLICABLE__') PERIOD_CLASSIFICATION_CODE,
	'DEFAULT' TENANT_ID
FROM (	


select 	
	
	C1_MCAL_CAL_ID MCAL_CAL_ID,
	C2_MCAL_CAL_NAME MCAL_CAL_NAME,
	C3_ADJUSTMENT_PERIOD_FLG ADJUSTMENT_PERIOD_FLG,
	C4_MCAL_PERIOD_TYPE MCAL_PERIOD_TYPE,
	C5_MCAL_PERIOD_NAME MCAL_PERIOD_NAME,
	C6_MCAL_PERIOD MCAL_PERIOD,
	C7_MCAL_PERIOD_ST_DT MCAL_PERIOD_ST_DT,
	C8_MCAL_PERIOD_END_DT MCAL_PERIOD_END_DT,
	C9_MCAL_QTR MCAL_QTR,
	C10_MCAL_YEAR MCAL_YEAR,
	C11_MCAL_QTR_START_DT MCAL_QTR_START_DT,
	C12_MCAL_QTR_END_DT MCAL_QTR_END_DT,
	C13_MCAL_YEAR_START_DT MCAL_YEAR_START_DT,
	C14_MCAL_YEAR_END_DT MCAL_YEAR_END_DT,
	C15_INTEGRATION_ID INTEGRATION_ID,
	380 DATASOURCE_NUM_ID,
	CURRENT_DATE W_INSERT_DT,
	CURRENT_DATE W_UPDATE_DT,
	C16_X_CUSTOM X_CUSTOM 
from	MCALPERIOD
where		(1=1)	






)    ODI_GET_FROM
)

SELECT * FROM MCALPERIODTOTAL






 

